
<!-- saved from url=(0026)http://thejit.org/builder/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><link type="text/css" rel="stylesheet" href="chrome-extension://cpngackimfmofbokmjmljamhdncknpmg/style.css"><script type="text/javascript" charset="utf-8" src="chrome-extension://cpngackimfmofbokmjmljamhdncknpmg/page_context.js"></script></head><body screen_capture_injected="true"><pre style="word-wrap: break-word; white-space: pre-wrap;">
/*
Copyright (c) 2011 Sencha Inc. - Author: Nicolas Garcia Belmonte (http://philogb.github.com/)

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

 */
 
 (function(){window.$jit=function(a){var a=a||window,c;for(c in $jit)$jit[c].$extend&amp;&amp;(a[c]=$jit[c])};$jit.version="2.0.1";var h=function(a){return document.getElementById(a)};h.empty=function(){};h.extend=function(a,c){for(var b in c||{})a[b]=c[b];return a};h.lambda=function(a){return typeof a=="function"?a:function(){return a}};h.time=Date.now||function(){return+new Date};h.splat=function(a){var c=h.type(a);return c?c!="array"?[a]:a:[]};h.type=function(a){var c=h.type.s.call(a).match(/^\[object\s(.*)\]$/)[1].toLowerCase();
return c!="object"?c:a&amp;&amp;a.$$family?a.$$family:a&amp;&amp;a.nodeName&amp;&amp;a.nodeType==1?"element":c};h.type.s=Object.prototype.toString;h.each=function(a,c){if(h.type(a)=="object")for(var b in a)c(a[b],b);else{b=0;for(var d=a.length;b&lt;d;b++)c(a[b],b)}};h.indexOf=function(a,c){if(Array.indexOf)return a.indexOf(c);for(var b=0,d=a.length;b&lt;d;b++)if(a[b]===c)return b;return-1};h.map=function(a,c){var b=[];h.each(a,function(a,e){b.push(c(a,e))});return b};h.reduce=function(a,c,b){var d=a.length;if(d==0)return b;for(var e=
arguments.length==3?b:a[--d];d--;)e=c(e,a[d]);return e};h.merge=function(){for(var a={},c=0,b=arguments.length;c&lt;b;c++){var d=arguments[c];if(h.type(d)=="object")for(var e in d){var f=d[e],g=a[e];a[e]=g&amp;&amp;h.type(f)=="object"&amp;&amp;h.type(g)=="object"?h.merge(g,f):h.unlink(f)}}return a};h.unlink=function(a){var c;switch(h.type(a)){case "object":c={};for(var b in a)c[b]=h.unlink(a[b]);break;case "array":c=[];b=0;for(var d=a.length;b&lt;d;b++)c[b]=h.unlink(a[b]);break;default:return a}return c};h.zip=function(){if(arguments.length===
0)return[];for(var a=0,c=[],b=arguments.length,d=arguments[0].length;a&lt;d;a++){for(var e=0,f=[];e&lt;b;e++)f.push(arguments[e][a]);c.push(f)}return c};h.rgbToHex=function(a,c){if(a.length&lt;3)return null;if(a.length==4&amp;&amp;a[3]==0&amp;&amp;!c)return"transparent";for(var b=[],d=0;d&lt;3;d++){var e=(a[d]-0).toString(16);b.push(e.length==1?"0"+e:e)}return c?b:"#"+b.join("")};h.hexToRgb=function(a){if(a.length!=7){a=a.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);a.shift();if(a.length!=3)return null;for(var c=[],b=0;b&lt;3;b++){var d=
a[b];d.length==1&amp;&amp;(d+=d);c.push(parseInt(d,16))}return c}else return a=parseInt(a.slice(1),16),[a&gt;&gt;16,a&gt;&gt;8&amp;255,a&amp;255]};h.destroy=function(a){h.clean(a);a.parentNode&amp;&amp;a.parentNode.removeChild(a);a.clearAttributes&amp;&amp;a.clearAttributes()};h.clean=function(a){for(var a=a.childNodes,c=0,b=a.length;c&lt;b;c++)h.destroy(a[c])};h.addEvent=function(a,c,b){a.addEventListener?a.addEventListener(c,b,false):a.attachEvent("on"+c,b)};h.addEvents=function(a,c){for(var b in c)h.addEvent(a,b,c[b])};h.hasClass=function(a,
c){return(" "+a.className+" ").indexOf(" "+c+" ")&gt;-1};h.addClass=function(a,c){if(!h.hasClass(a,c))a.className=a.className+" "+c};h.removeClass=function(a,c){a.className=a.className.replace(RegExp("(^|\\s)"+c+"(?:\\s|$)"),"$1")};h.getPos=function(a){var c=function(a){for(var c={x:0,y:0};a&amp;&amp;!/^(?:body|html)$/i.test(a.tagName);)c.x+=a.offsetLeft,c.y+=a.offsetTop,a=a.offsetParent;return c}(a),a=function(a){for(var c={x:0,y:0};a&amp;&amp;!/^(?:body|html)$/i.test(a.tagName);)c.x+=a.scrollLeft,c.y+=a.scrollTop,
a=a.parentNode;return c}(a);return{x:c.x-a.x,y:c.y-a.y}};h.event={get:function(a,c){return a||(c||window).event},getWheel:function(a){return a.wheelDelta?a.wheelDelta/120:-(a.detail||0)/3},isRightClick:function(a){return a.which==3||a.button==2},getPos:function(a,c){var c=c||window,a=a||c.event,b=c.document,b=b.documentElement||b.body;a.touches&amp;&amp;a.touches.length&amp;&amp;(a=a.touches[0]);return{x:a.pageX||a.clientX+b.scrollLeft,y:a.pageY||a.clientY+b.scrollTop}},stop:function(a){a.stopPropagation&amp;&amp;a.stopPropagation();
a.cancelBubble=true;a.preventDefault?a.preventDefault():a.returnValue=false}};$jit.util=$jit.id=h;var j=function(a){var a=a||{},c=function(){for(var a in this)typeof this[a]!="function"&amp;&amp;(this[a]=h.unlink(this[a]));this.constructor=c;if(j.prototyping)return this;a=this.initialize?this.initialize.apply(this,arguments):this;this.$$family="class";return a},b;for(b in j.Mutators)a[b]&amp;&amp;(a=j.Mutators[b](a,a[b]),delete a[b]);h.extend(c,this);c.constructor=j;c.prototype=a;return c};j.Mutators={Implements:function(a,
c){h.each(h.splat(c),function(c){j.prototyping=c;var c=typeof c=="function"?new c:c,d;for(d in c)d in a||(a[d]=c[d]);delete j.prototyping});return a}};h.extend(j,{inherit:function(a,c){for(var b in c){var d=c[b],e=a[b],f=h.type(d);e&amp;&amp;f=="function"?d!=e&amp;&amp;j.override(a,b,d):a[b]=f=="object"?h.merge(e,d):d}return a},override:function(a,c,b){var d=j.prototyping;d&amp;&amp;a[c]!=d[c]&amp;&amp;(d=null);a[c]=function(){var e=this.parent;this.parent=d?d[c]:a[c];var f=b.apply(this,arguments);this.parent=e;return f}}});j.prototype.implement=
function(){var a=this.prototype;h.each(Array.prototype.slice.call(arguments||[]),function(c){j.inherit(a,c)});return this};$jit.Class=j;$jit.json={prune:function(a,c){this.each(a,function(a,d){if(d==c&amp;&amp;a.children)delete a.children,a.children=[]})},getParent:function(a,c){if(a.id==c)return false;var b=a.children;if(b&amp;&amp;b.length&gt;0)for(var d=0;d&lt;b.length;d++)if(b[d].id==c)return a;else{var e=this.getParent(b[d],c);if(e)return e}return false},getSubtree:function(a,c){if(a.id==c)return a;for(var b=0,d=
a.children;d&amp;&amp;b&lt;d.length;b++){var e=this.getSubtree(d[b],c);if(e!=null)return e}return null},eachLevel:function(a,c,b,d){if(c&lt;=b&amp;&amp;(d(a,c),a.children))for(var e=0,a=a.children;e&lt;a.length;e++)this.eachLevel(a[e],c+1,b,d)},each:function(a,c){this.eachLevel(a,0,Number.MAX_VALUE,c)}};$jit.Trans={$extend:true,linear:function(a){return a}};var J=$jit.Trans;(function(){var a=function(a,b){b=h.splat(b);return h.extend(a,{easeIn:function(d){return a(d,b)},easeOut:function(d){return 1-a(1-d,b)},easeInOut:function(d){return d&lt;=
0.5?a(2*d,b)/2:(2-a(2*(1-d),b))/2}})};h.each({Pow:function(a,b){return Math.pow(a,b[0]||6)},Expo:function(a){return Math.pow(2,8*(a-1))},Circ:function(a){return 1-Math.sin(Math.acos(a))},Sine:function(a){return 1-Math.sin((1-a)*Math.PI/2)},Back:function(a,b){b=b[0]||1.618;return Math.pow(a,2)*((b+1)*a-b)},Bounce:function(a){for(var b,d=0,e=1;;d+=e,e/=2)if(a&gt;=(7-4*d)/11){b=e*e-Math.pow((11-6*d-11*a)/4,2);break}return b},Elastic:function(a,b){return Math.pow(2,10*--a)*Math.cos(20*a*Math.PI*(b[0]||1)/
3)}},function(c,b){J[b]=a(c)});h.each(["Quad","Cubic","Quart","Quint"],function(c,b){J[c]=a(function(a){return Math.pow(a,[b+2])})})})();var M=new j({initialize:function(a){this.setOptions(a)},setOptions:function(a){this.opt=h.merge({duration:2500,fps:40,transition:J.Quart.easeInOut,compute:h.empty,complete:h.empty,link:"ignore"},a||{});return this},step:function(){var a=h.time(),c=this.opt;a&lt;this.time+c.duration?(a=c.transition((a-this.time)/c.duration),c.compute(a)):(this.timer=clearInterval(this.timer),
c.compute(1),c.complete())},start:function(){if(!this.check())return this;this.time=0;this.startTimer();return this},startTimer:function(){var a=this,c=this.opt.fps;if(this.timer)return false;this.time=h.time()-this.time;this.timer=setInterval(function(){a.step()},Math.round(1E3/c));return true},pause:function(){this.stopTimer();return this},resume:function(){this.startTimer();return this},stopTimer:function(){if(!this.timer)return false;this.time=h.time()-this.time;this.timer=clearInterval(this.timer);
return true},check:function(){if(!this.timer)return true;return this.opt.link=="cancel"?(this.stopTimer(),true):false}}),u=function(){for(var a=arguments,c=0,b=a.length,d={};c&lt;b;c++){var e=u[a[c]];e.$extend?h.extend(d,e):d[a[c]]=e}return d};u.AreaChart={$extend:true,animate:true,labelOffset:3,type:"stacked",Tips:{enable:false,onShow:h.empty,onHide:h.empty},Events:{enable:false,onClick:h.empty},selectOnHover:true,showAggregates:true,showLabels:true,filterOnClick:false,restoreOnRightClick:false};u.Margin=
{$extend:false,top:0,left:0,right:0,bottom:0};u.Canvas={$extend:true,injectInto:"id",type:"2D",width:false,height:false,useCanvas:false,withLabels:true,background:false,Scene:{Lighting:{enable:false,ambient:[1,1,1],directional:{direction:{x:-100,y:-100,z:-100},color:[0.5,0.3,0.1]}}}};u.Tree={$extend:true,orientation:"left",subtreeOffset:8,siblingOffset:5,indent:10,multitree:false,align:"center"};u.Node={$extend:false,overridable:false,type:"circle",color:"#ccb",alpha:1,dim:3,height:20,width:90,autoHeight:false,
autoWidth:false,lineWidth:1,transform:true,align:"center",angularWidth:1,span:1,CanvasStyles:{}};u.Edge={$extend:false,overridable:false,type:"line",color:"#ccb",lineWidth:1,dim:15,alpha:1,epsilon:7,CanvasStyles:{}};u.Fx={$extend:true,fps:40,duration:2500,transition:$jit.Trans.Quart.easeInOut,clearCanvas:true};u.Label={$extend:false,overridable:false,type:"HTML",style:" ",size:10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:"#fff"};u.Tips={$extend:false,enable:false,type:"auto",
offsetX:20,offsetY:20,force:false,onShow:h.empty,onHide:h.empty};u.NodeStyles={$extend:false,enable:false,type:"auto",stylesHover:false,stylesClick:false};u.Events={$extend:false,enable:false,enableForEdges:false,type:"auto",onClick:h.empty,onRightClick:h.empty,onMouseMove:h.empty,onMouseEnter:h.empty,onMouseLeave:h.empty,onDragStart:h.empty,onDragMove:h.empty,onDragCancel:h.empty,onDragEnd:h.empty,onTouchStart:h.empty,onTouchMove:h.empty,onTouchEnd:h.empty,onMouseWheel:h.empty};u.Navigation={$extend:false,
enable:false,type:"auto",panning:false,zooming:false};u.Controller={$extend:true,onBeforeCompute:h.empty,onAfterCompute:h.empty,onCreateLabel:h.empty,onPlaceLabel:h.empty,onComplete:h.empty,onBeforePlotLine:h.empty,onAfterPlotLine:h.empty,onBeforePlotNode:h.empty,onAfterPlotNode:h.empty,request:false};var N={initialize:function(a,c){this.viz=c;this.canvas=c.canvas;this.config=c.config[a];this.nodeTypes=c.fx.nodeTypes;var b=this.config.type;this.labelContainer=(this.dom=b=="auto"?c.config.Label.type!=
"Native":b!="Native")&amp;&amp;c.labels.getLabelContainer();this.isEnabled()&amp;&amp;this.initializePost()},initializePost:h.empty,setAsProperty:h.lambda(false),isEnabled:function(){return this.config.enable},isLabel:function(a,c,b){var a=h.event.get(a,c),c=this.labelContainer,d=a.target||a.srcElement,a=a.relatedTarget;return b?a&amp;&amp;a==this.viz.canvas.getCtx().canvas&amp;&amp;!!d&amp;&amp;this.isDescendantOf(d,c):this.isDescendantOf(d,c)},isDescendantOf:function(a,c){for(;a&amp;&amp;a.parentNode;){if(a.parentNode==c)return a;a=a.parentNode}return false}},
O={onMouseUp:h.empty,onMouseDown:h.empty,onMouseMove:h.empty,onMouseOver:h.empty,onMouseOut:h.empty,onMouseWheel:h.empty,onTouchStart:h.empty,onTouchMove:h.empty,onTouchEnd:h.empty,onTouchCancel:h.empty},T=new j({initialize:function(a){this.viz=a;this.canvas=a.canvas;this.edge=this.node=false;this.registeredObjects=[];this.attachEvents()},attachEvents:function(){var a=this.canvas.getElement(),c=this;a.oncontextmenu=h.lambda(false);h.addEvents(a,{mouseup:function(a,b){var f=h.event.get(a,b);c.handleEvent("MouseUp",
a,b,c.makeEventObject(a,b),h.event.isRightClick(f))},mousedown:function(a,b){var f=h.event.get(a,b);c.handleEvent("MouseDown",a,b,c.makeEventObject(a,b),h.event.isRightClick(f))},mousemove:function(a,b){c.handleEvent("MouseMove",a,b,c.makeEventObject(a,b))},mouseover:function(a,b){c.handleEvent("MouseOver",a,b,c.makeEventObject(a,b))},mouseout:function(a,b){c.handleEvent("MouseOut",a,b,c.makeEventObject(a,b))},touchstart:function(a,b){c.handleEvent("TouchStart",a,b,c.makeEventObject(a,b))},touchmove:function(a,
b){c.handleEvent("TouchMove",a,b,c.makeEventObject(a,b))},touchend:function(a,b){c.handleEvent("TouchEnd",a,b,c.makeEventObject(a,b))}});var b=function(a,b){var f=h.event.get(a,b),f=h.event.getWheel(f);c.handleEvent("MouseWheel",a,b,f)};!document.getBoxObjectFor&amp;&amp;window.mozInnerScreenX==null?h.addEvent(a,"mousewheel",b):a.addEventListener("DOMMouseScroll",b,false)},register:function(a){this.registeredObjects.push(a)},handleEvent:function(){for(var a=Array.prototype.slice.call(arguments),c=a.shift(),
b=0,d=this.registeredObjects,e=d.length;b&lt;e;b++)d[b]["on"+c].apply(d[b],a)},makeEventObject:function(a,c){var b=this,d=this.viz.graph,e=this.viz.fx,f=e.nodeTypes,g=e.edgeTypes;return{pos:false,node:false,edge:false,contains:false,getNodeCalled:false,getEdgeCalled:false,getPos:function(){var d=b.viz.canvas,e=d.getSize(),f=d.getPos(),g=d.translateOffsetX,o=d.translateOffsetY,t=d.scaleOffsetX,d=d.scaleOffsetY,G=h.event.getPos(a,c);return this.pos={x:(G.x-f.x-e.width/2-g)*1/t,y:(G.y-f.y-e.height/2-o)*
1/d}},getNode:function(){if(this.getNodeCalled)return this.node;this.getNodeCalled=true;for(var a in d.nodes){var c=d.nodes[a],g=c&amp;&amp;f[c.getData("type")];if(g=g&amp;&amp;g.contains&amp;&amp;g.contains.call(e,c,this.getPos()))return this.contains=g,b.node=this.node=c}return b.node=this.node=false},getEdge:function(){if(this.getEdgeCalled)return this.edge;this.getEdgeCalled=true;var a={},c;for(c in d.edges){var f=d.edges[c];a[c]=true;for(var h in f)if(!(h in a)){var o=f[h],t=o&amp;&amp;g[o.getData("type")];if(t=t&amp;&amp;t.contains&amp;&amp;
t.contains.call(e,o,this.getPos()))return this.contains=t,b.edge=this.edge=o}}return b.edge=this.edge=false},getContains:function(){if(this.getNodeCalled)return this.contains;this.getNode();return this.contains}}}}),E={initializeExtras:function(){var a=new T(this),c=this;h.each(["NodeStyles","Tips","Navigation","Events"],function(b){var d=new E.Classes[b](b,c);d.isEnabled()&amp;&amp;a.register(d);d.setAsProperty()&amp;&amp;(c[b.toLowerCase()]=d)})},Classes:{}};E.Classes.Events=new j({Implements:[N,O],initializePost:function(){this.fx=
this.viz.fx;this.ntypes=this.viz.fx.nodeTypes;this.etypes=this.viz.fx.edgeTypes;this.moved=this.touchMoved=this.touched=this.pressed=this.hovered=false},setAsProperty:h.lambda(true),onMouseUp:function(a,c,b,d){a=h.event.get(a,c);if(!this.moved)if(d)this.config.onRightClick(this.hovered,b,a);else this.config.onClick(this.pressed,b,a);if(this.pressed){if(this.moved)this.config.onDragEnd(this.pressed,b,a);else this.config.onDragCancel(this.pressed,b,a);this.pressed=this.moved=false}},onMouseOut:function(a,
c,b){var d=h.event.get(a,c),e;if(this.dom&amp;&amp;(e=this.isLabel(a,c,true)))this.config.onMouseLeave(this.viz.graph.getNode(e.id),b,d),this.hovered=false;else{a=d.relatedTarget;for(c=this.canvas.getElement();a&amp;&amp;a.parentNode;){if(c==a.parentNode)return;a=a.parentNode}if(this.hovered)this.config.onMouseLeave(this.hovered,b,d),this.hovered=false}},onMouseOver:function(a,c,b){var d=h.event.get(a,c),e;if(this.dom&amp;&amp;(e=this.isLabel(a,c,true)))this.hovered=this.viz.graph.getNode(e.id),this.config.onMouseEnter(this.hovered,
b,d)},onMouseMove:function(a,c,b){a=h.event.get(a,c);if(this.pressed)this.moved=true,this.config.onDragMove(this.pressed,b,a);else if(this.dom)this.config.onMouseMove(this.hovered,b,a);else{if(this.hovered){var c=this.hovered,d=c.nodeFrom?this.etypes[c.getData("type")]:this.ntypes[c.getData("type")];if(d&amp;&amp;d.contains&amp;&amp;d.contains.call(this.fx,c,b.getPos())){this.config.onMouseMove(c,b,a);return}else this.config.onMouseLeave(c,b,a),this.hovered=false}if(this.hovered=b.getNode()||this.config.enableForEdges&amp;&amp;
b.getEdge())this.config.onMouseEnter(this.hovered,b,a);else this.config.onMouseMove(false,b,a)}},onMouseWheel:function(a,c,b){this.config.onMouseWheel(b,h.event.get(a,c))},onMouseDown:function(a,c,b){var d=h.event.get(a,c);if(this.dom){if(a=this.isLabel(a,c))this.pressed=this.viz.graph.getNode(a.id)}else this.pressed=b.getNode()||this.config.enableForEdges&amp;&amp;b.getEdge();this.pressed&amp;&amp;this.config.onDragStart(this.pressed,b,d)},onTouchStart:function(a,c,b){var d=h.event.get(a,c),e;(this.touched=this.dom&amp;&amp;
(e=this.isLabel(a,c))?this.viz.graph.getNode(e.id):b.getNode()||this.config.enableForEdges&amp;&amp;b.getEdge())&amp;&amp;this.config.onTouchStart(this.touched,b,d)},onTouchMove:function(a,c,b){a=h.event.get(a,c);if(this.touched)this.touchMoved=true,this.config.onTouchMove(this.touched,b,a)},onTouchEnd:function(a,c,b){a=h.event.get(a,c);if(this.touched){if(this.touchMoved)this.config.onTouchEnd(this.touched,b,a);else this.config.onTouchCancel(this.touched,b,a);this.touched=this.touchMoved=false}}});E.Classes.Tips=
new j({Implements:[N,O],initializePost:function(){if(document.body){var a=h("_tooltip")||document.createElement("div");a.id="_tooltip";a.className="tip";h.extend(a.style,{position:"absolute",display:"none",zIndex:13E3});document.body.appendChild(a);this.tip=a;this.node=false}},setAsProperty:h.lambda(true),onMouseOut:function(a,c){h.event.get(a,c);if(this.dom&amp;&amp;this.isLabel(a,c,true))this.hide(true);else{for(var b=a.relatedTarget,d=this.canvas.getElement();b&amp;&amp;b.parentNode;){if(d==b.parentNode)return;
b=b.parentNode}this.hide(false)}},onMouseOver:function(a,c){var b;if(this.dom&amp;&amp;(b=this.isLabel(a,c,false)))this.node=this.viz.graph.getNode(b.id),this.config.onShow(this.tip,this.node,b)},onMouseMove:function(a,c,b){this.dom&amp;&amp;this.isLabel(a,c)&amp;&amp;this.setTooltipPosition(h.event.getPos(a,c));if(!this.dom){var d=b.getNode();if(d){if(this.config.force||!this.node||this.node.id!=d.id)this.node=d,this.config.onShow(this.tip,d,b.getContains());this.setTooltipPosition(h.event.getPos(a,c))}else this.hide(true)}},
setTooltipPosition:function(a){var c=this.tip,b=c.style,d=this.config;b.display="";var e=document.body.clientWidth,f=c.offsetWidth,c=c.offsetHeight,g=d.offsetX,d=d.offsetY;b.top=(a.y+d+c&gt;document.body.clientHeight?a.y-c-d:a.y+d)+"px";b.left=(a.x+f+g&gt;e?a.x-f-g:a.x+g)+"px"},hide:function(a){this.tip.style.display="none";a&amp;&amp;this.config.onHide()}});E.Classes.NodeStyles=new j({Implements:[N,O],initializePost:function(){this.fx=this.viz.fx;this.types=this.viz.fx.nodeTypes;this.nStyles=this.config;this.nodeStylesOnHover=
this.nStyles.stylesHover;this.nodeStylesOnClick=this.nStyles.stylesClick;this.hoveredNode=false;this.fx.nodeFxAnimation=new M;this.move=this.down=false},onMouseOut:function(a,c){this.down=this.move=false;if(this.hoveredNode){this.dom&amp;&amp;this.isLabel(a,c,true)&amp;&amp;this.toggleStylesOnHover(this.hoveredNode,false);for(var b=a.relatedTarget,d=this.canvas.getElement();b&amp;&amp;b.parentNode;){if(d==b.parentNode)return;b=b.parentNode}this.toggleStylesOnHover(this.hoveredNode,false);this.hoveredNode=false}},onMouseOver:function(a,
c){var b;if(this.dom&amp;&amp;(b=this.isLabel(a,c,true)))if(b=this.viz.graph.getNode(b.id),!b.selected)this.hoveredNode=b,this.toggleStylesOnHover(this.hoveredNode,true)},onMouseDown:function(a,c,b,d){if(!d){var e;if(this.dom&amp;&amp;(e=this.isLabel(a,c)))this.down=this.viz.graph.getNode(e.id);else if(!this.dom)this.down=b.getNode();this.move=false}},onMouseUp:function(a,c,b,d){if(!d){if(!this.move)this.onClick(b.getNode());this.down=this.move=false}},getRestoredStyles:function(a,c){var b={},d=this["nodeStylesOn"+
c],e;for(e in d)b[e]=a.styles["$"+e];return b},toggleStylesOnHover:function(a,c){this.nodeStylesOnHover&amp;&amp;this.toggleStylesOn("Hover",a,c)},toggleStylesOnClick:function(a,c){this.nodeStylesOnClick&amp;&amp;this.toggleStylesOn("Click",a,c)},toggleStylesOn:function(a,c,b){var d=this.viz;if(b){if(!c.styles)c.styles=h.merge(c.data,{});for(var e in this["nodeStylesOn"+a])b="$"+e,b in c.styles||(c.styles[b]=c.getData(e));d.fx.nodeFx(h.extend({elements:{id:c.id,properties:this["nodeStylesOn"+a]},transition:J.Quart.easeOut,
duration:300,fps:40},this.config))}else a=this.getRestoredStyles(c,a),d.fx.nodeFx(h.extend({elements:{id:c.id,properties:a},transition:J.Quart.easeOut,duration:300,fps:40},this.config))},onClick:function(a){if(a){var c=this.nodeStylesOnClick;if(c)a.selected?(this.toggleStylesOnClick(a,false),delete a.selected):(this.viz.graph.eachNode(function(a){if(a.selected){for(var d in c)a.setData(d,a.styles["$"+d],"end");delete a.selected}}),this.toggleStylesOnClick(a,true),a.selected=true,delete a.hovered,
this.hoveredNode=false)}},onMouseMove:function(a,c,b){if(this.down)this.move=true;if(!this.dom||!this.isLabel(a,c)){var d=this.nodeStylesOnHover;if(d&amp;&amp;!this.dom){if(this.hoveredNode&amp;&amp;(a=this.types[this.hoveredNode.getData("type")])&amp;&amp;a.contains&amp;&amp;a.contains.call(this.fx,this.hoveredNode,b.getPos()))return;b=b.getNode();if((this.hoveredNode||b)&amp;&amp;!b.hovered)if(b&amp;&amp;!b.selected)this.fx.nodeFxAnimation.stopTimer(),this.viz.graph.eachNode(function(a){if(a.hovered&amp;&amp;!a.selected){for(var c in d)a.setData(c,a.styles["$"+
c],"end");delete a.hovered}}),b.hovered=true,this.hoveredNode=b,this.toggleStylesOnHover(b,true);else if(this.hoveredNode&amp;&amp;!this.hoveredNode.selected)this.fx.nodeFxAnimation.stopTimer(),this.toggleStylesOnHover(this.hoveredNode,false),delete this.hoveredNode.hovered,this.hoveredNode=false}}}});E.Classes.Navigation=new j({Implements:[N,O],initializePost:function(){this.pressed=this.pos=false},onMouseWheel:function(a,c,b){this.config.zooming&amp;&amp;(h.event.stop(h.event.get(a,c)),a=1+b*(this.config.zooming/
1E3),this.canvas.scale(a,a))},onMouseDown:function(a,c,b){if(this.config.panning&amp;&amp;!(this.config.panning=="avoid nodes"&amp;&amp;(this.dom?this.isLabel(a,c):b.getNode()))){this.pressed=true;this.pos=b.getPos();var a=this.canvas,c=a.translateOffsetX,b=a.translateOffsetY,d=a.scaleOffsetY;this.pos.x*=a.scaleOffsetX;this.pos.x+=c;this.pos.y*=d;this.pos.y+=b}},onMouseMove:function(a,c,b){if(this.config.panning&amp;&amp;this.pressed&amp;&amp;!(this.config.panning=="avoid nodes"&amp;&amp;(this.dom?this.isLabel(a,c):b.getNode()))){var a=
this.pos,b=b.getPos(),d=this.canvas,e=d.translateOffsetX,f=d.translateOffsetY,c=d.scaleOffsetX,d=d.scaleOffsetY;b.x*=c;b.y*=d;b.x+=e;b.y+=f;e=b.x-a.x;a=b.y-a.y;this.pos=b;this.canvas.translate(e*1/c,a*1/d)}},onMouseUp:function(){if(this.config.panning)this.pressed=false}});var D;(function(){function a(a,c){var f=document.createElement(a),g;for(g in c)typeof c[g]=="object"?h.extend(f[g],c[g]):f[g]=c[g];a=="canvas"&amp;&amp;!b&amp;&amp;G_vmlCanvasManager&amp;&amp;(f=G_vmlCanvasManager.initElement(document.body.appendChild(f)));
return f}var c=typeof HTMLCanvasElement,b=c=="object"||c=="function";$jit.Canvas=D=new j({canvases:[],pos:false,element:false,labelContainer:false,translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(c,b){this.viz=c;this.opt=this.config=b;var f=h.type(b.injectInto)=="string"?b.injectInto:b.injectInto.id,g=b.type,i=f+"-label",k=h(f),l=b.width||k.offsetWidth,n=b.height||k.offsetHeight;this.id=f;var o={injectInto:f,width:l,height:n};this.element=a("div",{id:f+"-canvaswidget",
style:{position:"relative",width:l+"px",height:n+"px"}});this.labelContainer=this.createLabelContainer(b.Label.type,i,o);this.canvases.push(new D.Base[g]({config:h.extend({idSuffix:"-canvas"},o),plot:function(){c.fx.plot()},resize:function(){c.refresh()}}));if(f=b.background)o=new D.Background[f.type](c,h.extend(f,o)),this.canvases.push(new D.Base[g](o));for(g=this.canvases.length;g--;)this.element.appendChild(this.canvases[g].canvas),g&gt;0&amp;&amp;this.canvases[g].plot();this.element.appendChild(this.labelContainer);
k.appendChild(this.element);var t=null,G=this;h.addEvent(window,"scroll",function(){clearTimeout(t);t=setTimeout(function(){G.getPos(true)},500)})},getCtx:function(a){return this.canvases[a||0].getCtx()},getConfig:function(){return this.opt},getElement:function(){return this.element},getSize:function(a){return this.canvases[a||0].getSize()},resize:function(a,c){this.getPos(true);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;for(var b=0,g=this.canvases.length;b&lt;
g;b++)this.canvases[b].resize(a,c);b=this.element.style;b.width=a+"px";b.height=c+"px";if(this.labelContainer)this.labelContainer.style.width=a+"px"},translate:function(a,c,b){this.translateOffsetX+=a*this.scaleOffsetX;this.translateOffsetY+=c*this.scaleOffsetY;for(var g=0,i=this.canvases.length;g&lt;i;g++)this.canvases[g].translate(a,c,b)},scale:function(a,c){var b=this.scaleOffsetX*a,g=this.scaleOffsetY*c,i=this.translateOffsetX*(a-1)/b,h=this.translateOffsetY*(c-1)/g;this.scaleOffsetX=b;this.scaleOffsetY=
g;b=0;for(g=this.canvases.length;b&lt;g;b++)this.canvases[b].scale(a,c,true);this.translate(i,h,false)},getPos:function(a){return a||!this.pos?this.pos=h.getPos(this.getElement()):this.pos},clear:function(a){this.canvases[a||0].clear()},path:function(a,c){var b=this.canvases[0].getCtx();b.beginPath();c(b);b[a]();b.closePath()},createLabelContainer:function(c,b,f){if(c=="HTML"||c=="Native")return a("div",{id:b,style:{overflow:"visible",position:"absolute",top:0,left:0,width:f.width+"px",height:0}});else if(c==
"SVG"){c=document.createElementNS("http://www.w3.org/2000/svg","svg:svg");c.setAttribute("width",f.width);c.setAttribute("height",f.height);var g=c.style;g.position="absolute";g.left=g.top="0px";g=document.createElementNS("http://www.w3.org/2000/svg","svg:g");g.setAttribute("width",f.width);g.setAttribute("height",f.height);g.setAttribute("x",0);g.setAttribute("y",0);g.setAttribute("id",b);c.appendChild(g);return c}}});D.Base={};D.Base["2D"]=new j({translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,
scaleOffsetY:1,initialize:function(a){this.viz=a;this.opt=a.config;this.size=false;this.createCanvas();this.translateToCenter()},createCanvas:function(){var c=this.opt,b=c.width,f=c.height;this.canvas=a("canvas",{id:c.injectInto+c.idSuffix,width:b,height:f,style:{position:"absolute",top:0,left:0,width:b+"px",height:f+"px"}})},getCtx:function(){return!this.ctx?this.ctx=this.canvas.getContext("2d"):this.ctx},getSize:function(){if(this.size)return this.size;var a=this.canvas;return this.size={width:a.width,
height:a.height}},translateToCenter:function(a){var c=this.getSize(),b=a?c.width-a.width-this.translateOffsetX*2:c.width;height=a?c.height-a.height-this.translateOffsetY*2:c.height;c=this.getCtx();a&amp;&amp;c.scale(1/this.scaleOffsetX,1/this.scaleOffsetY);c.translate(b/2,height/2)},resize:function(a,c){var f=this.getSize(),g=this.canvas,i=g.style;this.size=false;g.width=a;g.height=c;i.width=a+"px";i.height=c+"px";b?this.translateToCenter():this.translateToCenter(f);this.translateOffsetX=this.translateOffsetY=
0;this.scaleOffsetX=this.scaleOffsetY=1;this.clear();this.viz.resize(a,c,this)},translate:function(a,c,b){var g=this.scaleOffsetY;this.translateOffsetX+=a*this.scaleOffsetX;this.translateOffsetY+=c*g;this.getCtx().translate(a,c);!b&amp;&amp;this.plot()},scale:function(a,c,b){this.scaleOffsetX*=a;this.scaleOffsetY*=c;this.getCtx().scale(a,c);!b&amp;&amp;this.plot()},clear:function(){var a=this.getSize(),c=this.translateOffsetX,b=this.translateOffsetY,g=this.scaleOffsetX,i=this.scaleOffsetY;this.getCtx().clearRect((-a.width/
2-c)*1/g,(-a.height/2-b)*1/i,a.width*1/g,a.height*1/i)},plot:function(){this.clear();this.viz.plot(this)}});D.Background={};D.Background.Circles=new j({initialize:function(a,c){this.viz=a;this.config=h.merge({idSuffix:"-bkcanvas",levelDistance:100,numberOfCircles:6,CanvasStyles:{},offset:0},c)},resize:function(a,c,b){this.plot(b)},plot:function(a){var a=a.getCtx(),c=this.config,b=c.CanvasStyles,g;for(g in b)a[g]=b[g];g=c.numberOfCircles;c=c.levelDistance;for(b=1;b&lt;=g;b++)a.beginPath(),a.arc(0,0,c*
b,0,2*Math.PI,false),a.stroke(),a.closePath()}})})();var q=function(a,c){this.theta=a||0;this.rho=c||0};$jit.Polar=q;q.prototype={getc:function(a){return this.toComplex(a)},getp:function(){return this},set:function(a){a=a.getp();this.theta=a.theta;this.rho=a.rho},setc:function(a,c){this.rho=Math.sqrt(a*a+c*c);this.theta=Math.atan2(c,a);this.theta&lt;0&amp;&amp;(this.theta+=Math.PI*2)},setp:function(a,c){this.theta=a;this.rho=c},clone:function(){return new q(this.theta,this.rho)},toComplex:function(a){var c=
Math.cos(this.theta)*this.rho,b=Math.sin(this.theta)*this.rho;return a?{x:c,y:b}:new A(c,b)},add:function(a){return new q(this.theta+a.theta,this.rho+a.rho)},scale:function(a){return new q(this.theta,this.rho*a)},equals:function(a){return this.theta==a.theta&amp;&amp;this.rho==a.rho},$add:function(a){this.theta+=a.theta;this.rho+=a.rho;return this},$madd:function(a){this.theta=(this.theta+a.theta)%(Math.PI*2);this.rho+=a.rho;return this},$scale:function(a){this.rho*=a;return this},isZero:function(){var a=
Math.abs;return a(this.theta)&lt;1.0E-4&amp;&amp;a(this.rho)&lt;1.0E-4},interpolate:function(a,c){var b=Math.PI,d=b*2,e=function(a){return a&lt;0?a%d+d:a%d},f=this.theta,g=a.theta,i=Math.abs(f-g);return{theta:i==b?f&gt;g?e(g+(f-d-g)*c):e(g-d+(f-g)*c):i&gt;=b?f&gt;g?e(g+(f-d-g)*c):e(g-d+(f-(g-d))*c):e(g+(f-g)*c),rho:(this.rho-a.rho)*c+a.rho}}};q.KER=new q(0,0);var A=function(a,c){this.x=a||0;this.y=c||0};$jit.Complex=A;A.prototype={getc:function(){return this},getp:function(a){return this.toPolar(a)},set:function(a){a=a.getc(true);
this.x=a.x;this.y=a.y},setc:function(a,c){this.x=a;this.y=c},setp:function(a,c){this.x=Math.cos(a)*c;this.y=Math.sin(a)*c},clone:function(){return new A(this.x,this.y)},toPolar:function(a){var c=this.norm(),b=Math.atan2(this.y,this.x);b&lt;0&amp;&amp;(b+=Math.PI*2);return a?{theta:b,rho:c}:new q(b,c)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(a){return new A(this.x+a.x,this.y+a.y)},prod:function(a){return new A(this.x*a.x-this.y*
a.y,this.y*a.x+this.x*a.y)},conjugate:function(){return new A(this.x,-this.y)},scale:function(a){return new A(this.x*a,this.y*a)},equals:function(a){return this.x==a.x&amp;&amp;this.y==a.y},$add:function(a){this.x+=a.x;this.y+=a.y;return this},$prod:function(a){var c=this.x,b=this.y;this.x=c*a.x-b*a.y;this.y=b*a.x+c*a.y;return this},$conjugate:function(){this.y=-this.y;return this},$scale:function(a){this.x*=a;this.y*=a;return this},$div:function(a){var c=this.x,b=this.y,d=a.squaredNorm();this.x=c*a.x+b*
a.y;this.y=b*a.x-c*a.y;return this.$scale(1/d)},isZero:function(){var a=Math.abs;return a(this.x)&lt;1.0E-4&amp;&amp;a(this.y)&lt;1.0E-4}};var K=function(a,c){return new A(a,c)};A.KER=K(0,0);$jit.Graph=new j({initialize:function(a,c,b,d){var e={klass:A,Node:{}};this.Node=c;this.Edge=b;this.Label=d;this.opt=h.merge(e,a||{});this.nodes={};this.edges={};var f=this;this.nodeList={};for(var g in P)f.nodeList[g]=function(a){return function(){var c=Array.prototype.slice.call(arguments);f.eachNode(function(b){b[a].apply(b,
c)})}}(g)},getNode:function(a){return this.hasNode(a)?this.nodes[a]:false},get:function(a){return this.getNode(a)},getByName:function(a){for(var c in this.nodes){var b=this.nodes[c];if(b.name==a)return b}return false},getAdjacence:function(a,c){return a in this.edges?this.edges[a][c]:false},addNode:function(a){if(!this.nodes[a.id]){var c=this.edges[a.id]={};this.nodes[a.id]=new m.Node(h.extend({id:a.id,name:a.name,data:h.merge(a.data||{},{}),adjacencies:c},this.opt.Node),this.opt.klass,this.Node,
this.Edge,this.Label)}return this.nodes[a.id]},addAdjacence:function(a,c,b){this.hasNode(a.id)||this.addNode(a);this.hasNode(c.id)||this.addNode(c);a=this.nodes[a.id];c=this.nodes[c.id];if(!a.adjacentTo(c)){var d=this.edges[a.id]=this.edges[a.id]||{},e=this.edges[c.id]=this.edges[c.id]||{};d[c.id]=e[a.id]=new m.Adjacence(a,c,b,this.Edge,this.Label);return d[c.id]}return this.edges[a.id][c.id]},removeNode:function(a){if(this.hasNode(a)){delete this.nodes[a];var c=this.edges[a],b;for(b in c)delete this.edges[b][a];
delete this.edges[a]}},removeAdjacence:function(a,c){delete this.edges[a][c];delete this.edges[c][a]},hasNode:function(a){return a in this.nodes},empty:function(){this.nodes={};this.edges={}}});var m=$jit.Graph,P;(function(){var a=function(a,c,b,g,i){var h,b=b||"current";if(b=="current")h=this.data;else if(b=="start")h=this.startData;else if(b=="end")h=this.endData;a="$"+(a?a+"-":"")+c;return g?h[a]:!this.Config.overridable?i[c]||0:a in h?h[a]:a in this.data?this.data[a]:i[c]||0},c=function(a,c,b,
g){var g=g||"current",i;if(g=="current")i=this.data;else if(g=="start")i=this.startData;else if(g=="end")i=this.endData;i["$"+(a?a+"-":"")+c]=b},b=function(a,c){var a="$"+(a?a+"-":""),b=this;h.each(c,function(c){c=a+c;delete b.data[c];delete b.endData[c];delete b.startData[c]})};P={getData:function(c,b,f){return a.call(this,"",c,b,f,this.Config)},setData:function(a,b,f){c.call(this,"",a,b,f)},setDataset:function(a,c){var a=h.splat(a),b;for(b in c)for(var g=0,i=h.splat(c[b]),k=a.length;g&lt;k;g++)this.setData(b,
i[g],a[g])},removeData:function(){b.call(this,"",Array.prototype.slice.call(arguments))},getCanvasStyle:function(c,b,f){return a.call(this,"canvas",c,b,f,this.Config.CanvasStyles)},setCanvasStyle:function(a,b,f){c.call(this,"canvas",a,b,f)},setCanvasStyles:function(a,c){var a=h.splat(a),b;for(b in c)for(var g=0,i=h.splat(c[b]),k=a.length;g&lt;k;g++)this.setCanvasStyle(b,i[g],a[g])},removeCanvasStyle:function(){b.call(this,"canvas",Array.prototype.slice.call(arguments))},getLabelData:function(c,b,f){return a.call(this,
"label",c,b,f,this.Label)},setLabelData:function(a,b,f){c.call(this,"label",a,b,f)},setLabelDataset:function(a,c){var a=h.splat(a),b;for(b in c)for(var g=0,i=h.splat(c[b]),k=a.length;g&lt;k;g++)this.setLabelData(b,i[g],a[g])},removeLabelData:function(){b.call(this,"label",Array.prototype.slice.call(arguments))}}})();m.Node=new j({initialize:function(a,c,b,d,e){c={id:"",name:"",data:{},startData:{},endData:{},adjacencies:{},selected:false,drawn:false,exist:false,angleSpan:{begin:0,end:0},pos:new c,startPos:new c,
endPos:new c};h.extend(this,h.extend(c,a));this.Config=this.Node=b;this.Edge=d;this.Label=e},adjacentTo:function(a){return a.id in this.adjacencies},getAdjacency:function(a){return this.adjacencies[a]},getPos:function(a){a=a||"current";if(a=="current")return this.pos;else if(a=="end")return this.endPos;else if(a=="start")return this.startPos},setPos:function(a,c){var c=c||"current",b;if(c=="current")b=this.pos;else if(c=="end")b=this.endPos;else if(c=="start")b=this.startPos;b.set(a)}});m.Node.implement(P);
m.Adjacence=new j({initialize:function(a,c,b,d,e){this.nodeFrom=a;this.nodeTo=c;this.data=b||{};this.startData={};this.endData={};this.Config=this.Edge=d;this.Label=e}});m.Adjacence.implement(P);m.Util={filter:function(a){if(!a||h.type(a)!="string")return function(){return true};var c=a.split(" ");return function(a){for(var d=0;d&lt;c.length;d++)if(a[c[d]])return false;return true}},getNode:function(a,c){return a.nodes[c]},eachNode:function(a,c,b){var b=this.filter(b),d;for(d in a.nodes)b(a.nodes[d])&amp;&amp;
c(a.nodes[d])},each:function(a,c,b){this.eachNode(a,c,b)},eachAdjacency:function(a,c,b){var d=a.adjacencies,b=this.filter(b),e;for(e in d){var f=d[e];if(b(f)){if(f.nodeFrom!=a){var g=f.nodeFrom;f.nodeFrom=f.nodeTo;f.nodeTo=g}c(f,e)}}},computeLevels:function(a,c,b,d){var b=b||0,e=this.filter(d);this.eachNode(a,function(a){a._flag=false;a._depth=-1},d);a=a.getNode(c);a._depth=b;for(var f=[a];f.length!=0;){var g=f.pop();g._flag=true;this.eachAdjacency(g,function(a){a=a.nodeTo;if(a._flag==false&amp;&amp;e(a)){if(a._depth&lt;
0)a._depth=g._depth+1+b;f.unshift(a)}},d)}},eachBFS:function(a,c,b,d){var e=this.filter(d);this.clean(a);for(var f=[a.getNode(c)];f.length!=0;)a=f.pop(),a._flag=true,b(a,a._depth),this.eachAdjacency(a,function(a){a=a.nodeTo;if(a._flag==false&amp;&amp;e(a))a._flag=true,f.unshift(a)},d)},eachLevel:function(a,c,b,d,e){var f=a._depth,g=this.filter(e),i=this,b=b===false?Number.MAX_VALUE-f:b;(function l(a,c,b){var e=a._depth;e&gt;=c&amp;&amp;e&lt;=b&amp;&amp;g(a)&amp;&amp;d(a,e);e&lt;b&amp;&amp;i.eachAdjacency(a,function(a){a=a.nodeTo;a._depth&gt;e&amp;&amp;l(a,
c,b)})})(a,c+f,b+f)},eachSubgraph:function(a,c,b){this.eachLevel(a,0,false,c,b)},eachSubnode:function(a,c,b){this.eachLevel(a,1,1,c,b)},anySubnode:function(a,c,b){var d=false,c=c||h.lambda(true),e=h.type(c)=="string"?function(a){return a[c]}:c;this.eachSubnode(a,function(a){e(a)&amp;&amp;(d=true)},b);return d},getSubnodes:function(a,c,b){var d=[],c=c||0,e;h.type(c)=="array"?(e=c[0],c=c[1]):(e=c,c=Number.MAX_VALUE-a._depth);this.eachLevel(a,e,c,function(a){d.push(a)},b);return d},getParents:function(a){var c=
[];this.eachAdjacency(a,function(b){b=b.nodeTo;b._depth&lt;a._depth&amp;&amp;c.push(b)});return c},isDescendantOf:function(a,c){if(a.id==c)return true;for(var b=this.getParents(a),d=false,e=0;!d&amp;&amp;e&lt;b.length;e++)d=d||this.isDescendantOf(b[e],c);return d},clean:function(a){this.eachNode(a,function(a){a._flag=false})},getClosestNodeToOrigin:function(a,c,b){return this.getClosestNodeToPos(a,q.KER,c,b)},getClosestNodeToPos:function(a,c,b,d){var e=null,b=b||"current",c=c&amp;&amp;c.getc(true)||A.KER,f=function(a,c){var b=
a.x-c.x,d=a.y-c.y;return b*b+d*d};this.eachNode(a,function(a){e=e==null||f(a.getPos(b).getc(true),c)&lt;f(e.getPos(b).getc(true),c)?a:e},d);return e}};h.each("get,getNode,each,eachNode,computeLevels,eachBFS,clean,getClosestNodeToPos,getClosestNodeToOrigin".split(","),function(a){m.prototype[a]=function(){return m.Util[a].apply(m.Util,[this].concat(Array.prototype.slice.call(arguments)))}});h.each("eachAdjacency,eachLevel,eachSubgraph,eachSubnode,anySubnode,getSubnodes,getParents,isDescendantOf".split(","),
function(a){m.Node.prototype[a]=function(){return m.Util[a].apply(m.Util,[this].concat(Array.prototype.slice.call(arguments)))}});m.Op={options:{type:"nothing",duration:2E3,hideLabels:true,fps:30},initialize:function(a){this.viz=a},removeNode:function(a,c){var b=this.viz,d=h.merge(this.options,b.controller,c),e=h.splat(a),f,g,i;switch(d.type){case "nothing":for(f=0;f&lt;e.length;f++)b.graph.removeNode(e[f]);break;case "replot":this.removeNode(e,{type:"nothing"});b.labels.clearLabels();b.refresh(true);
break;case "fade:seq":case "fade":g=this;for(f=0;f&lt;e.length;f++)i=b.graph.getNode(e[f]),i.setData("alpha",0,"end");b.fx.animate(h.merge(d,{modes:["node-property:alpha"],onComplete:function(){g.removeNode(e,{type:"nothing"});b.labels.clearLabels();b.reposition();b.fx.animate(h.merge(d,{modes:["linear"]}))}}));break;case "fade:con":g=this;for(f=0;f&lt;e.length;f++)i=b.graph.getNode(e[f]),i.setData("alpha",0,"end"),i.ignore=true;b.reposition();b.fx.animate(h.merge(d,{modes:["node-property:alpha","linear"],
onComplete:function(){g.removeNode(e,{type:"nothing"});d.onComplete&amp;&amp;d.onComplete()}}));break;case "iter":g=this;b.fx.sequence({condition:function(){return e.length!=0},step:function(){g.removeNode(e.shift(),{type:"nothing"});b.labels.clearLabels()},onComplete:function(){d.onComplete&amp;&amp;d.onComplete()},duration:Math.ceil(d.duration/e.length)});break;default:this.doError()}},removeEdge:function(a,c){var b=this.viz,d=h.merge(this.options,b.controller,c),e=h.type(a[0])=="string"?[a]:a,f,g,i;switch(d.type){case "nothing":for(f=
0;f&lt;e.length;f++)b.graph.removeAdjacence(e[f][0],e[f][1]);break;case "replot":this.removeEdge(e,{type:"nothing"});b.refresh(true);break;case "fade:seq":case "fade":g=this;for(f=0;f&lt;e.length;f++)(i=b.graph.getAdjacence(e[f][0],e[f][1]))&amp;&amp;i.setData("alpha",0,"end");b.fx.animate(h.merge(d,{modes:["edge-property:alpha"],onComplete:function(){g.removeEdge(e,{type:"nothing"});b.reposition();b.fx.animate(h.merge(d,{modes:["linear"]}))}}));break;case "fade:con":g=this;for(f=0;f&lt;e.length;f++)if(i=b.graph.getAdjacence(e[f][0],
e[f][1]))i.setData("alpha",0,"end"),i.ignore=true;b.reposition();b.fx.animate(h.merge(d,{modes:["edge-property:alpha","linear"],onComplete:function(){g.removeEdge(e,{type:"nothing"});d.onComplete&amp;&amp;d.onComplete()}}));break;case "iter":g=this;b.fx.sequence({condition:function(){return e.length!=0},step:function(){g.removeEdge(e.shift(),{type:"nothing"});b.labels.clearLabels()},onComplete:function(){d.onComplete()},duration:Math.ceil(d.duration/e.length)});break;default:this.doError()}},sum:function(a,
c){var b=this.viz,d=h.merge(this.options,b.controller,c),e=b.root,f;b.root=c.id||b.root;switch(d.type){case "nothing":f=b.construct(a);f.eachNode(function(a){a.eachAdjacency(function(a){b.graph.addAdjacence(a.nodeFrom,a.nodeTo,a.data)})});break;case "replot":b.refresh(true);this.sum(a,{type:"nothing"});b.refresh(true);break;case "fade:seq":case "fade":case "fade:con":that=this;f=b.construct(a);var g=!this.preprocessSum(f)?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];b.reposition();
d.type!="fade:con"?b.fx.animate(h.merge(d,{modes:["linear"],onComplete:function(){b.fx.animate(h.merge(d,{modes:g,onComplete:function(){d.onComplete()}}))}})):(b.graph.eachNode(function(a){a.id!=e&amp;&amp;a.pos.isZero()&amp;&amp;(a.pos.set(a.endPos),a.startPos.set(a.endPos))}),b.fx.animate(h.merge(d,{modes:["linear"].concat(g)})));break;default:this.doError()}},morph:function(a,c,b){var b=b||{},d=this.viz,e=h.merge(this.options,d.controller,c),f=d.root,g;d.root=c.id||d.root;switch(e.type){case "nothing":g=d.construct(a);
g.eachNode(function(a){var c=d.graph.hasNode(a.id);a.eachAdjacency(function(a){var c=!!d.graph.getAdjacence(a.nodeFrom.id,a.nodeTo.id);d.graph.addAdjacence(a.nodeFrom,a.nodeTo,a.data);if(c){var c=d.graph.getAdjacence(a.nodeFrom.id,a.nodeTo.id),b;for(b in a.data||{})c.data[b]=a.data[b]}});if(c){var c=d.graph.getNode(a.id),b;for(b in a.data||{})c.data[b]=a.data[b]}});d.graph.eachNode(function(a){a.eachAdjacency(function(a){g.getAdjacence(a.nodeFrom.id,a.nodeTo.id)||d.graph.removeAdjacence(a.nodeFrom.id,
a.nodeTo.id)});g.hasNode(a.id)||d.graph.removeNode(a.id)});break;case "replot":d.labels.clearLabels(true);this.morph(a,{type:"nothing"});d.refresh(true);d.refresh(true);break;case "fade:seq":case "fade":case "fade:con":that=this;g=d.construct(a);var i="node-property"in b&amp;&amp;h.map(h.splat(b["node-property"]),function(a){return"$"+a});d.graph.eachNode(function(a){var c=g.getNode(a.id);if(c){var c=c.data,b;for(b in c)i&amp;&amp;h.indexOf(i,b)&gt;-1?a.endData[b]=c[b]:a.data[b]=c[b]}else a.setData("alpha",1),a.setData("alpha",
1,"start"),a.setData("alpha",0,"end"),a.ignore=true});d.graph.eachNode(function(a){a.ignore||a.eachAdjacency(function(a){if(!a.nodeFrom.ignore&amp;&amp;!a.nodeTo.ignore){var c=g.getNode(a.nodeFrom.id),a=g.getNode(a.nodeTo.id);c.adjacentTo(a)||(a=d.graph.getAdjacence(c.id,a.id),k=true,a.setData("alpha",1),a.setData("alpha",1,"start"),a.setData("alpha",0,"end"))}})});var k=this.preprocessSum(g),a=!k?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];a[0]+="node-property"in b?":"+h.splat(b["node-property"]).join(":"):
"";a[1]=(a[1]||"edge-property:alpha")+("edge-property"in b?":"+h.splat(b["edge-property"]).join(":"):"");"label-property"in b&amp;&amp;a.push("label-property:"+h.splat(b["label-property"]).join(":"));d.reposition?d.reposition():d.compute("end");d.graph.eachNode(function(a){a.id!=f&amp;&amp;a.pos.getp().equals(q.KER)&amp;&amp;(a.pos.set(a.endPos),a.startPos.set(a.endPos))});d.fx.animate(h.merge(e,{modes:[b.position||"polar"].concat(a),onComplete:function(){d.graph.eachNode(function(a){a.ignore&amp;&amp;d.graph.removeNode(a.id)});
d.graph.eachNode(function(a){a.eachAdjacency(function(a){a.ignore&amp;&amp;d.graph.removeAdjacence(a.nodeFrom.id,a.nodeTo.id)})});e.onComplete()}}))}},contract:function(a,c){var b=this.viz;if(!a.collapsed&amp;&amp;a.anySubnode(h.lambda(true)))c=h.merge(this.options,b.config,c||{},{modes:["node-property:alpha:span","linear"]}),a.collapsed=true,function e(a){a.eachSubnode(function(a){a.ignore=true;a.setData("alpha",0,c.type=="animate"?"end":"current");e(a)})}(a),c.type=="animate"?(b.compute("end"),b.rotated&amp;&amp;b.rotate(b.rotated,
"none",{property:"end"}),function f(c){c.eachSubnode(function(c){c.setPos(a.getPos("end"),"end");f(c)})}(a),b.fx.animate(c)):c.type=="replot"&amp;&amp;b.refresh()},expand:function(a,c){if("collapsed"in a){var b=this.viz,c=h.merge(this.options,b.config,c||{},{modes:["node-property:alpha:span","linear"]});delete a.collapsed;(function e(a){a.eachSubnode(function(a){delete a.ignore;a.setData("alpha",1,c.type=="animate"?"end":"current");e(a)})})(a);c.type=="animate"?(b.compute("end"),b.rotated&amp;&amp;b.rotate(b.rotated,
"none",{property:"end"}),b.fx.animate(c)):c.type=="replot"&amp;&amp;b.refresh()}},preprocessSum:function(a){var c=this.viz;a.eachNode(function(a){c.graph.hasNode(a.id)||(c.graph.addNode(a),a=c.graph.getNode(a.id),a.setData("alpha",0),a.setData("alpha",0,"start"),a.setData("alpha",1,"end"))});var b=false;a.eachNode(function(a){a.eachAdjacency(function(a){var d=c.graph.getNode(a.nodeFrom.id),g=c.graph.getNode(a.nodeTo.id);d.adjacentTo(g)||(a=c.graph.addAdjacence(d,g,a.data),d.startAlpha==d.endAlpha&amp;&amp;g.startAlpha==
g.endAlpha&amp;&amp;(b=true,a.setData("alpha",0),a.setData("alpha",0,"start"),a.setData("alpha",1,"end")))})});return b}};var Q={none:{render:h.empty,contains:h.lambda(false)},circle:{render:function(a,c,b,d){d=d.getCtx();d.beginPath();d.arc(c.x,c.y,b,0,Math.PI*2,true);d.closePath();d[a]()},contains:function(a,c,b){var d=a.x-c.x,a=a.y-c.y;return d*d+a*a&lt;=b*b}},ellipse:{render:function(a,c,b,d,e){var e=e.getCtx(),f=1,g=1,i=1,h=1,l=0;b&gt;d?(l=b/2,g=d/b,h=b/d):(l=d/2,f=b/d,i=d/b);e.save();e.scale(f,g);e.beginPath();
e.arc(c.x*i,c.y*h,l,0,Math.PI*2,true);e.closePath();e[a]();e.restore()},contains:function(a,c,b,d){var e=0,f=1,g=1,i=0,h=0,e=0;b&gt;d?(e=b/2,g=d/b):(e=d/2,f=b/d);i=(a.x-c.x)*(1/f);h=(a.y-c.y)*(1/g);return i*i+h*h&lt;=e*e}},square:{render:function(a,c,b,d){d.getCtx()[a+"Rect"](c.x-b,c.y-b,2*b,2*b)},contains:function(a,c,b){return Math.abs(c.x-a.x)&lt;=b&amp;&amp;Math.abs(c.y-a.y)&lt;=b}},rectangle:{render:function(a,c,b,d,e){e.getCtx()[a+"Rect"](c.x-b/2,c.y-d/2,b,d)},contains:function(a,c,b,d){return Math.abs(c.x-a.x)&lt;=
b/2&amp;&amp;Math.abs(c.y-a.y)&lt;=d/2}},triangle:{render:function(a,c,b,d){var d=d.getCtx(),e=c.x,f=c.y-b,g=e-b,c=c.y+b,b=e+b;d.beginPath();d.moveTo(e,f);d.lineTo(g,c);d.lineTo(b,c);d.closePath();d[a]()},contains:function(a,c,b){return Q.circle.contains(a,c,b)}},star:{render:function(a,c,b,d){var d=d.getCtx(),e=Math.PI/5;d.save();d.translate(c.x,c.y);d.beginPath();d.moveTo(b,0);for(c=0;c&lt;9;c++)d.rotate(e),c%2==0?d.lineTo(b/0.525731*0.200811,0):d.lineTo(b,0);d.closePath();d[a]();d.restore()},contains:function(a,
c,b){return Q.circle.contains(a,c,b)}}},S={line:{render:function(a,c,b){b=b.getCtx();b.beginPath();b.moveTo(a.x,a.y);b.lineTo(c.x,c.y);b.stroke()},contains:function(a,c,b,d){var e=Math.min,f=Math.max,g=e(a.x,c.x),i=f(a.x,c.x),e=e(a.y,c.y),f=f(a.y,c.y);return b.x&gt;=g&amp;&amp;b.x&lt;=i&amp;&amp;b.y&gt;=e&amp;&amp;b.y&lt;=f?Math.abs(c.x-a.x)&lt;=d?true:Math.abs((c.y-a.y)/(c.x-a.x)*(b.x-a.x)+a.y-b.y)&lt;=d:false}},arrow:{render:function(a,c,b,d,e){e=e.getCtx();d&amp;&amp;(d=a,a=c,c=d);d=new A(c.x-a.x,c.y-a.y);d.$scale(b/d.norm());var b=new A(c.x-
d.x,c.y-d.y),f=new A(-d.y/2,d.x/2),d=b.add(f),b=b.$add(f.$scale(-1));e.beginPath();e.moveTo(a.x,a.y);e.lineTo(c.x,c.y);e.stroke();e.beginPath();e.moveTo(d.x,d.y);e.lineTo(b.x,b.y);e.lineTo(c.x,c.y);e.closePath();e.fill()},contains:function(a,c,b,d){return S.line.contains(a,c,b,d)}},hyperline:{render:function(a,c,b,d){function e(a,c){return a&lt;c?a+Math.PI&gt;c?false:true:c+Math.PI&gt;a?true:false}var d=d.getCtx(),f=function(a,c){var b=a.x*c.y-a.y*c.x,d=a.squaredNorm(),e=c.squaredNorm();if(b==0)return{x:0,
y:0,ratio:-1};var f=(a.y*e-c.y*d+a.y-c.y)/b,b=(c.x*d-a.x*e+c.x-a.x)/b,d=-f/2,e=-b/2,h=(f*f+b*b)/4-1;if(h&lt;0)return{x:0,y:0,ratio:-1};h=Math.sqrt(h);return{x:d,y:e,ratio:h&gt;1E3?-1:h,a:f,b:b}}(a,c);f.a&gt;1E3||f.b&gt;1E3||f.ratio&lt;0?(d.beginPath(),d.moveTo(a.x*b,a.y*b),d.lineTo(c.x*b,c.y*b)):(c=Math.atan2(c.y-f.y,c.x-f.x),a=Math.atan2(a.y-f.y,a.x-f.x),e=e(c,a),d.beginPath(),d.arc(f.x*b,f.y*b,f.ratio*b,c,a,e));d.stroke()},contains:h.lambda(false)}};m.Plot={initialize:function(a,c){this.viz=a;this.config=a.config;
this.node=a.config.Node;this.edge=a.config.Edge;this.animation=new M;this.nodeTypes=new c.Plot.NodeTypes;this.edgeTypes=new c.Plot.EdgeTypes;this.labels=a.labels},nodeHelper:Q,edgeHelper:S,Interpolator:{map:{border:"color",color:"color",width:"number",height:"number",dim:"number",alpha:"number",lineWidth:"number",angularWidth:"number",span:"number",valueArray:"array-number",dimArray:"array-number"},canvas:{globalAlpha:"number",fillStyle:"color",strokeStyle:"color",lineWidth:"number",shadowBlur:"number",
shadowColor:"color",shadowOffsetX:"number",shadowOffsetY:"number",miterLimit:"number"},label:{size:"number",color:"color"},compute:function(a,c,b){return a+(c-a)*b},moebius:function(a,c,b,d){c=d.scale(-b);if(c.norm()&lt;1){var b=c.x,d=c.y,e=a.startPos.getc().moebiusTransformation(c);a.pos.setc(e.x,e.y);c.x=b;c.y=d}},linear:function(a,c,b){var c=a.startPos.getc(true),d=a.endPos.getc(true);a.pos.setc(this.compute(c.x,d.x,b),this.compute(c.y,d.y,b))},polar:function(a,c,b){c=a.startPos.getp(true);b=a.endPos.getp().interpolate(c,
b);a.pos.setp(b.theta,b.rho)},number:function(a,c,b,d,e){var f=a[d](c,"start"),d=a[d](c,"end");a[e](c,this.compute(f,d,b))},color:function(a,c,b,d,e){var f=h.hexToRgb(a[d](c,"start")),d=h.hexToRgb(a[d](c,"end")),g=this.compute,b=h.rgbToHex([parseInt(g(f[0],d[0],b)),parseInt(g(f[1],d[1],b)),parseInt(g(f[2],d[2],b))]);a[e](c,b)},"array-number":function(a,c,b,d,e){for(var f=a[d](c,"start"),d=a[d](c,"end"),g=[],i=0,h=f.length;i&lt;h;i++){var l=f[i],n=d[i];if(l.length){for(var o=0,t=l.length,G=[];o&lt;t;o++)G.push(this.compute(l[o],
n[o],b));g.push(G)}else g.push(this.compute(l,n,b))}a[e](c,g)},node:function(a,c,b,d,e,f){d=this[d];if(c)for(var g=c.length,i=0;i&lt;g;i++){var h=c[i];this[d[h]](a,h,b,e,f)}else for(h in d)this[d[h]](a,h,b,e,f)},edge:function(a,c,b,d,e,f){var a=a.adjacencies,g;for(g in a)this.node(a[g],c,b,d,e,f)},"node-property":function(a,c,b){this.node(a,c,b,"map","getData","setData")},"edge-property":function(a,c,b){this.edge(a,c,b,"map","getData","setData")},"label-property":function(a,c,b){this.node(a,c,b,"label",
"getLabelData","setLabelData")},"node-style":function(a,c,b){this.node(a,c,b,"canvas","getCanvasStyle","setCanvasStyle")},"edge-style":function(a,c,b){this.edge(a,c,b,"canvas","getCanvasStyle","setCanvasStyle")}},sequence:function(a){var c=this,a=h.merge({condition:h.lambda(false),step:h.empty,onComplete:h.empty,duration:200},a||{}),b=setInterval(function(){a.condition()?a.step():(clearInterval(b),a.onComplete());c.viz.refresh(true)},a.duration)},prepare:function(a){var c=this.viz.graph,b={"node-property":{getter:"getData",
setter:"setData"},"edge-property":{getter:"getData",setter:"setData"},"node-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"},"edge-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"}},d={};if(h.type(a)=="array")for(var e=0,f=a.length;e&lt;f;e++){var g=a[e].split(":");d[g.shift()]=g}else for(e in a)e=="position"?d[a.position]=[]:d[e]=h.splat(a[e]);c.eachNode(function(a){a.startPos.set(a.pos);h.each(["node-property","node-style"],function(c){if(c in d)for(var e=d[c],f=0,g=e.length;f&lt;g;f++)a[b[c].setter](e[f],
a[b[c].getter](e[f]),"start")});h.each(["edge-property","edge-style"],function(c){if(c in d){var e=d[c];a.eachAdjacency(function(a){for(var d=0,f=e.length;d&lt;f;d++)a[b[c].setter](e[d],a[b[c].getter](e[d]),"start")})}})});return d},animate:function(a,c){var a=h.merge(this.viz.config,a||{}),b=this,d=this.viz.graph,e=this.Interpolator,f=a.type==="nodefx"?this.nodeFxAnimation:this.animation,g=this.prepare(a.modes);a.hideLabels&amp;&amp;this.labels.hideLabels(true);f.setOptions(h.extend(a,{$animating:false,compute:function(f){d.eachNode(function(a){for(var b in g)e[b](a,
g[b],f,c)});b.plot(a,this.$animating,f);this.$animating=true},complete:function(){a.hideLabels&amp;&amp;b.labels.hideLabels(false);b.plot(a);a.onComplete()}})).start()},nodeFx:function(a){var c=this.viz,b=c.graph,d=this.nodeFxAnimation,e=h.merge(this.viz.config,{elements:{id:false,properties:{}},reposition:false}),a=h.merge(e,a||{},{onBeforeCompute:h.empty,onAfterCompute:h.empty});d.stopTimer();var f=a.elements.properties;a.elements.id?(d=h.splat(a.elements.id),h.each(d,function(a){if(a=b.getNode(a))for(var c in f)a.setData(c,
f[c],"end")})):b.eachNode(function(a){for(var c in f)a.setData(c,f[c],"end")});var d=[],g;for(g in f)d.push(g);g=["node-property:"+d.join(":")];a.reposition&amp;&amp;(g.push("linear"),c.compute("end"));this.animate(h.merge(a,{modes:g,type:"nodefx"}))},plot:function(a,c){var b=this.viz,d=b.graph,e=b.canvas,b=b.root,f=this;e.getCtx();a=a||this.viz.controller;a.clearCanvas&amp;&amp;e.clear();if(b=d.getNode(b)){var g=!!b.visited;d.eachNode(function(b){var d=b.getData("alpha");b.eachAdjacency(function(d){var h=d.nodeTo;
!!h.visited===g&amp;&amp;b.drawn&amp;&amp;h.drawn&amp;&amp;(!c&amp;&amp;a.onBeforePlotLine(d),f.plotLine(d,e,c),!c&amp;&amp;a.onAfterPlotLine(d))});b.drawn&amp;&amp;(!c&amp;&amp;a.onBeforePlotNode(b),f.plotNode(b,e,c),!c&amp;&amp;a.onAfterPlotNode(b));!f.labelsHidden&amp;&amp;a.withLabels&amp;&amp;(b.drawn&amp;&amp;d&gt;=0.95?f.labels.plotLabel(e,b,a):f.labels.hideLabel(b,false));b.visited=!g})}},plotTree:function(a,c,b){var d=this,e=this.viz.canvas;e.getCtx();var f=a.getData("alpha");a.eachSubnode(function(f){if(c.plotSubtree(a,f)&amp;&amp;f.exist&amp;&amp;f.drawn){var i=a.getAdjacency(f.id);!b&amp;&amp;c.onBeforePlotLine(i);
d.plotLine(i,e,b);!b&amp;&amp;c.onAfterPlotLine(i);d.plotTree(f,c,b)}});a.drawn?(!b&amp;&amp;c.onBeforePlotNode(a),this.plotNode(a,e,b),!b&amp;&amp;c.onAfterPlotNode(a),!c.hideLabels&amp;&amp;c.withLabels&amp;&amp;f&gt;=0.95?this.labels.plotLabel(e,a,c):this.labels.hideLabel(a,false)):this.labels.hideLabel(a,true)},plotNode:function(a,c,b){var d=a.getData("type"),e=this.node.CanvasStyles;if(d!="none"){var f=a.getData("lineWidth"),g=a.getData("color"),i=a.getData("alpha"),h=c.getCtx();h.save();h.lineWidth=f;h.fillStyle=h.strokeStyle=g;h.globalAlpha=
i;for(var l in e)h[l]=a.getCanvasStyle(l);this.nodeTypes[d].render.call(this,a,c,b);h.restore()}},plotLine:function(a,c,b){var d=a.getData("type"),e=this.edge.CanvasStyles;if(d!="none"){var f=a.getData("lineWidth"),g=a.getData("color"),i=c.getCtx(),h=a.nodeFrom,l=a.nodeTo;i.save();i.lineWidth=f;i.fillStyle=i.strokeStyle=g;i.globalAlpha=Math.min(h.getData("alpha"),l.getData("alpha"),a.getData("alpha"));for(var n in e)i[n]=a.getCanvasStyle(n);this.edgeTypes[d].render.call(this,a,c,b);i.restore()}}};
m.Plot3D=h.merge(m.Plot,{Interpolator:{linear:function(a,c,b){var c=a.startPos.getc(true),d=a.endPos.getc(true);a.pos.setc(this.compute(c.x,d.x,b),this.compute(c.y,d.y,b),this.compute(c.z,d.z,b))}},plotNode:function(a,c){a.getData("type")!="none"&amp;&amp;this.plotElement(a,c,{getAlpha:function(){return a.getData("alpha")}})},plotLine:function(a,c){a.getData("type")!="none"&amp;&amp;this.plotElement(a,c,{getAlpha:function(){return Math.min(a.nodeFrom.getData("alpha"),a.nodeTo.getData("alpha"),a.getData("alpha"))}})},
plotElement:function(a,c,b){var d=c.getCtx(),e=new Matrix4,f=c.config.Scene.Lighting,g=c.canvases[0],c=g.program,g=g.camera;if(!a.geometry)a.geometry=new (O3D[a.getData("type")]);a.geometry.update(a);if(!a.webGLVertexBuffer){for(var i=[],k=[],l=[],n=0,o=a.geometry,t=0,G=o.vertices,o=o.faces,U=o.length;t&lt;U;t++){var p=o[t],j=G[p.a],m=G[p.b],s=G[p.c],H=p.d?G[p.d]:false,p=p.normal;i.push(j.x,j.y,j.z);i.push(m.x,m.y,m.z);i.push(s.x,s.y,s.z);H&amp;&amp;i.push(H.x,H.y,H.z);l.push(p.x,p.y,p.z);l.push(p.x,p.y,p.z);
l.push(p.x,p.y,p.z);H&amp;&amp;l.push(p.x,p.y,p.z);k.push(n,n+1,n+2);H?(k.push(n,n+2,n+3),n+=4):n+=3}a.webGLVertexBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a.webGLVertexBuffer);d.bufferData(d.ARRAY_BUFFER,new Float32Array(i),d.STATIC_DRAW);a.webGLFaceBuffer=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a.webGLFaceBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,new Uint16Array(k),d.STATIC_DRAW);a.webGLFaceCount=k.length;a.webGLNormalBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a.webGLNormalBuffer);
d.bufferData(d.ARRAY_BUFFER,new Float32Array(l),d.STATIC_DRAW)}e.multiply(g.matrix,a.geometry.matrix);d.uniformMatrix4fv(c.viewMatrix,false,e.flatten());d.uniformMatrix4fv(c.projectionMatrix,false,g.projectionMatrix.flatten());e=Matrix4.makeInvert(e);e.$transpose();d.uniformMatrix4fv(c.normalMatrix,false,e.flatten());e=h.hexToRgb(a.getData("color"));e.push(b.getAlpha());d.uniform4f(c.color,e[0]/255,e[1]/255,e[2]/255,e[3]);d.uniform1i(c.enableLighting,f.enable);if(f.enable){if(f.ambient)b=f.ambient,
d.uniform3f(c.ambientColor,b[0],b[1],b[2]);if(f.directional)f=f.directional,e=f.color,f=f.direction,f=(new Vector3(f.x,f.y,f.z)).normalize().$scale(-1),d.uniform3f(c.lightingDirection,f.x,f.y,f.z),d.uniform3f(c.directionalColor,e[0],e[1],e[2])}d.bindBuffer(d.ARRAY_BUFFER,a.webGLVertexBuffer);d.vertexAttribPointer(c.position,3,d.FLOAT,false,0,0);d.bindBuffer(d.ARRAY_BUFFER,a.webGLNormalBuffer);d.vertexAttribPointer(c.normal,3,d.FLOAT,false,0,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a.webGLFaceBuffer);
d.drawElements(d.TRIANGLES,a.webGLFaceCount,d.UNSIGNED_SHORT,0)}});m.Label={};m.Label.Native=new j({initialize:function(a){this.viz=a},plotLabel:function(a,c,b){var d=a.getCtx();c.pos.getc(true);d.font=c.getLabelData("style")+" "+c.getLabelData("size")+"px "+c.getLabelData("family");d.textAlign=c.getLabelData("textAlign");d.fillStyle=d.strokeStyle=c.getLabelData("color");d.textBaseline=c.getLabelData("textBaseline");this.renderLabel(a,c,b)},renderLabel:function(a,c){var b=a.getCtx(),d=c.pos.getc(true);
b.fillText(c.name,d.x,d.y+c.getData("height")/2)},hideLabel:h.empty,hideLabels:h.empty});m.Label.DOM=new j({labelsHidden:false,labelContainer:false,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(a){return a in this.labels&amp;&amp;this.labels[a]!=null?this.labels[a]:this.labels[a]=document.getElementById(a)},hideLabels:function(a){this.getLabelContainer().style.display=a?"none":
"";this.labelsHidden=a},clearLabels:function(a){for(var c in this.labels)if(a||!this.viz.graph.hasNode(c))this.disposeLabel(c),delete this.labels[c]},disposeLabel:function(a){(a=this.getLabel(a))&amp;&amp;a.parentNode&amp;&amp;a.parentNode.removeChild(a)},hideLabel:function(a,c){var a=h.splat(a),b=c?"":"none",d=this;h.each(a,function(a){if(a=d.getLabel(a.id))a.style.display=b})},fitsInCanvas:function(a,c){var b=c.getSize();return a.x&gt;=b.width||a.x&lt;0||a.y&gt;=b.height||a.y&lt;0?false:true}});m.Label.HTML=new j({Implements:m.Label.DOM,
plotLabel:function(a,c,b){var a=c.id,d=this.getLabel(a);if(!d&amp;&amp;!(d=document.getElementById(a))){var d=document.createElement("div"),e=this.getLabelContainer();d.id=a;d.className="node";d.style.position="absolute";b.onCreateLabel(d,c);e.appendChild(d);this.labels[c.id]=d}this.placeLabel(d,c,b)}});m.Label.SVG=new j({Implements:m.Label.DOM,plotLabel:function(a,c,b){var a=c.id,d=this.getLabel(a);if(!d&amp;&amp;!(d=document.getElementById(a))){var d=document.createElementNS("http://www.w3.org/2000/svg","svg:text"),
e=document.createElementNS("http://www.w3.org/2000/svg","svg:tspan");d.appendChild(e);e=this.getLabelContainer();d.setAttribute("id",a);d.setAttribute("class","node");e.appendChild(d);b.onCreateLabel(d,c);this.labels[c.id]=d}this.placeLabel(d,c,b)}});m.Geom=new j({initialize:function(a){this.viz=a;this.config=a.config;this.node=a.config.Node;this.edge=a.config.Edge},translate:function(a,c){c=h.splat(c);this.viz.graph.eachNode(function(b){h.each(c,function(c){b.getPos(c).$add(a)})})},setRightLevelToShow:function(a,
c,b){var d=this.getRightLevelToShow(a,c),e=this.viz.labels,f=h.merge({execShow:true,execHide:true,onHide:h.empty,onShow:h.empty},b||{});a.eachLevel(0,this.config.levelsToShow,function(c){if(c._depth-a._depth&gt;d){if(f.onHide(c),f.execHide)c.drawn=false,c.exist=false,e.hideLabel(c,false)}else if(f.onShow(c),f.execShow)c.exist=true});a.drawn=true},getRightLevelToShow:function(a,c){var b=this.config,d=b.levelsToShow;if(!b.constrained)return d;for(;!this.treeFitsInCanvas(a,c,d)&amp;&amp;d&gt;1;)d--;return d}});var F=
{construct:function(a){var c=h.type(a)=="array",b=new m(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);c?function(a,c){for(var b=function(b){for(var f=0,g=c.length;f&lt;g;f++)if(c[f].id==b)return c[f];return a.addNode({id:b,name:b})},g=0,i=c.length;g&lt;i;g++){a.addNode(c[g]);var k=c[g].adjacencies;if(k)for(var l=0,n=k.length;l&lt;n;l++){var o=k[l],t={};if(typeof k[l]!="string")t=h.merge(o.data,{}),o=o.nodeTo;a.addAdjacence(c[g],b(o),t)}}}(b,a):function(a,c){a.addNode(c);if(c.children)for(var b=
0,g=c.children;b&lt;g.length;b++)a.addAdjacence(c,g[b]),arguments.callee(a,g[b])}(b,a);return b},loadJSON:function(a,c){this.json=a;this.labels&amp;&amp;this.labels.clearLabels&amp;&amp;this.labels.clearLabels(true);this.graph=this.construct(a);this.root=h.type(a)!="array"?a.id:a[c?c:0].id},toJSON:function(a){if((a||"tree")=="tree")var c={},c=function e(a){var c={};c.id=a.id;c.name=a.name;c.data=a.data;var b=[];a.eachSubnode(function(a){b.push(e(a))});c.children=b;return c}(this.graph.getNode(this.root));else{var c=
[],b=!!this.graph.getNode(this.root).visited;this.graph.eachNode(function(a){var f={};f.id=a.id;f.name=a.name;f.data=a.data;var g=[];a.eachAdjacency(function(a){var c=a.nodeTo;if(!!c.visited===b){var e={};e.nodeTo=c.id;e.data=a.data;g.push(e)}});f.adjacencies=g;c.push(f);a.visited=!b})}return c}},B=$jit.Layouts={},R={label:null,compute:function(a,c,b){this.initializeLabel(b);var d=this.label,e=d.style;a.eachNode(function(a){var c=a.getData("autoWidth"),b=a.getData("autoHeight");if(c||b){delete a.data.$width;
delete a.data.$height;delete a.data.$dim;var k=a.getData("width"),l=a.getData("height");e.width=c?"auto":k+"px";e.height=b?"auto":l+"px";d.innerHTML=a.name;c=d.offsetWidth;b=d.offsetHeight;k=a.getData("type");h.indexOf(["circle","square","triangle","star"],k)===-1?(a.setData("width",c),a.setData("height",b)):(c=c&gt;b?c:b,a.setData("width",c),a.setData("height",c),a.setData("dim",c))}})},initializeLabel:function(a){if(!this.label)this.label=document.createElement("div"),document.body.appendChild(this.label);
this.setLabelStyles(a)},setLabelStyles:function(){h.extend(this.label.style,{visibility:"hidden",position:"absolute",width:"auto",height:"auto"});this.label.className="jit-autoadjust-label"}};B.Tree=function(){function a(a,c,b,d,e){var f=c.Node,g=c.multitree;if(f.overridable){var i=-1,h=-1;a.eachNode(function(a){if(a._depth==b&amp;&amp;(!g||"$orn"in a.data&amp;&amp;a.data.$orn==d)){var c=a.getData("width",e),a=a.getData("height",e);i=i&lt;c?c:i;h=h&lt;a?a:h}});return{width:i&lt;0?f.width:i,height:h&lt;0?f.height:h}}else return f}
function c(a,c,b,d){a.getPos(c)[d=="left"||d=="right"?"y":"x"]+=b}function b(a,c){var b=[];h.each(a,function(a){a=n.call(a);a[0]+=c;a[1]+=c;b.push(a)});return b}function d(a,c){if(a.length==0)return c;if(c.length==0)return a;var b=a.shift(),e=c.shift();return[[b[0],e[1]]].concat(d(a,c))}function e(a,c){c=c||[];if(a.length==0)return c;var b=a.pop();return e(a,d(b,c))}function f(a,c,b,d,e){if(a.length&lt;=e||c.length&lt;=e)return 0;var g=a[e][1],i=c[e][0];return Math.max(f(a,c,b,d,++e)+b,g-i+d)}function g(a,
c,e){function g(a,i,h){if(i.length&lt;=h)return[];var k=i[h],l=f(a,k,c,e,0);return[l].concat(g(d(a,b(k,l)),i,++h))}return g([],a,0)}function i(a,c,e){function g(a,i,h){if(i.length&lt;=h)return[];var k=i[h],l=-f(k,a,c,e,0);return[l].concat(g(d(b(k,l),a),i,++h))}a=n.call(a);return g([],a.reverse(),0).reverse()}function k(a,c,b,d){var e=g(a,c,b),a=i(a,c,b);d=="left"?a=e:d=="right"&amp;&amp;(e=a);d=0;for(c=[];d&lt;e.length;d++)c[d]=(e[d]+a[d])/2;return c}function l(d,f,g,i,h){function l(f,t,j){var m=f.getData(v,g),s=
[],x=[],H=false,A=(t||f.getData(u,g))+i.levelDistance;f.eachSubnode(function(c){if(c.exist&amp;&amp;(!n||"$orn"in c.data&amp;&amp;c.data.$orn==h))H||(H=a(d,i,c._depth,h,g)),c=l(c,H[u],j+A),s.push(c.tree),x.push(c.extent)});for(var t=k(x,V,C,r),q=0,B=[];q&lt;s.length;q++)c(s[q],g,t[q],h),B.push(b(x[q],t[q]));m=[[-m/2,m/2]].concat(e(B));f.getPos(g)[y]=0;h=="top"||h=="left"?f.getPos(g)[I]=j:f.getPos(g)[I]=-j;return{tree:f,extent:m}}var n=i.multitree,j=["x","y"],m=["width","height"],x=+(h=="left"||h=="right"),y=j[x],I=
j[1-x],v=m[x],u=m[1-x],C=i.siblingOffset,V=i.subtreeOffset,r=i.align;l(f,false,0)}var n=Array.prototype.slice;return new j({compute:function(a,c){var b=a||"start",d=this.graph.getNode(this.root);h.extend(d,{drawn:true,exist:true,selected:true});R.compute(this.graph,b,this.config);(c||!("_depth"in d))&amp;&amp;this.graph.computeLevels(this.root,0,"ignore");this.computePositions(d,b)},computePositions:function(a,c){var b=this.config,d=b.multitree,e=b.align,f=e!=="center"&amp;&amp;b.indent,b=b.orientation,g=this;h.each(d?
["top","right","bottom","left"]:[b],function(b){l(g.graph,a,c,g.config,b,c);var i=["x","y"][+(b=="left"||b=="right")];(function y(a){a.eachSubnode(function(g){if(g.exist&amp;&amp;(!d||"$orn"in g.data&amp;&amp;g.data.$orn==b))g.getPos(c)[i]+=a.getPos(c)[i],f&amp;&amp;(g.getPos(c)[i]+=e=="left"?f:-f),y(g)})})(a)})}})}();$jit.ST=function(){function a(a){a=a||this.clickedNode;if(!this.config.constrained)return[];var c=this.geom,f=this.canvas,g=a._depth,i=[];this.graph.eachNode(function(c){c.exist&amp;&amp;!c.selected&amp;&amp;(c.isDescendantOf(a.id)?
c._depth&lt;=g&amp;&amp;i.push(c):i.push(c))});c=c.getRightLevelToShow(a,f);a.eachLevel(c,c,function(a){a.exist&amp;&amp;!a.selected&amp;&amp;i.push(a)});for(c=0;c&lt;b.length;c++)f=this.graph.getNode(b[c]),f.isDescendantOf(a.id)||i.push(f);return i}function c(){var a=[],c=this.config;this.clickedNode.eachLevel(0,c.levelsToShow,function(b){c.multitree&amp;&amp;!("$orn"in b.data)&amp;&amp;b.anySubnode(function(a){return a.exist&amp;&amp;!a.drawn})?a.push(b):b.drawn&amp;&amp;!b.anySubnode("drawn")&amp;&amp;a.push(b)});return a}var b=[];return new j({Implements:[F,E,B.Tree],
initialize:function(a){var c=$jit.ST,a=this.controller=this.config=h.merge(u("Canvas","Fx","Tree","Node","Edge","Controller","Tips","NodeStyles","Events","Navigation","Label"),{levelsToShow:2,levelDistance:30,constrained:true,Node:{type:"rectangle"},duration:700,offsetX:0,offsetY:0},a);if(a.useCanvas)this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label";else{if(a.background)a.background=h.merge({type:"Circles"},a.background);this.canvas=new D(this,a);this.config.labelContainer=
(typeof a.injectInto=="string"?a.injectInto:a.injectInto.id)+"-label"}this.graphOptions={klass:A};this.graph=new m(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new c.Label[a.Label.type](this);this.fx=new c.Plot(this,c);this.op=new c.Op(this);this.group=new c.Group(this);this.geom=new c.Geom(this);this.clickedNode=null;this.initializeExtras()},plot:function(){this.fx.plot(this.controller)},switchPosition:function(a,c,b){var g=this.geom,i=this.fx,h=this;if(!i.busy)i.busy=true,this.contract({onComplete:function(){g.switchOrientation(a);
h.compute("end",false);i.busy=false;if(c=="animate")h.onClick(h.clickedNode.id,b);else c=="replot"&amp;&amp;h.select(h.clickedNode.id,b)}},a)},switchAlignment:function(a,c,b){this.config.align=a;if(c=="animate")this.select(this.clickedNode.id,b);else if(c=="replot")this.onClick(this.clickedNode.id,b)},addNodeInPath:function(a){b.push(a);this.select(this.clickedNode&amp;&amp;this.clickedNode.id||this.root)},clearNodesInPath:function(){b.length=0;this.select(this.clickedNode&amp;&amp;this.clickedNode.id||this.root)},refresh:function(){this.reposition();
this.select(this.clickedNode&amp;&amp;this.clickedNode.id||this.root)},reposition:function(){this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(this.clickedNode,this.canvas);this.graph.eachNode(function(a){if(a.exist)a.drawn=true});this.compute("end")},requestNodes:function(a,c){var b=h.merge(this.controller,c),g=this.config.levelsToShow;if(b.request){var i=[],k=a._depth;a.eachLevel(0,g,function(a){if(a.drawn&amp;&amp;!a.anySubnode())i.push(a),a._level=g-(a._depth-k)});this.group.requestNodes(i,
b)}else b.onComplete()},contract:function(c,b){var f=this.config.orientation,g=this.geom,i=this.group;b&amp;&amp;g.switchOrientation(b);var k=a.call(this);b&amp;&amp;g.switchOrientation(f);i.contract(k,h.merge(this.controller,c))},move:function(a,c){this.compute("end",false);var b=c.Move,g={x:b.offsetX,y:b.offsetY};b.enable&amp;&amp;this.geom.translate(a.endPos.add(g).$scale(-1),"end");this.fx.animate(h.merge(this.controller,{modes:["linear"]},c))},expand:function(a,b){this.group.expand(c.call(this,a),h.merge(this.controller,
b))},selectPath:function(a){function c(a){if(!(a==null||a.selected))a.selected=true,h.each(f.group.getSiblings([a])[a.id],function(a){a.exist=true;a.drawn=true}),a=a.getParents(),a=a.length&gt;0?a[0]:null,c(a)}var f=this;this.graph.eachNode(function(a){a.selected=false});for(var g=0,a=[a.id].concat(b);g&lt;a.length;g++)c(this.graph.getNode(a[g]))},setRoot:function(a,c,b){function g(){if(this.config.multitree&amp;&amp;n.data.$orn){var c={left:"right",right:"left",top:"bottom",bottom:"top"}[n.data.$orn];l.data.$orn=
c;(function G(b){b.eachSubnode(function(b){if(b.id!=a)b.data.$orn=c,G(b)})})(l);delete n.data.$orn}this.root=a;this.clickedNode=n;this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(n,h,{execHide:false,onShow:function(a){if(!a.drawn)a.drawn=true,a.setData("alpha",1,"end"),a.setData("alpha",0),a.pos.setc(n.pos.x,n.pos.y)}});this.compute("end");this.busy=true;this.fx.animate({modes:["linear","node-property:alpha"],onComplete:function(){i.busy=false;i.onClick(a,{onComplete:function(){b&amp;&amp;
b.onComplete()}})}})}if(!this.busy){this.busy=true;var i=this,h=this.canvas,l=this.graph.getNode(this.root),n=this.graph.getNode(a);delete l.data.$orns;c=="animate"?(g.call(this),i.selectPath(n)):c=="replot"&amp;&amp;(g.call(this),this.select(this.root))}},addSubtree:function(a,c,b){c=="replot"?this.op.sum(a,h.extend({type:"replot"},b||{})):c=="animate"&amp;&amp;this.op.sum(a,h.extend({type:"fade:seq"},b||{}))},removeSubtree:function(a,c,b,g){var i=[];this.graph.getNode(a).eachLevel(+!c,false,function(a){i.push(a.id)});
b=="replot"?this.op.removeNode(i,h.extend({type:"replot"},g||{})):b=="animate"&amp;&amp;this.op.removeNode(i,h.extend({type:"fade:seq"},g||{}))},select:function(b,e){var f=this.group,g=this.geom,i=this.graph.getNode(b),k=this.canvas;this.graph.getNode(this.root);var l=h.merge(this.controller,e),n=this;l.onBeforeCompute(i);this.selectPath(i);this.clickedNode=i;this.requestNodes(i,{onComplete:function(){f.hide(f.prepare(a.call(n)),l);g.setRightLevelToShow(i,k);n.compute("current");n.graph.eachNode(function(a){var c=
a.pos.getc(true);a.startPos.setc(c.x,c.y);a.endPos.setc(c.x,c.y);a.visited=false});n.geom.translate(i.endPos.add({x:l.offsetX,y:l.offsetY}).$scale(-1),["start","current","end"]);f.show(c.call(n));n.plot();l.onAfterCompute(n.clickedNode);l.onComplete()}})},onClick:function(a,c){var b=this.canvas,g=this,i=this.geom,k=this.config,l=h.merge(this.controller,{Move:{enable:true,offsetX:k.offsetX||0,offsetY:k.offsetY||0},setRightLevelToShowConfig:false,onBeforeRequest:h.empty,onBeforeContract:h.empty,onBeforeMove:h.empty,
onBeforeExpand:h.empty},c);if(!this.busy){this.busy=true;var n=this.graph.getNode(a);this.selectPath(n,this.clickedNode);this.clickedNode=n;l.onBeforeCompute(n);l.onBeforeRequest(n);this.requestNodes(n,{onComplete:function(){l.onBeforeContract(n);g.contract({onComplete:function(){i.setRightLevelToShow(n,b,l.setRightLevelToShowConfig);l.onBeforeMove(n);g.move(n,{Move:l.Move,onComplete:function(){l.onBeforeExpand(n);g.expand(n,{onComplete:function(){g.busy=false;l.onAfterCompute(a);l.onComplete()}})}})}})}})}}})}();
$jit.ST.$extend=true;$jit.ST.Op=new j({Implements:m.Op});$jit.ST.Group=new j({initialize:function(a){this.viz=a;this.canvas=a.canvas;this.config=a.config;this.animation=new M;this.nodes=null},requestNodes:function(a,c){var b=0,d=a.length,e=this.viz;if(d==0)c.onComplete();for(var f=0;f&lt;d;f++)c.request(a[f].id,a[f]._level,{onComplete:function(a,f){if(f&amp;&amp;f.children)f.id=a,e.op.sum(f,{type:"nothing"});++b==d&amp;&amp;(e.graph.computeLevels(e.root,0),c.onComplete())}})},contract:function(a,c){var b=this,a=this.prepare(a);
this.animation.setOptions(h.merge(c,{$animating:false,compute:function(a){a==1&amp;&amp;(a=0.99);b.plotStep(1-a,c,this.$animating);this.$animating="contract"},complete:function(){b.hide(a,c)}})).start()},hide:function(a,c){for(var b=0;b&lt;a.length;b++)a[b].eachLevel(1,false,function(a){a.exist&amp;&amp;h.extend(a,{drawn:false,exist:false})});c.onComplete()},expand:function(a,c){var b=this;this.show(a);this.animation.setOptions(h.merge(c,{$animating:false,compute:function(a){b.plotStep(a,c,this.$animating);this.$animating=
"expand"},complete:function(){b.plotStep(void 0,c,false);c.onComplete()}})).start()},show:function(a){var c=this.config;this.prepare(a);h.each(a,function(a){if(c.multitree&amp;&amp;!("$orn"in a.data)){delete a.data.$orns;var d=" ";a.eachSubnode(function(a){"$orn"in a.data&amp;&amp;d.indexOf(a.data.$orn)&lt;0&amp;&amp;a.exist&amp;&amp;!a.drawn&amp;&amp;(d+=a.data.$orn+" ")});a.data.$orns=d}a.eachLevel(0,c.levelsToShow,function(a){if(a.exist)a.drawn=true})})},prepare:function(a){return this.nodes=this.getNodesWithChildren(a)},getNodesWithChildren:function(a){var c=
[],b=this.config;a.sort(function(a,c){return(a._depth&lt;=c._depth)-(a._depth&gt;=c._depth)});for(var d=0;d&lt;a.length;d++)if(a[d].anySubnode("exist")){for(var e=d+1,f=false;!f&amp;&amp;e&lt;a.length;e++)if(!b.multitree||"$orn"in a[e].data)f=f||a[d].isDescendantOf(a[e].id);f||c.push(a[d])}return c},plotStep:function(a,c,b){var d=this.viz,e=this.config,f=d.canvas.getCtx(),g=this.nodes,i,k,l={};for(i=0;i&lt;g.length;i++){k=g[i];l[k.id]=[];var n=e.multitree&amp;&amp;!("$orn"in k.data),o=n&amp;&amp;k.data.$orns;k.eachSubgraph(function(a){if(n&amp;&amp;
o&amp;&amp;o.indexOf(a.data.$orn)&gt;0&amp;&amp;a.drawn)a.drawn=false,l[k.id].push(a);else if((!n||!o)&amp;&amp;a.drawn)a.drawn=false,l[k.id].push(a)});k.drawn=true}g.length&gt;0&amp;&amp;d.fx.plot();for(i in l)h.each(l[i],function(a){a.drawn=true});for(i=0;i&lt;g.length;i++)k=g[i],f.save(),d.fx.plotSubtree(k,c,a,b),f.restore()},getSiblings:function(a){var c={};h.each(a,function(a){var d=a.getParents();if(d.length==0)c[a.id]=[a];else{var e=[];d[0].eachSubnode(function(a){e.push(a)});c[a.id]=e}});return c}});$jit.ST.Geom=new j({Implements:m.Geom,
switchOrientation:function(a){this.config.orientation=a},dispatch:function(){var a=Array.prototype.slice.call(arguments),c=a.shift(),b=a.length,d=function(a){return typeof a=="function"?a():a};if(b==2)return c=="top"||c=="bottom"?d(a[0]):d(a[1]);else if(b==4)switch(c){case "top":return d(a[0]);case "right":return d(a[1]);case "bottom":return d(a[2]);case "left":return d(a[3])}},getSize:function(a,c){var b=a.data,d=this.config,e=d.siblingOffset,b=d.multitree&amp;&amp;"$orn"in b&amp;&amp;b.$orn||d.orientation,d=a.getData("width")+
e,e=a.getData("height")+e;return c?this.dispatch(b,d,e):this.dispatch(b,e,d)},getTreeBaseSize:function(a,c,b){var d=this.getSize(a,true),e=0,f=this;if(b(c,a))return d;if(c===0)return 0;a.eachSubnode(function(a){e+=f.getTreeBaseSize(a,c-1,b)});return(d&gt;e?d:e)+this.config.subtreeOffset},getEdge:function(a,c,b){var d=function(c,b){return function(){return a.pos.add(new A(c,b))}},e=this.node,f=a.getData("width"),g=a.getData("height");if(c=="begin")if(e.align=="center")return this.dispatch(b,d(0,g/2),
d(-f/2,0),d(0,-g/2),d(f/2,0));else if(e.align=="left")return this.dispatch(b,d(0,g),d(0,0),d(0,0),d(f,0));else if(e.align=="right")return this.dispatch(b,d(0,0),d(-f,0),d(0,-g),d(0,0));else throw"align: not implemented";else if(c=="end")if(e.align=="center")return this.dispatch(b,d(0,-g/2),d(f/2,0),d(0,g/2),d(-f/2,0));else if(e.align=="left")return this.dispatch(b,d(0,0),d(f,0),d(0,g),d(0,0));else if(e.align=="right")return this.dispatch(b,d(0,-g),d(0,0),d(0,0),d(-f,0));else throw"align: not implemented";
},getScaledTreePosition:function(a,c){var b=this.node,d=a.getData("width"),e=a.getData("height"),f=this.config.multitree&amp;&amp;"$orn"in a.data&amp;&amp;a.data.$orn||this.config.orientation,g=function(b,d){return function(){return a.pos.add(new A(b,d)).$scale(1-c)}};if(b.align=="left")return this.dispatch(f,g(0,e),g(0,0),g(0,0),g(d,0));else if(b.align=="center")return this.dispatch(f,g(0,e/2),g(-d/2,0),g(0,-e/2),g(d/2,0));else if(b.align=="right")return this.dispatch(f,g(0,0),g(-d,0),g(0,-e),g(0,0));else throw"align: not implemented";
},treeFitsInCanvas:function(a,c,b){c=c.getSize();c=this.dispatch(this.config.multitree&amp;&amp;"$orn"in a.data&amp;&amp;a.data.$orn||this.config.orientation,c.width,c.height);return this.getTreeBaseSize(a,b,function(a,c){return a===0||!c.anySubnode()})&lt;c}});$jit.ST.Plot=new j({Implements:m.Plot,plotSubtree:function(a,c,b,d){var e=this.viz,f=e.canvas,g=e.config,b=Math.min(Math.max(0.001,b),1);if(b&gt;=0)a.drawn=false,f=f.getCtx(),e=e.geom.getScaledTreePosition(a,b),f.translate(e.x,e.y),f.scale(b,b);this.plotTree(a,
h.merge(c,{withLabels:true,hideLabels:!!b,plotSubtree:function(){var c=g.multitree&amp;&amp;!("$orn"in a.data),b=c&amp;&amp;a.getData("orns");return!c||b.indexOf(a.getData("orn"))&gt;-1}}),d);if(b&gt;=0)a.drawn=true},getAlignedPos:function(a,c,b){var d=this.node;if(d.align=="center")a={x:a.x-c/2,y:a.y-b/2};else if(d.align=="left")d=this.config.orientation,a=d=="bottom"||d=="top"?{x:a.x-c/2,y:a.y}:{x:a.x,y:a.y-b/2};else if(d.align=="right")d=this.config.orientation,a=d=="bottom"||d=="top"?{x:a.x-c/2,y:a.y-b}:{x:a.x-c,y:a.y-
b/2};else throw"align: not implemented";return a},getOrientation:function(a){var c=this.config,b=c.orientation;if(c.multitree)c=a.nodeFrom,a=a.nodeTo,b="$orn"in c.data&amp;&amp;c.data.$orn||"$orn"in a.data&amp;&amp;a.data.$orn;return b}});$jit.ST.Label={};$jit.ST.Label.Native=new j({Implements:m.Label.Native,renderLabel:function(a,c){var b=a.getCtx(),d=c.pos.getc(true),e=c.getData("width"),f=c.getData("height"),d=this.viz.fx.getAlignedPos(d,e,f);b.fillText(c.name,d.x+e/2,d.y+f/2)}});$jit.ST.Label.DOM=new j({Implements:m.Label.DOM,
placeLabel:function(a,c,b){var d=c.pos.getc(true),e=this.viz.config,f=e.Node,g=this.viz.canvas,h=c.getData("width"),k=c.getData("height"),l=g.getSize(),n=d.x*g.scaleOffsetX+g.translateOffsetX,d=d.y*g.scaleOffsetY+g.translateOffsetY;if(f.align=="center")h={x:Math.round(n-h/2+l.width/2),y:Math.round(d-k/2+l.height/2)};else if(f.align=="left")e=e.orientation,h=e=="bottom"||e=="top"?{x:Math.round(n-h/2+l.width/2),y:Math.round(d+l.height/2)}:{x:Math.round(n+l.width/2),y:Math.round(d-k/2+l.height/2)};else if(f.align==
"right")e=e.orientation,h=e=="bottom"||e=="top"?{x:Math.round(n-h/2+l.width/2),y:Math.round(d-k+l.height/2)}:{x:Math.round(n-h+l.width/2),y:Math.round(d-k/2+l.height/2)};else throw"align: not implemented";k=a.style;k.left=h.x+"px";k.top=h.y+"px";k.display=this.fitsInCanvas(h,g)?"":"none";b.onPlaceLabel(a,c)}});$jit.ST.Label.SVG=new j({Implements:[$jit.ST.Label.DOM,m.Label.SVG],initialize:function(a){this.viz=a}});$jit.ST.Label.HTML=new j({Implements:[$jit.ST.Label.DOM,m.Label.HTML],initialize:function(a){this.viz=
a}});$jit.ST.Plot.NodeTypes=new j({none:{render:h.empty,contains:h.lambda(false)},circle:{render:function(a,c){var b=a.getData("dim"),d=this.getAlignedPos(a.pos.getc(true),b,b);b/=2;this.nodeHelper.circle.render("fill",{x:d.x+b,y:d.y+b},b,c)},contains:function(a,c){var b=a.getData("dim"),d=this.getAlignedPos(a.pos.getc(true),b,b);b/=2;this.nodeHelper.circle.contains({x:d.x+b,y:d.y+b},c,b)}},square:{render:function(a,c){var b=a.getData("dim"),d=b/2,b=this.getAlignedPos(a.pos.getc(true),b,b);this.nodeHelper.square.render("fill",
{x:b.x+d,y:b.y+d},d,c)},contains:function(a,c){var b=a.getData("dim"),d=this.getAlignedPos(a.pos.getc(true),b,b);b/=2;this.nodeHelper.square.contains({x:d.x+b,y:d.y+b},c,b)}},ellipse:{render:function(a,c){var b=a.getData("width"),d=a.getData("height"),e=this.getAlignedPos(a.pos.getc(true),b,d);this.nodeHelper.ellipse.render("fill",{x:e.x+b/2,y:e.y+d/2},b,d,c)},contains:function(a,c){var b=a.getData("width"),d=a.getData("height"),e=this.getAlignedPos(a.pos.getc(true),b,d);this.nodeHelper.ellipse.contains({x:e.x+
b/2,y:e.y+d/2},c,b,d)}},rectangle:{render:function(a,c){var b=a.getData("width"),d=a.getData("height"),e=this.getAlignedPos(a.pos.getc(true),b,d);this.nodeHelper.rectangle.render("fill",{x:e.x+b/2,y:e.y+d/2},b,d,c)},contains:function(a,c){var b=a.getData("width"),d=a.getData("height"),e=this.getAlignedPos(a.pos.getc(true),b,d);this.nodeHelper.rectangle.contains({x:e.x+b/2,y:e.y+d/2},c,b,d)}}});$jit.ST.Plot.EdgeTypes=new j({none:h.empty,line:{render:function(a,c){var b=this.getOrientation(a),d=a.nodeFrom,
e=a.nodeTo,f=d._depth&lt;e._depth,g=this.viz.geom.getEdge(f?d:e,"begin",b),b=this.viz.geom.getEdge(f?e:d,"end",b);this.edgeHelper.line.render(g,b,c)},contains:function(a,c){var b=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth&lt;e._depth,g=this.viz.geom.getEdge(f?d:e,"begin",b),b=this.viz.geom.getEdge(f?e:d,"end",b);return this.edgeHelper.line.contains(g,b,c,this.edge.epsilon)}},arrow:{render:function(a,c){var b=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=a.getData("dim"),g=this.viz.geom.getEdge(d,
"begin",b),b=this.viz.geom.getEdge(e,"end",b),e=a.data.$direction;this.edgeHelper.arrow.render(g,b,f,e&amp;&amp;e.length&gt;1&amp;&amp;e[0]!=d.id,c)},contains:function(a,c){var b=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth&lt;e._depth,g=this.viz.geom.getEdge(f?d:e,"begin",b),b=this.viz.geom.getEdge(f?e:d,"end",b);return this.edgeHelper.arrow.contains(g,b,c,this.edge.epsilon)}},"quadratic:begin":{render:function(a,c){var b=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth&lt;e._depth,g=this.viz.geom.getEdge(f?
d:e,"begin",b),d=this.viz.geom.getEdge(f?e:d,"end",b),e=a.getData("dim"),f=c.getCtx();f.beginPath();f.moveTo(g.x,g.y);switch(b){case "left":f.quadraticCurveTo(g.x+e,g.y,d.x,d.y);break;case "right":f.quadraticCurveTo(g.x-e,g.y,d.x,d.y);break;case "top":f.quadraticCurveTo(g.x,g.y+e,d.x,d.y);break;case "bottom":f.quadraticCurveTo(g.x,g.y-e,d.x,d.y)}f.stroke()}},"quadratic:end":{render:function(a,c){var b=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth&lt;e._depth,g=this.viz.geom.getEdge(f?d:e,
"begin",b),d=this.viz.geom.getEdge(f?e:d,"end",b),e=a.getData("dim"),f=c.getCtx();f.beginPath();f.moveTo(g.x,g.y);switch(b){case "left":f.quadraticCurveTo(d.x-e,d.y,d.x,d.y);break;case "right":f.quadraticCurveTo(d.x+e,d.y,d.x,d.y);break;case "top":f.quadraticCurveTo(d.x,d.y-e,d.x,d.y);break;case "bottom":f.quadraticCurveTo(d.x,d.y+e,d.x,d.y)}f.stroke()}},bezier:{render:function(a,c){var b=this.getOrientation(a),d=a.nodeFrom,e=a.nodeTo,f=d._depth&lt;e._depth,g=this.viz.geom.getEdge(f?d:e,"begin",b),d=
this.viz.geom.getEdge(f?e:d,"end",b),e=a.getData("dim"),f=c.getCtx();f.beginPath();f.moveTo(g.x,g.y);switch(b){case "left":f.bezierCurveTo(g.x+e,g.y,d.x-e,d.y,d.x,d.y);break;case "right":f.bezierCurveTo(g.x-e,g.y,d.x+e,d.y,d.x,d.y);break;case "top":f.bezierCurveTo(g.x,g.y+e,d.x,d.y-e,d.x,d.y);break;case "bottom":f.bezierCurveTo(g.x,g.y-e,d.x,d.y+e,d.x,d.y)}f.stroke()}}});$jit.ST.Plot.NodeTypes.implement({"areachart-stacked":{render:function(a,c){var b=a.pos.getc(true),d=a.getData("width"),e=a.getData("height"),
e=this.getAlignedPos(b,d,e),b=e.x,e=e.y,f=a.getData("stringArray"),g=a.getData("dimArray"),i=a.getData("valueArray"),k=h.reduce(i,function(a,c){return a+c[0]},0),l=h.reduce(i,function(a,c){return a+c[1]},0),n=a.getData("colorArray"),o=n.length,t=a.getData("config"),j=a.getData("gradient"),m=t.showLabels,p=t.showAggregates,z=t.Label,w=a.getData("prev"),s=c.getCtx(),H=a.getData("border");if(n&amp;&amp;g&amp;&amp;f){for(var x=0,y=g.length,I=0,v=0,u=0;x&lt;y;x++){s.fillStyle=s.strokeStyle=n[x%o];s.save();if(j&amp;&amp;(g[x][0]&gt;
0||g[x][1]&gt;0)){var C=I+g[x][0],q=v+g[x][1],r=Math.atan((q-C)/d),q=s.createLinearGradient(b+d/2,e-(C+q)/2,b+d/2+55*Math.sin(r),e-(C+q)/2+55*Math.cos(r)),C=h.rgbToHex(h.map(h.hexToRgb(n[x%o].slice(1)),function(a){return a*0.85&gt;&gt;0}));q.addColorStop(0,n[x%o]);q.addColorStop(1,C);s.fillStyle=q}s.beginPath();s.moveTo(b,e-I);s.lineTo(b+d,e-v);s.lineTo(b+d,e-v-g[x][1]);s.lineTo(b,e-I-g[x][0]);s.lineTo(b,e-I);s.fill();s.restore();if(H){var A=(q=H.name==f[x])?0.7:0.8,C=h.rgbToHex(h.map(h.hexToRgb(n[x%o].slice(1)),
function(a){return a*A&gt;&gt;0}));s.strokeStyle=C;s.lineWidth=q?4:1;s.save();s.beginPath();H.index===0?(s.moveTo(b,e-I),s.lineTo(b,e-I-g[x][0])):(s.moveTo(b+d,e-v),s.lineTo(b+d,e-v-g[x][1]));s.stroke();s.restore()}I+=g[x][0]||0;v+=g[x][1]||0;g[x][0]&gt;0&amp;&amp;(u+=i[x][0]||0)}if(w&amp;&amp;z.type=="Native")s.save(),s.beginPath(),s.fillStyle=s.strokeStyle=z.color,s.font=z.style+" "+z.size+"px "+z.family,s.textAlign="center",s.textBaseline="middle",f=p(a.name,k,l,a,u),f!==false&amp;&amp;s.fillText(f!==true?f:u,b,e-I-t.labelOffset-
z.size/2,d),m(a.name,k,l,a)&amp;&amp;s.fillText(a.name,b,e+z.size/2+t.labelOffset),s.restore()}},contains:function(a,c){var b=a.pos.getc(true),d=a.getData("width"),e=a.getData("height"),b=this.getAlignedPos(b,d,e),f=b.x,g=b.y,b=a.getData("dimArray"),h=c.x-f;if(c.x&lt;f||c.x&gt;f+d||c.y&gt;g||c.y&lt;g-e)return false;for(var e=0,f=b.length,k=g;e&lt;f;e++){var l=b[e];k-=l[0];g-=l[1];if(c.y&gt;=k+(g-k)*h/d)return d=+(h&gt;d/2),{name:a.getData("stringArray")[e],color:a.getData("colorArray")[e],value:a.getData("valueArray")[e][d],
index:d}}return false}}});$jit.AreaChart=new j({st:null,colors:"#416D9C,#70A35E,#EBB056,#C74243,#83548B,#909291,#557EAA".split(","),selected:{},busy:false,initialize:function(a){this.controller=this.config=h.merge(u("Canvas","Margin","Label","AreaChart"),{Label:{type:"Native"}},a);var a=this.config.showLabels,c=h.type(a),b=this.config.showAggregates,d=h.type(b);this.config.showLabels=c=="function"?a:h.lambda(a);this.config.showAggregates=d=="function"?b:h.lambda(b);this.initializeViz()},initializeViz:function(){var a=
this.config,c=this,b=a.type.split(":")[0],d={},b=new $jit.ST({injectInto:a.injectInto,width:a.width,height:a.height,orientation:"bottom",levelDistance:0,siblingOffset:0,subtreeOffset:0,withLabels:a.Label.type!="Native",useCanvas:a.useCanvas,Label:{type:a.Label.type},Node:{overridable:true,type:"areachart-"+b,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:a.Tips.enable,type:"Native",force:true,onShow:function(c,b,d){a.Tips.onShow(c,d,b)}},Events:{enable:true,type:"Native",onClick:function(b,
d,e){if(a.filterOnClick||a.Events.enable)(b=d.getContains())&amp;&amp;a.filterOnClick&amp;&amp;c.filter(b.name),a.Events.enable&amp;&amp;a.Events.onClick(b,d,e)},onRightClick:function(){a.restoreOnRightClick&amp;&amp;c.restore()},onMouseMove:function(b,d){if(a.selectOnHover)if(b){var e=d.getContains();c.select(b.id,e.name,e.index)}else c.select(false,false,false)}},onCreateLabel:function(c,b){var e=a.Label,f=b.getData("valueArray"),n=h.reduce(f,function(a,c){return a+c[0]},0),f=h.reduce(f,function(a,c){return a+c[1]},0);if(b.getData("prev")){var o=
{wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")},t=o.wrapper,j=o.label,m=o.aggregate,p=t.style,z=j.style,w=m.style;d[b.id]=o;t.appendChild(j);t.appendChild(m);if(!a.showLabels(b.name,n,f,b))j.style.display="none";if(!a.showAggregates(b.name,n,f,b))m.style.display="none";p.position="relative";p.overflow="visible";p.fontSize=e.size+"px";p.fontFamily=e.family;p.color=e.color;p.textAlign="center";w.position=z.position="absolute";c.style.width=
b.getData("width")+"px";c.style.height=b.getData("height")+"px";j.innerHTML=b.name;c.appendChild(t)}},onPlaceLabel:function(c,b){if(b.getData("prev")){var e=d[b.id],f=e.wrapper.style,n=e.label.style,o=e.aggregate.style,t=b.getData("width");b.getData("height");var j=b.getData("dimArray"),m=b.getData("valueArray"),p=h.reduce(m,function(a,c){return a+c[0]},0),z=h.reduce(m,function(a,c){return a+c[1]},0),w=parseInt(f.fontSize,10);if(j&amp;&amp;m){n.display=a.showLabels(b.name,p,z,b)?"":"none";p=a.showAggregates(b.name,
p,z,b);o.display=p!==false?"":"none";f.width=o.width=n.width=c.style.width=t+"px";o.left=n.left=-t/2+"px";for(var t=0,z=m.length,s=0,q=0;t&lt;z;t++)j[t][0]&gt;0&amp;&amp;(s+=m[t][0],q+=j[t][0]);o.top=-w-a.labelOffset+"px";n.top=a.labelOffset+q+"px";c.style.top=parseInt(c.style.top,10)-q+"px";c.style.height=f.height=q+"px";e.aggregate.innerHTML=p!==true?p:s}}}}),e=b.canvas.getSize(),f=a.Margin;b.config.offsetY=-e.height/2+f.bottom+(a.showLabels&amp;&amp;a.labelOffset+a.Label.size);b.config.offsetX=(f.right-f.left)/2;this.delegate=
b;this.canvas=this.delegate.canvas},loadJSON:function(a){for(var c=h.time(),b=[],d=this.delegate,e=h.splat(a.label),f=h.splat(a.color||this.colors),g=this.config,i=!!g.type.split(":")[1],k=g.animate,l=0,a=a.values,n=a.length;l&lt;n-1;l++){var o=a[l],t=a[l-1],j=a[l+1],m=h.splat(a[l].values),p=h.splat(a[l+1].values),m=h.zip(m,p);b.push({id:c+o.label,name:o.label,data:{value:m,$valueArray:m,$colorArray:f,$stringArray:e,$next:j.label,$prev:t?t.label:false,$config:g,$gradient:i},children:[]})}d.loadJSON({id:c+
"$root",name:"",data:{$type:"none",$width:1,$height:1},children:b});this.normalizeDims();d.compute();d.select(d.root);k&amp;&amp;d.fx.animate({modes:["node-property:height:dimArray"],duration:1500})},updateJSON:function(a,c){if(!this.busy){this.busy=true;for(var b=this.delegate,d=b.graph,e=a.label&amp;&amp;h.splat(a.label),f=a.values,g=this.config.animate,i=this,k={},l=0,n=f.length;l&lt;n;l++)k[f[l].label]=f[l];d.eachNode(function(a){var c=k[a.name],b=a.getData("stringArray"),d=a.getData("valueArray"),f=a.getData("next");
if(c)c.values=h.splat(c.values),h.each(d,function(a,d){a[0]=c.values[d];e&amp;&amp;(b[d]=e[d])}),a.setData("valueArray",d);f&amp;&amp;(c=k[f])&amp;&amp;h.each(d,function(a,b){a[1]=c.values[b]})});this.normalizeDims();b.compute();b.select(b.root);g&amp;&amp;b.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){i.busy=false;c&amp;&amp;c.onComplete()}})}},filter:function(a,c){if(!this.busy){this.busy=true;this.config.Tips.enable&amp;&amp;this.delegate.tips.hide();this.select(false,false,false);var b=h.splat(a),
d=this.delegate.graph.getNode(this.delegate.root),e=this;this.normalizeDims();d.eachAdjacency(function(a){var a=a.nodeTo,c=a.getData("dimArray","end"),d=a.getData("stringArray");a.setData("dimArray",h.map(c,function(a,c){return h.indexOf(b,d[c])&gt;-1?a:[0,0]}),"end")});this.delegate.fx.animate({modes:["node-property:dimArray"],duration:1500,onComplete:function(){e.busy=false;c&amp;&amp;c.onComplete()}})}},restore:function(a){if(!this.busy){this.busy=true;this.config.Tips.enable&amp;&amp;this.delegate.tips.hide();this.select(false,
false,false);this.normalizeDims();var c=this;this.delegate.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){c.busy=false;a&amp;&amp;a.onComplete()}})}},select:function(a,c,b){if(this.config.selectOnHover){var d=this.selected;if(d.id!=a||d.name!=c||d.index!=b){d.id=a;d.name=c;d.index=b;this.delegate.graph.eachNode(function(a){a.setData("border",false)});if(a&amp;&amp;(a=this.delegate.graph.getNode(a),a.setData("border",d),d=a.getData(b===0?"prev":"next")))(a=this.delegate.graph.getByName(d))&amp;&amp;
a.setData("border",{name:c,index:1-b});this.delegate.plot()}}},getLegend:function(){var a={},c;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(a){c=a.nodeTo});var b=c.getData("colorArray"),d=b.length;h.each(c.getData("stringArray"),function(c,f){a[c]=b[f%d]});return a},getMaxValue:function(){var a=0;this.delegate.graph.eachNode(function(c){var c=c.getData("valueArray"),b=0,d=0;h.each(c,function(a){b+=+a[0];d+=+a[1]});c=d&gt;b?d:b;a=a&gt;c?a:c});return a},normalizeDims:function(){var a=
0;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(){a++});var c=this.getMaxValue()||1,b=this.delegate.canvas.getSize(),d=this.config,e=d.Margin,f=d.labelOffset+d.Label.size,g=(b.width-(e.left+e.right))/a,i=d.animate,k=b.height-(e.top+e.bottom)-(d.showAggregates&amp;&amp;f)-(d.showLabels&amp;&amp;f);this.delegate.graph.eachNode(function(a){var b=0,d=0,e=[];h.each(a.getData("valueArray"),function(a){b+=+a[0];d+=+a[1];e.push([0,0])});var f=d&gt;b?d:b;a.setData("width",g);i?(a.setData("height",f*
k/c,"end"),a.setData("dimArray",h.map(a.getData("valueArray"),function(a){return[a[0]*k/c,a[1]*k/c]}),"end"),a.getData("dimArray")||a.setData("dimArray",e)):(a.setData("height",f*k/c),a.setData("dimArray",h.map(a.getData("valueArray"),function(a){return[a[0]*k/c,a[1]*k/c]})))})}});B.Radial=new j({compute:function(a){a=h.splat(a||["current","start","end"]);R.compute(this.graph,a,this.config);this.graph.computeLevels(this.root,0,"ignore");var c=this.createLevelDistanceFunc();this.computeAngularWidths(a);
this.computePositions(a,c)},computePositions:function(a,c){for(var b=this.graph,d=b.getNode(this.root),e=this.parent,f=0,g=a.length;f&lt;g;f++){var h=a[f];d.setPos(new q(0,0),h);d.setData("span",Math.PI*2,h)}d.angleSpan={begin:0,end:2*Math.PI};b.eachBFS(this.root,function(b){var d=b.angleSpan.end-b.angleSpan.begin,f=b.angleSpan.begin,g=c(b),h=0,i=[],j={};b.eachSubnode(function(c){h+=c._treeAngularWidth;for(var b=0,d=a.length;b&lt;d;b++){var e=a[b],f=c.getData("dim",e);j[e]=e in j?f&gt;j[e]?f:j[e]:f}i.push(c)},
"ignore");e&amp;&amp;e.id==b.id&amp;&amp;i.length&gt;0&amp;&amp;i[0].dist&amp;&amp;i.sort(function(a,c){return(a.dist&gt;=c.dist)-(a.dist&lt;=c.dist)});for(var b=0,m=i.length;b&lt;m;b++){var z=i[b];if(!z._flag){for(var w=z._treeAngularWidth/h*d,s=f+w/2,u=0,x=a.length;u&lt;x;u++){var y=a[u];z.setPos(new q(s,g),y);z.setData("span",w,y);z.setData("dim-quotient",z.getData("dim",y)/j[y],y)}z.angleSpan={begin:f,end:f+w};f+=w}}},"ignore")},setAngularWidthForNodes:function(a){this.graph.eachBFS(this.root,function(c,b){var d=c.getData("angularWidth",a[0])||
5;c._angularWidth=d/b},"ignore")},setSubtreesAngularWidth:function(){var a=this;this.graph.eachNode(function(c){a.setSubtreeAngularWidth(c)},"ignore")},setSubtreeAngularWidth:function(a){var c=this,b=a._angularWidth,d=0;a.eachSubnode(function(a){c.setSubtreeAngularWidth(a);d+=a._treeAngularWidth},"ignore");a._treeAngularWidth=Math.max(b,d)},computeAngularWidths:function(a){this.setAngularWidthForNodes(a);this.setSubtreesAngularWidth()}});A.prototype.moebiusTransformation=function(a){var c=this.add(a),
a=a.$conjugate().$prod(this);a.x++;return c.$div(a)};m.Util.moebiusTransformation=function(a,c,b,d,e){this.eachNode(a,function(a){for(var e=0;e&lt;b.length;e++){var h=c[e].scale(-1),k=d?d:b[e];a.getPos(b[e]).set(a.getPos(k).getc().moebiusTransformation(h))}},e)};$jit.Hypertree=new j({Implements:[F,E,B.Radial],initialize:function(a){var c=$jit.Hypertree,a=this.controller=this.config=h.merge(u("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),{radius:"auto",offset:0,
Edge:{type:"hyperline"},duration:1500,fps:35},a);if(a.useCanvas)this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label";else{if(a.background)a.background=h.merge({type:"Circles"},a.background);this.canvas=new D(this,a);this.config.labelContainer=(typeof a.injectInto=="string"?a.injectInto:a.injectInto.id)+"-label"}this.graphOptions={klass:q,Node:{selected:false,exist:true,drawn:true}};this.graph=new m(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new c.Label[a.Label.type](this);
this.fx=new c.Plot(this,c);this.op=new c.Op(this);this.root=this.json=null;this.busy=false;this.initializeExtras()},createLevelDistanceFunc:function(){var a=this.getRadius(),c=0,b=Math.max,d=this.config;this.graph.eachNode(function(a){c=b(a._depth,c)},"ignore");c++;for(var e=function(c){return function(b){b.scale=a;for(var b=b._depth+1,e=0,f=Math.pow;b;)e+=f(c,b--);return e-d.offset}},f=0.51;f&lt;=1;f+=0.01)if((1-Math.pow(f,c))/(1-f)&gt;=2)return e(f-0.01);return e(0.75)},getRadius:function(){var a=this.config.radius;
if(a!=="auto")return a;a=this.canvas.getSize();return Math.min(a.width,a.height)/2},refresh:function(a){a?(this.reposition(),this.graph.eachNode(function(a){a.startPos.rho=a.pos.rho=a.endPos.rho;a.startPos.theta=a.pos.theta=a.endPos.theta})):this.compute();this.plot()},reposition:function(){this.compute("end");var a=this.graph.getNode(this.root).pos.getc().scale(-1);m.Util.moebiusTransformation(this.graph,[a],["end"],"end","ignore");this.graph.eachNode(function(a){if(a.ignore)a.endPos.rho=a.pos.rho,
a.endPos.theta=a.pos.theta})},plot:function(){this.fx.plot()},onClick:function(a,c){this.move(this.graph.getNode(a).pos.getc(true),c)},move:function(a,c){var b=K(a.x,a.y);if(this.busy===false&amp;&amp;b.norm()&lt;1){this.busy=true;var d=this.graph.getClosestNodeToPos(b),e=this;this.graph.computeLevels(d.id,0);this.controller.onBeforeCompute(d);c=h.merge({onComplete:h.empty},c||{});this.fx.animate(h.merge({modes:["moebius"],hideLabels:true},c,{onComplete:function(){e.busy=false;c.onComplete()}}),b)}}});$jit.Hypertree.$extend=
true;(function(a){a.Op=new j({Implements:m.Op});a.Plot=new j({Implements:m.Plot});a.Label={};a.Label.Native=new j({Implements:m.Label.Native,initialize:function(a){this.viz=a},renderLabel:function(a,b){var d=a.getCtx(),e=b.pos.getc(true),f=this.viz.getRadius();d.fillText(b.name,e.x*f,e.y*f)}});a.Label.SVG=new j({Implements:m.Label.SVG,initialize:function(a){this.viz=a},placeLabel:function(a,b,d){var e=b.pos.getc(true),f=this.viz.canvas,g=f.translateOffsetX,h=f.translateOffsetY,k=f.scaleOffsetX,l=
f.scaleOffsetY,f=f.getSize(),n=this.viz.getRadius(),g=Math.round(e.x*k*n+g+f.width/2),e=Math.round(e.y*l*n+h+f.height/2);a.setAttribute("x",g);a.setAttribute("y",e);d.onPlaceLabel(a,b)}});a.Label.HTML=new j({Implements:m.Label.HTML,initialize:function(a){this.viz=a},placeLabel:function(a,b,d){var e=b.pos.getc(true),f=this.viz.canvas,g=f.translateOffsetX,h=f.translateOffsetY,k=f.scaleOffsetX,l=f.scaleOffsetY,n=f.getSize(),o=this.viz.getRadius(),e={x:Math.round(e.x*k*o+g+n.width/2),y:Math.round(e.y*
l*o+h+n.height/2)},g=a.style;g.left=e.x+"px";g.top=e.y+"px";g.display=this.fitsInCanvas(e,f)?"":"none";d.onPlaceLabel(a,b)}});a.Plot.NodeTypes=new j({none:{render:h.empty,contains:h.lambda(false)},circle:{render:function(a,b){var d=this.node,e=a.getData("dim"),f=a.pos.getc(),e=d.transform?e*(1-f.squaredNorm()):e;f.$scale(a.scale);e&gt;0.2&amp;&amp;this.nodeHelper.circle.render("fill",f,e,b)},contains:function(a,b){var d=a.getData("dim");return this.nodeHelper.circle.contains(a.pos.getc().$scale(a.scale),b,d)}},
ellipse:{render:function(a,b){var d=a.pos.getc().$scale(a.scale),e=a.getData("width"),f=a.getData("height");this.nodeHelper.ellipse.render("fill",d,e,f,b)},contains:function(a,b){var d=a.getData("width"),e=a.getData("height");return this.nodeHelper.circle.contains(a.pos.getc().$scale(a.scale),b,d,e)}},square:{render:function(a,b){var d=this.node,e=a.getData("dim"),f=a.pos.getc(),e=d.transform?e*(1-f.squaredNorm()):e;f.$scale(a.scale);e&gt;0.2&amp;&amp;this.nodeHelper.square.render("fill",f,e,b)},contains:function(a,
b){var d=a.getData("dim");return this.nodeHelper.square.contains(a.pos.getc().$scale(a.scale),b,d)}},rectangle:{render:function(a,b){var d=this.node,e=a.getData("width"),f=a.getData("height"),g=a.pos.getc(),e=d.transform?e*(1-g.squaredNorm()):e,f=d.transform?f*(1-g.squaredNorm()):f;g.$scale(a.scale);e&gt;0.2&amp;&amp;f&gt;0.2&amp;&amp;this.nodeHelper.rectangle.render("fill",g,e,f,b)},contains:function(a,b){var d=a.getData("width"),e=a.getData("height");return this.nodeHelper.rectangle.contains(a.pos.getc().$scale(a.scale),
b,d,e)}},triangle:{render:function(a,b){var d=this.node,e=a.getData("dim"),f=a.pos.getc(),e=d.transform?e*(1-f.squaredNorm()):e;f.$scale(a.scale);e&gt;0.2&amp;&amp;this.nodeHelper.triangle.render("fill",f,e,b)},contains:function(a,b){var d=a.getData("dim");return this.nodeHelper.triangle.contains(a.pos.getc().$scale(a.scale),b,d)}},star:{render:function(a,b){var d=this.node,e=a.getData("dim"),f=a.pos.getc(),e=d.transform?e*(1-f.squaredNorm()):e;f.$scale(a.scale);e&gt;0.2&amp;&amp;this.nodeHelper.star.render("fill",f,e,
b)},contains:function(a,b){var d=a.getData("dim");return this.nodeHelper.star.contains(a.pos.getc().$scale(a.scale),b,d)}}});a.Plot.EdgeTypes=new j({none:h.empty,line:{render:function(a,b){var d=a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true),f=a.nodeFrom.scale;this.edgeHelper.line.render({x:d.x*f,y:d.y*f},{x:e.x*f,y:e.y*f},b)},contains:function(a,b){var d=a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true),f=a.nodeFrom.scale;this.edgeHelper.line.contains({x:d.x*f,y:d.y*f},{x:e.x*f,y:e.y*f},b,
this.edge.epsilon)}},arrow:{render:function(a,b){var d=a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true),f=a.nodeFrom.scale,g=a.getData("dim"),h=a.data.$direction;this.edgeHelper.arrow.render({x:d.x*f,y:d.y*f},{x:e.x*f,y:e.y*f},g,h&amp;&amp;h.length&gt;1&amp;&amp;h[0]!=a.nodeFrom.id,b)},contains:function(a,b){var d=a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true),f=a.nodeFrom.scale;this.edgeHelper.arrow.contains({x:d.x*f,y:d.y*f},{x:e.x*f,y:e.y*f},b,this.edge.epsilon)}},hyperline:{render:function(a,b){var d=a.nodeFrom.pos.getc(),
e=a.nodeTo.pos.getc(),f=this.viz.getRadius();this.edgeHelper.hyperline.render(d,e,f,b)},contains:h.lambda(false)}})})($jit.Hypertree);B.TM={};B.TM.SliceAndDice=new j({compute:function(a){var c=this.graph.getNode(this.clickedNode&amp;&amp;this.clickedNode.id||this.root);this.controller.onBeforeCompute(c);var b=this.canvas.getSize(),d=this.config,e=b.width,b=b.height;this.graph.computeLevels(this.root,0,"ignore");c.getPos(a).setc(-e/2,-b/2);c.setData("width",e,a);c.setData("height",b+d.titleHeight,a);this.computePositions(c,
c,this.layout.orientation,a);this.controller.onAfterCompute(c)},computePositions:function(a,c,b,d){var e=0;a.eachSubnode(function(a){e+=a.getData("area",d)});var f=this.config,g=a.getData("width",d),h=Math.max(a.getData("height",d)-f.titleHeight,0),a=a==c?1:c.getData("area",d)/e,k,l,n,o,t;b=="h"?(b="v",g*=a,k="height",l="y",n="x",o=f.titleHeight,t=0):(b="h",h*=a,k="width",l="x",n="y",o=0,t=f.titleHeight);var j=c.getPos(d);c.setData("width",g,d);c.setData("height",h,d);var m=0,p=this;c.eachSubnode(function(a){var e=
a.getPos(d);e[l]=m+j[l]+o;e[n]=j[n]+t;p.computePositions(c,a,b,d);m+=a.getData(k,d)})}});B.TM.Area={compute:function(a){var a=a||"current",c=this.graph.getNode(this.clickedNode&amp;&amp;this.clickedNode.id||this.root);this.controller.onBeforeCompute(c);var b=this.config,d=this.canvas.getSize(),e=d.width,d=d.height,f=b.offset,g=e-f,f=d-f;this.graph.computeLevels(this.root,0,"ignore");c.getPos(a).setc(-e/2,-d/2);c.setData("width",e,a);c.setData("height",d,a);this.computePositions(c,{top:-d/2+b.titleHeight,
left:-e/2,width:g,height:f-b.titleHeight},a);this.controller.onAfterCompute(c)},computeDim:function(a,c,b,d,e,f){if(a.length+c.length==1)this.layoutLast(a.length==1?a:c,b,d,f);else if(a.length&gt;=2&amp;&amp;c.length==0&amp;&amp;(c=[a.shift()]),a.length==0)c.length&gt;0&amp;&amp;this.layoutRow(c,b,d,f);else{var g=a[0];e(c,b)&gt;=e([g].concat(c),b)?this.computeDim(a.slice(1),c.concat([g]),b,d,e,f):(c=this.layoutRow(c,b,d,f),this.computeDim(a,[],c.dim,c,e,f))}},worstAspectRatio:function(a,c){if(!a||a.length==0)return Number.MAX_VALUE;
for(var b=0,d=0,e=Number.MAX_VALUE,f=0,g=a.length;f&lt;g;f++){var h=a[f]._area;b+=h;e=e&lt;h?e:h;d=d&gt;h?d:h}f=c*c;b*=b;return Math.max(f*d/b,b/(f*e))},avgAspectRatio:function(a,c){if(!a||a.length==0)return Number.MAX_VALUE;for(var b=0,d=0,e=a.length;d&lt;e;d++){var f=a[d]._area/c;b+=c&gt;f?c/f:f/c}return b/e},layoutLast:function(a,c,b,d){a=a[0];a.getPos(d).setc(b.left,b.top);a.setData("width",b.width,d);a.setData("height",b.height,d)}};B.TM.Squarified=new j({Implements:B.TM.Area,computePositions:function(a,c,
b){var d=this.config,e=Math.max;this.layout.orientation=c.width&gt;=c.height?"h":"v";var f=a.getSubnodes([1,1],"ignore");if(f.length&gt;0){this.processChildrenLayout(a,f,c,b);for(var a=0,g=f.length;a&lt;g;a++){var h=f[a],k=d.offset,c=e(h.getData("height",b)-k-d.titleHeight,0),k=e(h.getData("width",b)-k,0),l=h.getPos(b),c={width:k,height:c,top:l.y+d.titleHeight,left:l.x};this.computePositions(h,c,b)}}},processChildrenLayout:function(a,c,b,d){var a=b.width*b.height,e,f=c.length,g=0,h=[];for(e=0;e&lt;f;e++)h[e]=
parseFloat(c[e].getData("area",d)),g+=h[e];for(e=0;e&lt;f;e++)c[e]._area=a*h[e]/g;a=this.layout.horizontal()?b.height:b.width;c.sort(function(a,c){var b=c._area-a._area;return b?b:c.id==a.id?0:c.id&lt;a.id?1:-1});e=[c[0]];this.squarify(c.slice(1),e,a,b,d)},squarify:function(a,c,b,d,e){this.computeDim(a,c,b,d,this.worstAspectRatio,e)},layoutRow:function(a,c,b,d){return this.layout.horizontal()?this.layoutV(a,c,b,d):this.layoutH(a,c,b,d)},layoutV:function(a,c,b,d){var e=0;h.each(a,function(a){e+=a._area});
for(var c=e/c,f=0,g=0,i=a.length;g&lt;i;g++){var k=a[g]._area/c,l=a[g];l.getPos(d).setc(b.left,b.top+f);l.setData("width",c,d);l.setData("height",k,d);f+=k}a={height:b.height,width:b.width-c,top:b.top,left:b.left+c};a.dim=Math.min(a.width,a.height);a.dim!=a.height&amp;&amp;this.layout.change();return a},layoutH:function(a,c,b,d){var e=0;h.each(a,function(a){e+=a._area});for(var f=e/c,g=b.top,i=0,k=0,l=a.length;k&lt;l;k++){var n=a[k],c=n._area/f;n.getPos(d).setc(b.left+i,g);n.setData("width",c,d);n.setData("height",
f,d);i+=c}a={height:b.height-f,width:b.width,top:b.top+f,left:b.left};a.dim=Math.min(a.width,a.height);a.dim!=a.width&amp;&amp;this.layout.change();return a}});B.TM.Strip=new j({Implements:B.TM.Area,computePositions:function(a,c,b){var d=a.getSubnodes([1,1],"ignore"),e=this.config,f=Math.max;if(d.length&gt;0){this.processChildrenLayout(a,d,c,b);for(var a=0,g=d.length;a&lt;g;a++){var h=d[a],k=e.offset,c=f(h.getData("height",b)-k-e.titleHeight,0),k=f(h.getData("width",b)-k,0),l=h.getPos(b),c={width:k,height:c,top:l.y+
e.titleHeight,left:l.x};this.computePositions(h,c,b)}}},processChildrenLayout:function(a,c,b,d){var a=b.width*b.height,e,f=c.length,g=0,h=[];for(e=0;e&lt;f;e++)h[e]=+c[e].getData("area",d),g+=h[e];for(e=0;e&lt;f;e++)c[e]._area=a*h[e]/g;a=this.layout.horizontal()?b.width:b.height;e=[c[0]];this.stripify(c.slice(1),e,a,b,d)},stripify:function(a,c,b,d,e){this.computeDim(a,c,b,d,this.avgAspectRatio,e)},layoutRow:function(a,c,b,d){return this.layout.horizontal()?this.layoutH(a,c,b,d):this.layoutV(a,c,b,d)},layoutV:function(a,
c,b,d){var e=0;h.each(a,function(a){e+=a._area});for(var f=e/c,g=0,i=0,k=a.length;i&lt;k;i++){var l=a[i],n=l._area/f;l.getPos(d).setc(b.left,b.top+(c-n-g));l.setData("width",f,d);l.setData("height",n,d);g+=n}return{height:b.height,width:b.width-f,top:b.top,left:b.left+f,dim:c}},layoutH:function(a,c,b,d){var e=0;h.each(a,function(a){e+=a._area});for(var f=e/c,g=b.height-f,i=0,k=0,l=a.length;k&lt;l;k++){var n=a[k],o=n._area/f;n.getPos(d).setc(b.left+i,b.top+g);n.setData("width",o,d);n.setData("height",f,
d);i+=o}return{height:b.height-f,width:b.width,top:b.top,left:b.left,dim:c}}});B.Icicle=new j({compute:function(a){var a=a||"current",c=this.graph.getNode(this.root),b=this.config,d=this.canvas.getSize(),e=d.width,d=d.height,b=b.constrained?b.levelsToShow:Number.MAX_VALUE;this.controller.onBeforeCompute(c);m.Util.computeLevels(this.graph,c.id,0,"ignore");var f=0;m.Util.eachLevel(c,0,false,function(a,c){c&gt;f&amp;&amp;(f=c)});var c=this.graph.getNode(this.clickedNode&amp;&amp;this.clickedNode.id||c.id),b=Math.min(f,
b-1),g=c._depth;this.layout.horizontal()?this.computeSubtree(c,-e/2,-d/2,e/(b+1),d,g,b,a):this.computeSubtree(c,-e/2,-d/2,e,d/(b+1),g,b,a)},computeSubtree:function(a,c,b,d,e,f,g,i){a.getPos(i).setc(c,b);a.setData("width",d,i);a.setData("height",e,i);var k=0,l=m.Util.getSubnodes(a,[1,1],"ignore");if(l.length){h.each(l,function(a){k+=a.getData("dim")});for(var n=0,o=l.length;n&lt;o;n++)this.layout.horizontal()?(a=e*l[n].getData("dim")/k,this.computeSubtree(l[n],c+d,b,d,a,f,g,i),b+=a):(a=d*l[n].getData("dim")/
k,this.computeSubtree(l[n],c,b+e,a,e,f,g,i),c+=a)}}});$jit.Icicle=new j({Implements:[F,E,B.Icicle],layout:{orientation:"h",vertical:function(){return this.orientation=="v"},horizontal:function(){return this.orientation=="h"},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(a){var c={animate:false,orientation:"h",offset:2,levelsToShow:Number.MAX_VALUE,constrained:false,Node:{type:"rectangle",overridable:true},Edge:{type:"none"},Label:{type:"Native"},duration:700,fps:45},
b=u("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label");this.controller=this.config=h.merge(b,c,a);this.layout.orientation=this.config.orientation;a=this.config;a.useCanvas?(this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label"):(this.canvas=new D(this,a),this.config.labelContainer=(typeof a.injectInto=="string"?a.injectInto:a.injectInto.id)+"-label");this.graphOptions={klass:A,Node:{selected:false,exist:true,drawn:true}};this.graph=new m(this.graphOptions,
this.config.Node,this.config.Edge,this.config.Label);this.labels=new $jit.Icicle.Label[this.config.Label.type](this);this.fx=new $jit.Icicle.Plot(this,$jit.Icicle);this.op=new $jit.Icicle.Op(this);this.group=new $jit.Icicle.Group(this);this.clickedNode=null;this.initializeExtras()},refresh:function(){if(this.config.Label.type!="Native"){var a=this;this.graph.eachNode(function(c){a.labels.hideLabel(c,false)})}this.compute();this.plot()},plot:function(){this.fx.plot(this.config)},enter:function(a){if(!this.busy){this.busy=
true;var c=this,b=this.config,d={onComplete:function(){b.request&amp;&amp;c.compute();b.animate?(c.graph.nodeList.setDataset(["current","end"],{alpha:[1,0]}),m.Util.eachSubgraph(a,function(a){a.setData("alpha",1,"end")},"ignore"),c.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){c.clickedNode=a;c.compute("end");c.fx.animate({modes:["linear","node-property:width:height"],duration:1E3,onComplete:function(){c.busy=false;c.clickedNode=a}})}})):(c.clickedNode=a,c.busy=false,c.refresh())}};
if(b.request)this.requestNodes(clickedNode,d);else d.onComplete()}},out:function(){if(!this.busy){var a=this,c=m.Util,b=this.config,d=this.graph,e=c.getParents(d.getNode(this.clickedNode&amp;&amp;this.clickedNode.id||this.root))[0],f=this.clickedNode;this.busy=true;this.events.hoveredNode=false;if(e)if(callback={onComplete:function(){a.clickedNode=e;b.request?a.requestNodes(e,{onComplete:function(){a.compute();a.plot();a.busy=false}}):(a.compute(),a.plot(),a.busy=false)}},b.animate)this.clickedNode=e,this.compute("end"),
this.clickedNode=f,this.fx.animate({modes:["linear","node-property:width:height"],duration:1E3,onComplete:function(){a.clickedNode=e;d.nodeList.setDataset(["current","end"],{alpha:[0,1]});c.eachSubgraph(f,function(a){a.setData("alpha",1)},"ignore");a.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){callback.onComplete()}})}});else callback.onComplete();else this.busy=false}},requestNodes:function(a,c){var b=h.merge(this.controller,c),d=this.config.constrained?this.config.levelsToShow:
Number.MAX_VALUE;if(b.request){var e=[],f=a._depth;m.Util.eachLevel(a,0,d,function(a){if(a.drawn&amp;&amp;!m.Util.anySubnode(a)&amp;&amp;(e.push(a),a._level=a._depth-f,this.config.constrained))a._level=d-a._level});this.group.requestNodes(e,b)}else b.onComplete()}});$jit.Icicle.Op=new j({Implements:m.Op});$jit.Icicle.Group=new j({initialize:function(a){this.viz=a;this.canvas=a.canvas;this.config=a.config},requestNodes:function(a,c){var b=0,d=a.length,e=this.viz;if(d==0)c.onComplete();for(var f=0;f&lt;d;f++)c.request(a[f].id,
a[f]._level,{onComplete:function(a,f){if(f&amp;&amp;f.children)f.id=a,e.op.sum(f,{type:"nothing"});++b==d&amp;&amp;(m.Util.computeLevels(e.graph,e.root,0),c.onComplete())}})}});$jit.Icicle.Plot=new j({Implements:m.Plot,plot:function(a,c){var a=a||this.viz.controller,b=this.viz,d=b.graph.getNode(b.clickedNode&amp;&amp;b.clickedNode.id||b.root),e=d._depth;b.canvas.clear();this.plotTree(d,h.merge(a,{withLabels:true,hideLabels:false,plotSubtree:function(a,c){return!b.config.constrained||c._depth-e&lt;b.config.levelsToShow}}),c)}});
$jit.Icicle.Label={};$jit.Icicle.Label.Native=new j({Implements:m.Label.Native,renderLabel:function(a,c){var b=a.getCtx(),d=c.getData("width"),e=c.getData("height"),f=c.getLabelData("size"),g=b.measureText(c.name);e&lt;f*1.5||d&lt;g.width||(f=c.pos.getc(true),b.fillText(c.name,f.x+d/2,f.y+e/2))}});$jit.Icicle.Label.SVG=new j({Implements:m.Label.SVG,initialize:function(a){this.viz=a},placeLabel:function(a,c,b){var d=c.pos.getc(true),e=this.viz.canvas.getSize(),f=Math.round(d.x+e.width/2),d=Math.round(d.y+
e.height/2);a.setAttribute("x",f);a.setAttribute("y",d);b.onPlaceLabel(a,c)}});$jit.Icicle.Label.HTML=new j({Implements:m.Label.HTML,initialize:function(a){this.viz=a},placeLabel:function(a,c,b){var d=c.pos.getc(true),e=this.viz.canvas.getSize(),f=Math.round(d.x+e.width/2),d=Math.round(d.y+e.height/2),e=a.style;e.left=f+"px";e.top=d+"px";e.display="";b.onPlaceLabel(a,c)}});$jit.Icicle.Plot.NodeTypes=new j({none:{render:h.empty},rectangle:{render:function(a,c){var b=this.viz.config,d=b.offset,e=a.getData("width"),
f=a.getData("height"),g=a.getData("border"),i=a.pos.getc(true),k=i.x+d/2,l=i.y+d/2,n=c.getCtx();if(!(e-d&lt;2||f-d&lt;2)){if(b.cushion){var b=a.getData("color"),o=n.createRadialGradient(k+(e-d)/2,l+(f-d)/2,1,k+(e-d)/2,l+(f-d)/2,e&lt;f?f:e),t=h.rgbToHex(h.map(h.hexToRgb(b),function(a){return a*0.3&gt;&gt;0}));o.addColorStop(0,b);o.addColorStop(1,t);n.fillStyle=o}if(g)n.strokeStyle=g,n.lineWidth=3;n.fillRect(k,l,Math.max(0,e-d),Math.max(0,f-d));g&amp;&amp;n.strokeRect(i.x,i.y,e,f)}},contains:function(a,c){if(this.viz.clickedNode&amp;&amp;
!$jit.Graph.Util.isDescendantOf(a,this.viz.clickedNode.id))return false;var b=a.pos.getc(true),d=a.getData("width"),e=a.getData("height");return this.nodeHelper.rectangle.contains({x:b.x+d/2,y:b.y+e/2},c,d,e)}}});$jit.Icicle.Plot.EdgeTypes=new j({none:h.empty});$jit.RGraph=new j({Implements:[F,E,B.Radial],initialize:function(a){var c=$jit.RGraph,a=this.controller=this.config=h.merge(u("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),{interpolation:"linear",
levelDistance:100},a);if(a.useCanvas)this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label";else{if(a.background)a.background=h.merge({type:"Circles"},a.background);this.canvas=new D(this,a);this.config.labelContainer=(typeof a.injectInto=="string"?a.injectInto:a.injectInto.id)+"-label"}this.graphOptions={klass:q,Node:{selected:false,exist:true,drawn:true}};this.graph=new m(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new c.Label[a.Label.type](this);this.fx=
new c.Plot(this,c);this.op=new c.Op(this);this.root=this.json=null;this.parent=this.busy=false;this.initializeExtras()},createLevelDistanceFunc:function(){var a=this.config.levelDistance;return function(c){return(c._depth+1)*a}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},plot:function(){this.fx.plot()},getNodeAndParentAngle:function(a){var c=false,b=this.graph.getNode(a),a=b.getParents();if(a=a.length&gt;0?a[0]:false)c=a.pos.getc(),b=b.pos.getc(),c=c.add(b.scale(-1)),
c=Math.atan2(c.y,c.x),c&lt;0&amp;&amp;(c+=2*Math.PI);return{parent:a,theta:c}},tagChildren:function(a,c){if(a.angleSpan){var b=[];a.eachAdjacency(function(a){b.push(a.nodeTo)},"ignore");for(var d=b.length,e=0;e&lt;d&amp;&amp;c!=b[e].id;e++);for(var e=(e+1)%d,f=0;c!=b[e].id;e=(e+1)%d)b[e].dist=f++}},onClick:function(a,c){if(this.root!=a&amp;&amp;!this.busy){this.busy=true;this.root=a;var b=this;this.controller.onBeforeCompute(this.graph.getNode(a));var d=this.getNodeAndParentAngle(a);this.tagChildren(d.parent,a);this.parent=d.parent;
this.compute("end");var e=d.theta-d.parent.endPos.theta;this.graph.eachNode(function(a){a.endPos.set(a.endPos.getp().add(new q(e,0)))});d=this.config.interpolation;c=h.merge({onComplete:h.empty},c||{});this.fx.animate(h.merge({hideLabels:true,modes:[d]},c,{onComplete:function(){b.busy=false;c.onComplete()}}))}}});$jit.RGraph.$extend=true;(function(a){a.Op=new j({Implements:m.Op});a.Plot=new j({Implements:m.Plot});a.Label={};a.Label.Native=new j({Implements:m.Label.Native});a.Label.SVG=new j({Implements:m.Label.SVG,
initialize:function(a){this.viz=a},placeLabel:function(a,b,d){var e=b.pos.getc(true),f=this.viz.canvas,g=f.translateOffsetX,h=f.translateOffsetY,k=f.scaleOffsetX,l=f.scaleOffsetY,f=f.getSize(),g=Math.round(e.x*k+g+f.width/2),e=Math.round(e.y*l+h+f.height/2);a.setAttribute("x",g);a.setAttribute("y",e);d.onPlaceLabel(a,b)}});a.Label.HTML=new j({Implements:m.Label.HTML,initialize:function(a){this.viz=a},placeLabel:function(a,b,d){var e=b.pos.getc(true),f=this.viz.canvas,g=f.translateOffsetX,h=f.translateOffsetY,
k=f.scaleOffsetX,l=f.scaleOffsetY,n=f.getSize(),e={x:Math.round(e.x*k+g+n.width/2),y:Math.round(e.y*l+h+n.height/2)},g=a.style;g.left=e.x+"px";g.top=e.y+"px";g.display=this.fitsInCanvas(e,f)?"":"none";d.onPlaceLabel(a,b)}});a.Plot.NodeTypes=new j({none:{render:h.empty,contains:h.lambda(false)},circle:{render:function(a,b){var d=a.pos.getc(true),e=a.getData("dim");this.nodeHelper.circle.render("fill",d,e,b)},contains:function(a,b){var d=a.pos.getc(true),e=a.getData("dim");return this.nodeHelper.circle.contains(d,
b,e)}},ellipse:{render:function(a,b){var d=a.pos.getc(true),e=a.getData("width"),f=a.getData("height");this.nodeHelper.ellipse.render("fill",d,e,f,b)},contains:function(a,b){var d=a.pos.getc(true),e=a.getData("width"),f=a.getData("height");return this.nodeHelper.ellipse.contains(d,b,e,f)}},square:{render:function(a,b){var d=a.pos.getc(true),e=a.getData("dim");this.nodeHelper.square.render("fill",d,e,b)},contains:function(a,b){var d=a.pos.getc(true),e=a.getData("dim");return this.nodeHelper.square.contains(d,
b,e)}},rectangle:{render:function(a,b){var d=a.pos.getc(true),e=a.getData("width"),f=a.getData("height");this.nodeHelper.rectangle.render("fill",d,e,f,b)},contains:function(a,b){var d=a.pos.getc(true),e=a.getData("width"),f=a.getData("height");return this.nodeHelper.rectangle.contains(d,b,e,f)}},triangle:{render:function(a,b){var d=a.pos.getc(true),e=a.getData("dim");this.nodeHelper.triangle.render("fill",d,e,b)},contains:function(a,b){var d=a.pos.getc(true),e=a.getData("dim");return this.nodeHelper.triangle.contains(d,
b,e)}},star:{render:function(a,b){var d=a.pos.getc(true),e=a.getData("dim");this.nodeHelper.star.render("fill",d,e,b)},contains:function(a,b){var d=a.pos.getc(true),e=a.getData("dim");return this.nodeHelper.star.contains(d,b,e)}}});a.Plot.EdgeTypes=new j({none:h.empty,line:{render:function(a,b){var d=a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true);this.edgeHelper.line.render(d,e,b)},contains:function(a,b){var d=a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(d,
e,b,this.edge.epsilon)}},arrow:{render:function(a,b){var d=a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true),f=a.getData("dim"),g=a.data.$direction;this.edgeHelper.arrow.render(d,e,f,g&amp;&amp;g.length&gt;1&amp;&amp;g[0]!=a.nodeFrom.id,b)},contains:function(a,b){var d=a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(d,e,b,this.edge.epsilon)}}})})($jit.RGraph);B.ForceDirected=new j({getOptions:function(){var a=this.canvas.getSize(),c=a.width,a=a.height,b=0;this.graph.eachNode(function(){b++});
var d=c*a/b,e=Math.sqrt(d),f=this.config.levelDistance;return{width:c,height:a,tstart:c*0.1,nodef:function(a){return d/(a||1)},edgef:function(a){return e*(a-f)}}},compute:function(a,c){var b=h.splat(a||["current","start","end"]),d=this.getOptions();R.compute(this.graph,b,this.config);this.graph.computeLevels(this.root,0,"ignore");this.graph.eachNode(function(a){h.each(b,function(c){c=a.getPos(c);if(c.equals(A.KER))c.x=d.width/5*(Math.random()-0.5),c.y=d.height/5*(Math.random()-0.5);a.disp={};h.each(b,
function(c){a.disp[c]=K(0,0)})})});this.computePositions(b,d,c)},computePositions:function(a,c,b){var d=this.config.iterations,e=0,f=this;if(b)(function i(){for(var h=b.iter,l=0;l&lt;h;l++)if(c.t=c.tstart,d&amp;&amp;(c.t*=1-e++/(d-1)),f.computePositionStep(a,c),d&amp;&amp;e&gt;=d){b.onComplete();return}b.onStep(Math.round(e/(d-1)*100));setTimeout(i,1)})();else for(;e&lt;d;e++)c.t=c.tstart*(1-e/(d-1)),this.computePositionStep(a,c)},computePositionStep:function(a,c){var b=this.graph,d=Math.min,e=Math.max,f=K(0,0);b.eachNode(function(d){h.each(a,
function(a){d.disp[a].x=0;d.disp[a].y=0});b.eachNode(function(b){b.id!=d.id&amp;&amp;h.each(a,function(a){var e=d.getPos(a),g=b.getPos(a);f.x=e.x-g.x;f.y=e.y-g.y;e=f.norm()||1;d.disp[a].$add(f.$scale(c.nodef(e)/e))})})});var g=!!b.getNode(this.root).visited;b.eachNode(function(b){b.eachAdjacency(function(d){var e=d.nodeTo;!!e.visited===g&amp;&amp;h.each(a,function(a){var d=b.getPos(a),g=e.getPos(a);f.x=d.x-g.x;f.y=d.y-g.y;d=f.norm()||1;b.disp[a].$add(f.$scale(-c.edgef(d)/d));e.disp[a].$add(f.$scale(-1))})});b.visited=
!g});var i=c.t,k=c.width/2,l=c.height/2;b.eachNode(function(c){h.each(a,function(a){var b=c.disp[a],f=b.norm()||1,a=c.getPos(a);a.$add(K(b.x*d(Math.abs(b.x),i)/f,b.y*d(Math.abs(b.y),i)/f));a.x=d(k,e(-k,a.x));a.y=d(l,e(-l,a.y))})})}});$jit.ForceDirected=new j({Implements:[F,E,B.ForceDirected],initialize:function(a){var c=$jit.ForceDirected,a=this.controller=this.config=h.merge(u("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),{iterations:50,levelDistance:50},
a);if(a.useCanvas)this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label";else{if(a.background)a.background=h.merge({type:"Circles"},a.background);this.canvas=new D(this,a);this.config.labelContainer=(typeof a.injectInto=="string"?a.injectInto:a.injectInto.id)+"-label"}this.graphOptions={klass:A,Node:{selected:false,exist:true,drawn:true}};this.graph=new m(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new c.Label[a.Label.type](this);this.fx=new c.Plot(this,c);
this.op=new c.Op(this);this.json=null;this.busy=false;this.initializeExtras()},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},computeIncremental:function(a){a=h.merge({iter:20,property:"end",onStep:h.empty,onComplete:h.empty},a||{});this.config.onBeforeCompute(this.graph.getNode(this.root));this.compute(a.property,a)},plot:function(){this.fx.plot()},animate:function(a){this.fx.animate(h.merge({modes:["linear"]},a||{}))}});$jit.ForceDirected.$extend=true;
(function(a){a.Op=new j({Implements:m.Op});a.Plot=new j({Implements:m.Plot});a.Label={};a.Label.Native=new j({Implements:m.Label.Native});a.Label.SVG=new j({Implements:m.Label.SVG,initialize:function(a){this.viz=a},placeLabel:function(a,b,d){var e=b.pos.getc(true),f=this.viz.canvas,g=f.translateOffsetX,h=f.translateOffsetY,k=f.scaleOffsetX,l=f.scaleOffsetY,f=f.getSize(),g=Math.round(e.x*k+g+f.width/2),e=Math.round(e.y*l+h+f.height/2);a.setAttribute("x",g);a.setAttribute("y",e);d.onPlaceLabel(a,b)}});
a.Label.HTML=new j({Implements:m.Label.HTML,initialize:function(a){this.viz=a},placeLabel:function(a,b,d){var e=b.pos.getc(true),f=this.viz.canvas,g=f.translateOffsetX,h=f.translateOffsetY,k=f.scaleOffsetX,l=f.scaleOffsetY,n=f.getSize(),e={x:Math.round(e.x*k+g+n.width/2),y:Math.round(e.y*l+h+n.height/2)},g=a.style;g.left=e.x+"px";g.top=e.y+"px";g.display=this.fitsInCanvas(e,f)?"":"none";d.onPlaceLabel(a,b)}});a.Plot.NodeTypes=new j({none:{render:h.empty,contains:h.lambda(false)},circle:{render:function(a,
b){var d=a.pos.getc(true),e=a.getData("dim");this.nodeHelper.circle.render("fill",d,e,b)},contains:function(a,b){var d=a.pos.getc(true),e=a.getData("dim");return this.nodeHelper.circle.contains(d,b,e)}},ellipse:{render:function(a,b){var d=a.pos.getc(true),e=a.getData("width"),f=a.getData("height");this.nodeHelper.ellipse.render("fill",d,e,f,b)},contains:function(a,b){var d=a.pos.getc(true),e=a.getData("width"),f=a.getData("height");return this.nodeHelper.ellipse.contains(d,b,e,f)}},square:{render:function(a,
b){var d=a.pos.getc(true),e=a.getData("dim");this.nodeHelper.square.render("fill",d,e,b)},contains:function(a,b){var d=a.pos.getc(true),e=a.getData("dim");return this.nodeHelper.square.contains(d,b,e)}},rectangle:{render:function(a,b){var d=a.pos.getc(true),e=a.getData("width"),f=a.getData("height");this.nodeHelper.rectangle.render("fill",d,e,f,b)},contains:function(a,b){var d=a.pos.getc(true),e=a.getData("width"),f=a.getData("height");return this.nodeHelper.rectangle.contains(d,b,e,f)}},triangle:{render:function(a,
b){var d=a.pos.getc(true),e=a.getData("dim");this.nodeHelper.triangle.render("fill",d,e,b)},contains:function(a,b){var d=a.pos.getc(true),e=a.getData("dim");return this.nodeHelper.triangle.contains(d,b,e)}},star:{render:function(a,b){var d=a.pos.getc(true),e=a.getData("dim");this.nodeHelper.star.render("fill",d,e,b)},contains:function(a,b){var d=a.pos.getc(true),e=a.getData("dim");return this.nodeHelper.star.contains(d,b,e)}}});a.Plot.EdgeTypes=new j({none:h.empty,line:{render:function(a,b){var d=
a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true);this.edgeHelper.line.render(d,e,b)},contains:function(a,b){var d=a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(d,e,b,this.edge.epsilon)}},arrow:{render:function(a,b){var d=a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true),f=a.getData("dim"),g=a.data.$direction;this.edgeHelper.arrow.render(d,e,f,g&amp;&amp;g.length&gt;1&amp;&amp;g[0]!=a.nodeFrom.id,b)},contains:function(a,b){var d=a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true);
return this.edgeHelper.arrow.contains(d,e,b,this.edge.epsilon)}}})})($jit.ForceDirected);$jit.TM={};var r=$jit.TM;$jit.TM.$extend=true;r.Base={layout:{orientation:"h",vertical:function(){return this.orientation=="v"},horizontal:function(){return this.orientation=="h"},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(a){this.controller=this.config=h.merge(u("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),{orientation:"h",titleHeight:13,
offset:2,levelsToShow:0,constrained:false,animate:false,Node:{type:"rectangle",overridable:true,width:3,height:3,color:"#444"},Label:{textAlign:"center",textBaseline:"top"},Edge:{type:"none"},duration:700,fps:45},a);this.layout.orientation=this.config.orientation;a=this.config;if(a.useCanvas)this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label";else{if(a.background)a.background=h.merge({type:"Circles"},a.background);this.canvas=new D(this,a);this.config.labelContainer=(typeof a.injectInto==
"string"?a.injectInto:a.injectInto.id)+"-label"}this.graphOptions={klass:A,Node:{selected:false,exist:true,drawn:true}};this.graph=new m(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new r.Label[a.Label.type](this);this.fx=new r.Plot(this);this.op=new r.Op(this);this.group=new r.Group(this);this.geom=new r.Geom(this);this.clickedNode=null;this.busy=false;this.initializeExtras()},refresh:function(){if(!this.busy){this.busy=true;var a=this;this.config.animate?(this.compute("end"),
this.config.levelsToShow&gt;0&amp;&amp;this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&amp;&amp;this.clickedNode.id||this.root)),this.fx.animate(h.merge(this.config,{modes:["linear","node-property:width:height"],onComplete:function(){a.busy=false}}))):(this.config.Label.type!="Native"&amp;&amp;(a=this,this.graph.eachNode(function(c){a.labels.hideLabel(c,false)})),this.busy=false,this.compute(),this.config.levelsToShow&gt;0&amp;&amp;this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&amp;&amp;this.clickedNode.id||
this.root)),this.plot())}},plot:function(){this.fx.plot()},leaf:function(a){return a.getSubnodes([1,1],"ignore").length==0},enter:function(a){if(!this.busy){this.busy=true;var c=this,b=this.config,d=this.graph,e=this.clickedNode,f={onComplete:function(){b.levelsToShow&gt;0&amp;&amp;c.geom.setRightLevelToShow(a);(b.levelsToShow&gt;0||b.request)&amp;&amp;c.compute();b.animate?(d.nodeList.setData("alpha",0,"end"),a.eachSubgraph(function(a){a.setData("alpha",1,"end")},"ignore"),c.fx.animate({duration:500,modes:["node-property:alpha"],
onComplete:function(){c.clickedNode=a;c.compute("end");c.clickedNode=e;c.fx.animate({modes:["linear","node-property:width:height"],duration:1E3,onComplete:function(){c.busy=false;c.clickedNode=a}})}})):(c.busy=false,c.clickedNode=a,c.refresh())}};if(b.request)this.requestNodes(a,f);else f.onComplete()}},out:function(){if(!this.busy){this.busy=true;this.events.hoveredNode=false;var a=this,c=this.config,b=this.graph,d=b.getNode(this.clickedNode&amp;&amp;this.clickedNode.id||this.root).getParents()[0],e=this.clickedNode;
if(d)if(callback={onComplete:function(){a.clickedNode=d;c.request?a.requestNodes(d,{onComplete:function(){a.compute();a.plot();a.busy=false}}):(a.compute(),a.plot(),a.busy=false)}},c.levelsToShow&gt;0&amp;&amp;this.geom.setRightLevelToShow(d),c.animate)this.clickedNode=d,this.compute("end"),this.clickedNode=e,this.fx.animate({modes:["linear","node-property:width:height"],duration:1E3,onComplete:function(){a.clickedNode=d;b.eachNode(function(a){a.setDataset(["current","end"],{alpha:[0,1]})},"ignore");e.eachSubgraph(function(a){a.setData("alpha",
1)},"ignore");a.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){callback.onComplete()}})}});else callback.onComplete();else this.busy=false}},requestNodes:function(a,c){var b=h.merge(this.controller,c),d=this.config.levelsToShow;if(b.request){var e=[],f=a._depth;a.eachLevel(0,d,function(a){var b=d-(a._depth-f);if(a.drawn&amp;&amp;!a.anySubnode()&amp;&amp;b&gt;0)e.push(a),a._level=b});this.group.requestNodes(e,b)}else b.onComplete()},reposition:function(){this.compute("end")}};r.Op=new j({Implements:m.Op,
initialize:function(a){this.viz=a}});r.Geom=new j({Implements:m.Geom,getRightLevelToShow:function(){return this.viz.config.levelsToShow},setRightLevelToShow:function(a){var c=this.getRightLevelToShow(),b=this.viz.labels;a.eachLevel(0,c+1,function(d){d._depth-a._depth&gt;c?(d.drawn=false,d.exist=false,d.ignore=true,b.hideLabel(d,false)):(d.drawn=true,d.exist=true,delete d.ignore)});a.drawn=true;delete a.ignore}});r.Group=new j({initialize:function(a){this.viz=a;this.canvas=a.canvas;this.config=a.config},
requestNodes:function(a,c){var b=0,d=a.length,e=this.viz;if(d==0)c.onComplete();for(var f=0;f&lt;d;f++)c.request(a[f].id,a[f]._level,{onComplete:function(a,f){if(f&amp;&amp;f.children)f.id=a,e.op.sum(f,{type:"nothing"});++b==d&amp;&amp;(e.graph.computeLevels(e.root,0),c.onComplete())}})}});r.Plot=new j({Implements:m.Plot,initialize:function(a){this.viz=a;this.config=a.config;this.node=this.config.Node;this.edge=this.config.Edge;this.animation=new M;this.nodeTypes=new r.Plot.NodeTypes;this.edgeTypes=new r.Plot.EdgeTypes;
this.labels=a.labels},plot:function(a,c){var b=this.viz,d=b.graph;b.canvas.clear();this.plotTree(d.getNode(b.clickedNode&amp;&amp;b.clickedNode.id||b.root),h.merge(b.config,a||{},{withLabels:true,hideLabels:false,plotSubtree:function(a){return a.anySubnode("exist")}}),c)}});r.Label={};r.Label.Native=new j({Implements:m.Label.Native,initialize:function(a){this.config=a.config;this.leaf=a.leaf},renderLabel:function(a,c){if(this.leaf(c)||this.config.titleHeight){var b=c.pos.getc(true),d=a.getCtx(),e=c.getData("width");
c.getData("height");d.fillText(c.name,b.x+e/2,b.y,e)}}});r.Label.SVG=new j({Implements:m.Label.SVG,initialize:function(a){this.viz=a;this.leaf=a.leaf;this.config=a.config},placeLabel:function(a,c,b){var d=c.pos.getc(true),e=this.viz.canvas,f=e.translateOffsetX,g=e.translateOffsetY,h=e.scaleOffsetX,k=e.scaleOffsetY,e=e.getSize(),f=Math.round(d.x*h+f+e.width/2),d=Math.round(d.y*k+g+e.height/2);a.setAttribute("x",f);a.setAttribute("y",d);if(!this.leaf(c)&amp;&amp;!this.config.titleHeight)a.style.display="none";
b.onPlaceLabel(a,c)}});r.Label.HTML=new j({Implements:m.Label.HTML,initialize:function(a){this.viz=a;this.leaf=a.leaf;this.config=a.config},placeLabel:function(a,c,b){var d=c.pos.getc(true),e=this.viz.canvas,f=e.translateOffsetX,g=e.translateOffsetY,h=e.scaleOffsetX,k=e.scaleOffsetY,e=e.getSize(),f=Math.round(d.x*h+f+e.width/2),d=Math.round(d.y*k+g+e.height/2),g=a.style;g.left=f+"px";g.top=d+"px";g.width=c.getData("width")*h+"px";g.height=c.getData("height")*k+"px";g.zIndex=c._depth*100;g.display=
"";if(!this.leaf(c)&amp;&amp;!this.config.titleHeight)a.style.display="none";b.onPlaceLabel(a,c)}});r.Plot.NodeTypes=new j({none:{render:h.empty},rectangle:{render:function(a,c){var b=this.viz.leaf(a),d=this.config,e=d.offset,f=d.titleHeight,g=a.pos.getc(true),i=a.getData("width"),k=a.getData("height"),l=a.getData("border"),n=c.getCtx(),o=g.x+e/2,j=g.y+e/2;if(!(i&lt;=e||k&lt;=e))if(b){if(d.cushion)b=n.createRadialGradient(o+(i-e)/2,j+(k-e)/2,1,o+(i-e)/2,j+(k-e)/2,i&lt;k?k:i),d=a.getData("color"),f=h.rgbToHex(h.map(h.hexToRgb(d),
function(a){return a*0.2&gt;&gt;0})),b.addColorStop(0,d),b.addColorStop(1,f),n.fillStyle=b;n.fillRect(o,j,i-e,k-e);if(l)n.save(),n.strokeStyle=l,n.strokeRect(o,j,i-e,k-e),n.restore()}else if(f&gt;0&amp;&amp;(n.fillRect(g.x+e/2,g.y+e/2,i-e,f-e),l))n.save(),n.strokeStyle=l,n.strokeRect(g.x+e/2,g.y+e/2,i-e,k-e),n.restore()},contains:function(a,c){if(this.viz.clickedNode&amp;&amp;!a.isDescendantOf(this.viz.clickedNode.id)||a.ignore)return false;var b=a.pos.getc(true),d=a.getData("width"),e=this.viz.leaf(a)?a.getData("height"):
this.config.titleHeight;return this.nodeHelper.rectangle.contains({x:b.x+d/2,y:b.y+e/2},c,d,e)}}});r.Plot.EdgeTypes=new j({none:h.empty});r.SliceAndDice=new j({Implements:[F,E,r.Base,B.TM.SliceAndDice]});r.Squarified=new j({Implements:[F,E,r.Base,B.TM.Squarified]});r.Strip=new j({Implements:[F,E,r.Base,B.TM.Strip]});u.BarChart={$extend:true,animate:true,type:"stacked",labelOffset:3,barsOffset:0,hoveredColor:"#9fd4ff",orientation:"horizontal",showAggregates:true,showLabels:true,Tips:{enable:false,
onShow:h.empty,onHide:h.empty},Events:{enable:false,onClick:h.empty}};$jit.ST.Plot.NodeTypes.implement({"barchart-stacked":{render:function(a,c){var b=a.pos.getc(true),d=a.getData("width"),e=a.getData("height"),f=this.getAlignedPos(b,d,e),b=f.x,f=f.y,g=a.getData("dimArray"),i=a.getData("valueArray"),k=a.getData("colorArray"),l=k.length,n=a.getData("stringArray"),o=c.getCtx(),j,m,q=a.getData("border"),p=a.getData("gradient"),z=a.getData("config"),w=z.orientation=="horizontal",s=z.showAggregates,u=
z.showLabels,x=z.Label;if(k&amp;&amp;g&amp;&amp;n){for(var y=0,I=g.length,v=0,r=0;y&lt;I;y++){o.fillStyle=o.strokeStyle=k[y%l];if(p){var C;C=w?o.createLinearGradient(b+v+g[y]/2,f,b+v+g[y]/2,f+e):o.createLinearGradient(b,f-v-g[y]/2,b+d,f-v-g[y]/2);var A=h.rgbToHex(h.map(h.hexToRgb(k[y%l].slice(1)),function(a){return a*0.5&gt;&gt;0}));C.addColorStop(0,A);C.addColorStop(0.5,k[y%l]);C.addColorStop(1,A);o.fillStyle=C}w?o.fillRect(b+v,f,g[y],e):o.fillRect(b,f-v-g[y],d,g[y]);q&amp;&amp;q.name==n[y]&amp;&amp;(j=v,m=g[y]);v+=g[y]||0;r+=i[y]||0}if(q)o.save(),
o.lineWidth=2,o.strokeStyle=q.color,w?o.strokeRect(b+j+1,f+1,m-2,e-2):o.strokeRect(b+1,f-j-m+1,d-2,m-2),o.restore();if(x.type=="Native"){o.save();o.fillStyle=o.strokeStyle=x.color;o.font=x.style+" "+x.size+"px "+x.family;o.textBaseline="middle";j=s(a.name,r,a);if(j!==false)j=j!==true?j:r,w?(o.textAlign="right",o.fillText(j,b+v-z.labelOffset,f+e/2)):(o.textAlign="center",o.fillText(j,b+d/2,f-e-x.size/2-z.labelOffset));if(u(a.name,r,a))w?(o.textAlign="center",o.translate(b-z.labelOffset-x.size/2,f+
e/2),o.rotate(Math.PI/2),o.fillText(a.name,0,0)):(o.textAlign="center",o.fillText(a.name,b+d/2,f+x.size/2+z.labelOffset));o.restore()}}},contains:function(a,c){var b=a.pos.getc(true),d=a.getData("width"),e=a.getData("height"),b=this.getAlignedPos(b,d,e),f=b.x,g=b.y,b=a.getData("dimArray"),h=a.getData("config").orientation=="horizontal";if(h){if(c.x&lt;f||c.x&gt;f+d||c.y&gt;g+e||c.y&lt;g)return false}else if(c.x&lt;f||c.x&gt;f+d||c.y&gt;g||c.y&lt;g-e)return false;d=0;e=b.length;for(f=h?f:g;d&lt;e;d++)if(g=b[d],h){if(f+=g,g=
f,c.x&lt;=g)return{name:a.getData("stringArray")[d],color:a.getData("colorArray")[d],value:a.getData("valueArray")[d],label:a.name}}else if(f-=g,g=f,c.y&gt;=g)return{name:a.getData("stringArray")[d],color:a.getData("colorArray")[d],value:a.getData("valueArray")[d],label:a.name};return false}},"barchart-grouped":{render:function(a,c){var b=a.pos.getc(true),d=a.getData("width"),e=a.getData("height"),f=this.getAlignedPos(b,d,e),b=f.x,f=f.y,g=a.getData("dimArray"),i=a.getData("valueArray"),k=i.length,l=a.getData("colorArray"),
n=l.length,o=a.getData("stringArray"),j=c.getCtx(),m,q,p=a.getData("border"),z=a.getData("gradient"),w=a.getData("config"),s=w.orientation=="horizontal",u=w.showAggregates,x=w.showLabels,y=w.Label,r=(s?e:d)/k;if(l&amp;&amp;g&amp;&amp;o){for(var v=0,A=0,C=0;v&lt;k;v++){j.fillStyle=j.strokeStyle=l[v%n];if(z){var B;B=s?j.createLinearGradient(b+g[v]/2,f+r*v,b+g[v]/2,f+r*(v+1)):j.createLinearGradient(b+r*v,f-g[v]/2,b+r*(v+1),f-g[v]/2);var D=h.rgbToHex(h.map(h.hexToRgb(l[v%n].slice(1)),function(a){return a*0.5&gt;&gt;0}));B.addColorStop(0,
D);B.addColorStop(0.5,l[v%n]);B.addColorStop(1,D);j.fillStyle=B}s?j.fillRect(b,f+r*v,g[v],r):j.fillRect(b+r*v,f-g[v],r,g[v]);p&amp;&amp;p.name==o[v]&amp;&amp;(m=r*v,q=g[v]);A+=g[v]||0;C+=i[v]||0}if(p)j.save(),j.lineWidth=2,j.strokeStyle=p.color,s?j.strokeRect(b+1,f+m+1,q-2,r-2):j.strokeRect(b+m+1,f-q+1,r-2,q-2),j.restore();if(y.type=="Native"){j.save();j.fillStyle=j.strokeStyle=y.color;j.font=y.style+" "+y.size+"px "+y.family;j.textBaseline="middle";m=u(a.name,C,a);if(m!==false)m=m!==true?m:C,s?(j.textAlign="right",
j.fillText(m,b+Math.max.apply(null,g)-w.labelOffset,f+e/2)):(j.textAlign="center",j.fillText(m,b+d/2,f-Math.max.apply(null,g)-y.size/2-w.labelOffset));if(x(a.name,C,a))s?(j.textAlign="center",j.translate(b-w.labelOffset-y.size/2,f+e/2),j.rotate(Math.PI/2),j.fillText(a.name,0,0)):(j.textAlign="center",j.fillText(a.name,b+d/2,f+y.size/2+w.labelOffset));j.restore()}}},contains:function(a,c){var b=a.pos.getc(true),d=a.getData("width"),e=a.getData("height"),f=this.getAlignedPos(b,d,e),b=f.x,f=f.y,g=a.getData("dimArray"),
h=g.length,k=a.getData("config").orientation=="horizontal",h=(k?e:d)/h;if(k){if(c.x&lt;b||c.x&gt;b+d||c.y&gt;f+e||c.y&lt;f)return false}else if(c.x&lt;b||c.x&gt;b+d||c.y&gt;f||c.y&lt;f-e)return false;d=0;for(e=g.length;d&lt;e;d++){var l=g[d];if(k){var n=f+h*d;if(c.x&lt;=b+l&amp;&amp;c.y&gt;=n&amp;&amp;c.y&lt;=n+h)return{name:a.getData("stringArray")[d],color:a.getData("colorArray")[d],value:a.getData("valueArray")[d],label:a.name}}else if(n=b+h*d,c.x&gt;=n&amp;&amp;c.x&lt;=n+h&amp;&amp;c.y&gt;=f-l)return{name:a.getData("stringArray")[d],color:a.getData("colorArray")[d],value:a.getData("valueArray")[d],
label:a.name}}return false}}});$jit.BarChart=new j({st:null,colors:"#416D9C,#70A35E,#EBB056,#C74243,#83548B,#909291,#557EAA".split(","),selected:{},busy:false,initialize:function(a){this.controller=this.config=h.merge(u("Canvas","Margin","Label","BarChart"),{Label:{type:"Native"}},a);var a=this.config.showLabels,c=h.type(a),b=this.config.showAggregates,d=h.type(b);this.config.showLabels=c=="function"?a:h.lambda(a);this.config.showAggregates=d=="function"?b:h.lambda(b);this.initializeViz()},initializeViz:function(){var a=
this.config,c=this,b=a.type.split(":")[0],d=a.orientation=="horizontal",e={},b=new $jit.ST({injectInto:a.injectInto,width:a.width,height:a.height,orientation:d?"left":"bottom",levelDistance:0,siblingOffset:a.barsOffset,subtreeOffset:0,withLabels:a.Label.type!="Native",useCanvas:a.useCanvas,Label:{type:a.Label.type},Node:{overridable:true,type:"barchart-"+b,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:a.Tips.enable,type:"Native",force:true,onShow:function(b,c,d){a.Tips.onShow(b,d,
c)}},Events:{enable:true,type:"Native",onClick:function(b,c,d){a.Events.enable&amp;&amp;(b=c.getContains(),a.Events.onClick(b,c,d))},onMouseMove:function(b,d){if(a.hoveredColor)if(b){var e=d.getContains();c.select(b.id,e.name,e.index)}else c.select(false,false,false)}},onCreateLabel:function(b,c){var d=a.Label,f=c.getData("valueArray"),f=h.reduce(f,function(a,b){return a+b},0),g={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")},j=g.wrapper,
m=g.label,q=g.aggregate,p=j.style,z=m.style,w=q.style;e[c.id]=g;j.appendChild(m);j.appendChild(q);if(!a.showLabels(c.name,f,c))z.display="none";if(!a.showAggregates(c.name,f,c))w.display="none";p.position="relative";p.overflow="visible";p.fontSize=d.size+"px";p.fontFamily=d.family;p.color=d.color;p.textAlign="center";w.position=z.position="absolute";b.style.width=c.getData("width")+"px";b.style.height=c.getData("height")+"px";w.left=z.left="0px";m.innerHTML=c.name;b.appendChild(j)},onPlaceLabel:function(b,
c){if(e[c.id]){var d=e[c.id],f=d.wrapper.style,g=d.label.style,h=d.aggregate.style,j=a.type.split(":")[0]=="grouped",m=a.orientation=="horizontal",p=c.getData("dimArray"),q=c.getData("valueArray"),w=j&amp;&amp;m?Math.max.apply(null,p):c.getData("width"),j=j&amp;&amp;!m?Math.max.apply(null,p):c.getData("height"),m=parseInt(f.fontSize,10);if(p&amp;&amp;q){f.width=h.width=g.width=b.style.width=w+"px";for(var s=0,r=q.length,w=0;s&lt;r;s++)p[s]&gt;0&amp;&amp;(w+=q[s]);g.display=a.showLabels(c.name,w,c)?"":"none";p=a.showAggregates(c.name,
w,c);h.display=p!==false?"":"none";a.orientation=="horizontal"?(h.textAlign="right",g.textAlign="left",g.textIndex=h.textIndent=a.labelOffset+"px",h.top=g.top=(j-m)/2+"px"):(h.top=-m-a.labelOffset+"px",g.top=a.labelOffset+j+"px",b.style.top=parseInt(b.style.top,10)-j+"px");b.style.height=f.height=j+"px";d.aggregate.innerHTML=p!==true?p:w}}}}),f=b.canvas.getSize(),g=a.Margin;d?(b.config.offsetX=f.width/2-g.left-(a.showLabels&amp;&amp;a.labelOffset+a.Label.size),b.config.offsetY=(g.bottom-g.top)/2):(b.config.offsetY=
-f.height/2+g.bottom+(a.showLabels&amp;&amp;a.labelOffset+a.Label.size),b.config.offsetX=(g.right-g.left)/2);this.delegate=b;this.canvas=this.delegate.canvas},loadJSON:function(a){if(!this.busy){this.busy=true;for(var c=h.time(),b=[],d=this.delegate,e=h.splat(a.label),f=h.splat(a.color||this.colors),g=this.config,i=!!g.type.split(":")[1],k=g.animate,l=g.orientation=="horizontal",j=this,o=0,a=a.values,m=a.length;o&lt;m;o++){var q=a[o],r=h.splat(a[o].values);b.push({id:c+q.label,name:q.label,data:{value:r,$valueArray:r,
$colorArray:f,$stringArray:e,$gradient:i,$config:g},children:[]})}d.loadJSON({id:c+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:b});this.normalizeDims();d.compute();d.select(d.root);k?l?d.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){j.busy=false}}):d.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){j.busy=false}}):this.busy=false}},updateJSON:function(a,c){if(!this.busy){this.busy=true;this.select(false,
false,false);var b=this.delegate,d=b.graph,e=this.config.animate,f=this,g=this.config.orientation=="horizontal";h.each(a.values,function(b){var c=d.getByName(b.label);c&amp;&amp;(c.setData("valueArray",h.splat(b.values)),a.label&amp;&amp;c.setData("stringArray",h.splat(a.label)))});this.normalizeDims();b.compute();b.select(b.root);e&amp;&amp;(g?b.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){f.busy=false;c&amp;&amp;c.onComplete()}}):b.fx.animate({modes:["node-property:height:dimArray"],duration:1500,
onComplete:function(){f.busy=false;c&amp;&amp;c.onComplete()}}))}},select:function(a,c){if(this.config.hoveredColor){var b=this.selected;if(b.id!=a||b.name!=c)b.id=a,b.name=c,b.color=this.config.hoveredColor,this.delegate.graph.eachNode(function(c){a==c.id?c.setData("border",b):c.setData("border",false)}),this.delegate.plot()}},getLegend:function(){var a={},c;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(a){c=a.nodeTo});var b=c.getData("colorArray"),d=b.length;h.each(c.getData("stringArray"),
function(c,f){a[c]=b[f%d]});return a},getMaxValue:function(){var a=0,c=this.config.type.split(":")[0]=="stacked";this.delegate.graph.eachNode(function(b){var b=b.getData("valueArray"),d=0;b&amp;&amp;(c?h.each(b,function(a){d+=+a}):d=Math.max.apply(null,b),a=a&gt;d?a:d)});return a},setBarType:function(a){this.config.type=a;this.delegate.config.Node.type="barchart-"+a.split(":")[0]},normalizeDims:function(){var a=0;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(){a++});var c=this.getMaxValue()||
1,b=this.delegate.canvas.getSize(),d=this.config,e=d.Margin,f=e.left+e.right,e=e.top+e.bottom,g=d.orientation=="horizontal",i=(b[g?"height":"width"]-(g?e:f)-(a-1)*d.barsOffset)/a,k=d.animate,l=b[g?"width":"height"]-(g?f:e)-(!g&amp;&amp;d.showAggregates&amp;&amp;d.Label.size+d.labelOffset)-(d.showLabels&amp;&amp;d.Label.size+d.labelOffset),j=g?"height":"width",m=g?"width":"height";this.delegate.graph.eachNode(function(a){var b=0,d=[];h.each(a.getData("valueArray"),function(a){b+=+a;d.push(0)});a.setData(j,i);k?(a.setData(m,
b*l/c,"end"),a.setData("dimArray",h.map(a.getData("valueArray"),function(a){return a*l/c}),"end"),a.getData("dimArray")||a.setData("dimArray",d)):(a.setData(m,b*l/c),a.setData("dimArray",h.map(a.getData("valueArray"),function(a){return a*l/c})))})}});u.PieChart={$extend:true,animate:true,offset:25,sliceOffset:0,labelOffset:3,type:"stacked",hoveredColor:"#9fd4ff",Events:{enable:false,onClick:h.empty},Tips:{enable:false,onShow:h.empty,onHide:h.empty},showLabels:true,resizeLabels:false,updateHeights:false};
$jit.Sunburst=new j({Implements:[F,E,B.Radial],initialize:function(a){var c=$jit.Sunburst,a=this.controller=this.config=h.merge(u("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),{interpolation:"linear",levelDistance:100,Node:{type:"multipie",height:0},Edge:{type:"none"},Label:{textAlign:"start",textBaseline:"middle"}},a);if(a.useCanvas)this.canvas=a.useCanvas,this.config.labelContainer=this.canvas.id+"-label";else{if(a.background)a.background=h.merge({type:"Circles"},
a.background);this.canvas=new D(this,a);this.config.labelContainer=(typeof a.injectInto=="string"?a.injectInto:a.injectInto.id)+"-label"}this.graphOptions={klass:q,Node:{selected:false,exist:true,drawn:true}};this.graph=new m(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new c.Label[a.Label.type](this);this.fx=new c.Plot(this,c);this.op=new c.Op(this);this.rotated=this.root=this.json=null;this.busy=false;this.initializeExtras()},createLevelDistanceFunc:function(){var a=this.config.levelDistance;
return function(c){return(c._depth+1)*a}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},rotate:function(a,c,b){var d=a.getPos(b.property||"current").getp(true).theta;this.rotated=a;this.rotateAngle(-d,c,b)},rotateAngle:function(a,c,b){var d=h.merge(this.config,b||{},{modes:["polar"]}),e=b.property||(c==="animate"?"end":"current");c==="animate"&amp;&amp;this.fx.animation.pause();this.graph.eachNode(function(b){b=b.getPos(e);b.theta+=a;b.theta&lt;0&amp;&amp;(b.theta+=Math.PI*
2)});if(c=="animate")this.fx.animate(d);else if(c=="replot")this.fx.plot(),this.busy=false},plot:function(){this.fx.plot()}});$jit.Sunburst.$extend=true;(function(a){a.Op=new j({Implements:m.Op});a.Plot=new j({Implements:m.Plot});a.Label={};a.Label.Native=new j({Implements:m.Label.Native,initialize:function(a){this.viz=a;this.label=a.config.Label;this.config=a.config},renderLabel:function(a,b){var d=b.getData("span");if(!(d&lt;Math.PI/2&amp;&amp;Math.tan(d)*this.config.levelDistance*b._depth&lt;10)){var d=a.getCtx(),
e=d.measureText(b.name);if(b.id==this.viz.root)var f=-e.width/2,g=0,h=0;else{f=b.pos.clone();f.rho+=5;var k=f.getp(true),g=f.getc(true),f=g.x,g=g.y,h=Math.PI,l=k.theta&gt;h/2&amp;&amp;k.theta&lt;3*h/2,h=l?k.theta+h:k.theta;l?(f-=Math.abs(Math.cos(k.theta)*e.width),g+=Math.sin(k.theta)*e.width):b.id==this.viz.root&amp;&amp;(f-=e.width/2)}d.save();d.translate(f,g);d.rotate(h);d.fillText(b.name,0,0);d.restore()}}});a.Label.SVG=new j({Implements:m.Label.SVG,initialize:function(a){this.viz=a},placeLabel:function(a,b,d){var e=
b.pos.getc(true),f=this.viz,g=this.viz.canvas.getSize(),h=Math.round(e.x+g.width/2),e=Math.round(e.y+g.height/2);a.setAttribute("x",h);a.setAttribute("y",e);var k=a.getBBox();if(k){var h=a.getAttribute("x"),e=a.getAttribute("y"),l=b.pos.getp(true),g=Math.PI,j=l.theta&gt;g/2&amp;&amp;l.theta&lt;3*g/2;j?(a.setAttribute("x",h-k.width),a.setAttribute("y",e-k.height)):b.id==f.root&amp;&amp;a.setAttribute("x",h-k.width/2);f=j?l.theta+g:l.theta;b._depth&amp;&amp;a.setAttribute("transform","rotate("+f*360/(2*g)+" "+h+" "+e+")")}d.onPlaceLabel(a,
b)}});a.Label.HTML=new j({Implements:m.Label.HTML,initialize:function(a){this.viz=a},placeLabel:function(a,b,d){var e=b.pos.clone(),f=this.viz.canvas,g=b.getData("height"),g=(g||b._depth==0?g:this.viz.config.levelDistance)/2,h=f.getSize();e.rho+=g;e=e.getc(true);e={x:Math.round(e.x+h.width/2),y:Math.round(e.y+h.height/2)};g=a.style;g.left=e.x+"px";g.top=e.y+"px";g.display=this.fitsInCanvas(e,f)?"":"none";d.onPlaceLabel(a,b)}});a.Plot.NodeTypes=new j({none:{render:h.empty,contains:h.lambda(false),
anglecontains:function(a,b){var d=a.getData("span")/2,e=a.pos.theta,f=e-d,d=e+d;f&lt;0&amp;&amp;(f+=Math.PI*2);e=Math.atan2(b.y,b.x);e&lt;0&amp;&amp;(e+=Math.PI*2);return f&gt;d?e&gt;f&amp;&amp;e&lt;=Math.PI*2||e&lt;d:e&gt;f&amp;&amp;e&lt;d}},pie:{render:function(a,b){var d=a.getData("span")/2,e=a.pos.theta,f=e-d,d=e+d,e=a.pos.getp(true),g=new q(e.rho,f),h=g.getc(true);g.theta=d;var g=g.getc(true),k=b.getCtx();k.beginPath();k.moveTo(0,0);k.lineTo(h.x,h.y);k.moveTo(0,0);k.lineTo(g.x,g.y);k.moveTo(0,0);k.arc(0,0,e.rho*a.getData("dim-quotient"),f,d,false);
k.fill()},contains:function(a,b){return this.nodeTypes.none.anglecontains.call(this,a,b)?Math.sqrt(b.x*b.x+b.y*b.y)&lt;=this.config.levelDistance*a._depth:false}},multipie:{render:function(a,b){var d=a.getData("height"),d=d?d:this.config.levelDistance,e=a.getData("span")/2,f=a.pos.theta,g=f-e,e=f+e,f=a.pos.getp(true),h=new q(f.rho,g),k=h.getc(true);h.theta=e;var l=h.getc(true);h.rho+=d;var j=h.getc(true);h.theta=g;var h=h.getc(true),m=b.getCtx();m.moveTo(0,0);m.beginPath();m.arc(0,0,f.rho,g,e,false);
m.arc(0,0,f.rho+d,e,g,true);m.moveTo(k.x,k.y);m.lineTo(h.x,h.y);m.moveTo(l.x,l.y);m.lineTo(j.x,j.y);m.fill();if(a.collapsed)m.save(),m.lineWidth=2,m.moveTo(0,0),m.beginPath(),m.arc(0,0,f.rho+d+5,e-0.01,g+0.01,true),m.stroke(),m.restore()},contains:function(a,b){if(this.nodeTypes.none.anglecontains.call(this,a,b)){var d=Math.sqrt(b.x*b.x+b.y*b.y),e=a.getData("height"),e=e?e:this.config.levelDistance,f=this.config.levelDistance,g=a._depth;return d&gt;=f*g&amp;&amp;d&lt;=f*g+e}return false}},"gradient-multipie":{render:function(a,
b){var d=b.getCtx(),e=a.getData("height"),e=e?e:this.config.levelDistance,e=d.createRadialGradient(0,0,a.getPos().rho,0,0,a.getPos().rho+e),f=h.hexToRgb(a.getData("color")),g=[];h.each(f,function(a){g.push(parseInt(a*0.5,10))});f=h.rgbToHex(g);e.addColorStop(0,f);e.addColorStop(1,a.getData("color"));d.fillStyle=e;this.nodeTypes.multipie.render.call(this,a,b)},contains:function(a,b){return this.nodeTypes.multipie.contains.call(this,a,b)}},"gradient-pie":{render:function(a,b){var d=b.getCtx(),e=d.createRadialGradient(0,
0,0,0,0,a.getPos().rho),f=h.hexToRgb(a.getData("color")),g=[];h.each(f,function(a){g.push(parseInt(a*0.5,10))});f=h.rgbToHex(g);e.addColorStop(1,f);e.addColorStop(0,a.getData("color"));d.fillStyle=e;this.nodeTypes.pie.render.call(this,a,b)},contains:function(a,b){return this.nodeTypes.pie.contains.call(this,a,b)}}});a.Plot.EdgeTypes=new j({none:h.empty,line:{render:function(a,b){var d=a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true);this.edgeHelper.line.render(d,e,b)},contains:function(a,b){var d=
a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(d,e,b,this.edge.epsilon)}},arrow:{render:function(a,b){var d=a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true),f=a.getData("dim"),g=a.data.$direction;this.edgeHelper.arrow.render(d,e,f,g&amp;&amp;g.length&gt;1&amp;&amp;g[0]!=a.nodeFrom.id,b)},contains:function(a,b){var d=a.nodeFrom.pos.getc(true),e=a.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(d,e,b,this.edge.epsilon)}},hyperline:{render:function(a,b){var d=a.nodeFrom.pos.getc(),
e=a.nodeTo.pos.getc(),f=Math.max(d.norm(),e.norm());this.edgeHelper.hyperline.render(d.$scale(1/f),e.$scale(1/f),f,b)},contains:h.lambda(false)}})})($jit.Sunburst);$jit.Sunburst.Plot.NodeTypes.implement({"piechart-stacked":{render:function(a,c){a.pos.getp(true);var b=a.getData("dimArray"),d=a.getData("valueArray"),e=a.getData("colorArray"),f=e.length,g=a.getData("stringArray"),i=a.getData("span")/2,k=a.pos.theta,l=k-i,j=k+i,k=new q,i=c.getCtx(),m,t,r,u,p=a.getData("gradient"),z=a.getData("border"),
w=a.getData("config"),s=w.showLabels,A=w.resizeLabels,x=w.Label,y=w.sliceOffset*Math.cos((l+j)/2),B=w.sliceOffset*Math.sin((l+j)/2);if(e&amp;&amp;b&amp;&amp;g){for(var v=0,D=b.length,C=0,E=0;v&lt;D;v++){var F=b[v],J=e[v%f];if(!(F&lt;=0)){i.fillStyle=i.strokeStyle=J;if(p&amp;&amp;F){var K=i.createRadialGradient(y,B,C+w.sliceOffset,y,B,C+F+w.sliceOffset),L=h.hexToRgb(J),L=h.map(L,function(a){return a*0.8&gt;&gt;0}),L=h.rgbToHex(L);K.addColorStop(0,J);K.addColorStop(0.5,J);K.addColorStop(1,L);i.fillStyle=K}k.rho=C+w.sliceOffset;k.theta=
l;k.getc(true);k.theta=j;k.getc(true);k.rho+=F;k.getc(true);k.theta=l;k.getc(true);i.beginPath();i.arc(y,B,C+0.01,l,j,false);i.arc(y,B,C+F+0.01,j,l,true);i.fill();z&amp;&amp;z.name==g[v]&amp;&amp;(m=C,t=b[v],r=l,u=j);C+=F||0;E+=d[v]||0}}if(z)i.save(),i.globalCompositeOperation="source-over",i.lineWidth=2,i.strokeStyle=z.color,i.beginPath(),i.arc(y,B,m+0.01+1,r,u,false),i.arc(y,B,m+t+0.01-1,u,r,true),i.closePath(),i.stroke(),i.restore();if(s&amp;&amp;x.type=="Native")i.save(),i.fillStyle=i.strokeStyle=x.color,b=A?a.getData("normalizedDim"):
1,b=x.size*b&gt;&gt;0,i.font=x.style+" "+(b&lt;+A?+A:b)+"px "+x.family,i.textBaseline="middle",i.textAlign="center",k.rho=C+w.labelOffset+w.sliceOffset,k.theta=a.pos.theta,b=k.getc(true),i.fillText(a.name,b.x,b.y),i.restore()}},contains:function(a,c){if(this.nodeTypes.none.anglecontains.call(this,a,c)){var b=Math.sqrt(c.x*c.x+c.y*c.y),d=this.config.levelDistance,e=a._depth,f=a.getData("config");if(b&lt;=d*e+f.sliceOffset)for(var d=a.getData("dimArray"),e=0,g=d.length,f=f.sliceOffset;e&lt;g;e++){var h=d[e];if(b&gt;=
f&amp;&amp;b&lt;=f+h)return{name:a.getData("stringArray")[e],color:a.getData("colorArray")[e],value:a.getData("valueArray")[e],label:a.name};f+=h}}return false}}});$jit.PieChart=new j({sb:null,colors:"#416D9C,#70A35E,#EBB056,#C74243,#83548B,#909291,#557EAA".split(","),selected:{},busy:false,initialize:function(a){this.controller=this.config=h.merge(u("Canvas","PieChart","Label"),{Label:{type:"Native"}},a);this.initializeViz()},initializeViz:function(){var a=this.config,c=this,b=a.type.split(":")[0],b=new $jit.Sunburst({injectInto:a.injectInto,
width:a.width,height:a.height,useCanvas:a.useCanvas,withLabels:a.Label.type!="Native",Label:{type:a.Label.type},Node:{overridable:true,type:"piechart-"+b,width:1,height:1},Edge:{type:"none"},Tips:{enable:a.Tips.enable,type:"Native",force:true,onShow:function(b,c,d){a.Tips.onShow(b,d,c)}},Events:{enable:true,type:"Native",onClick:function(b,c,d){a.Events.enable&amp;&amp;(b=c.getContains(),a.Events.onClick(b,c,d))},onMouseMove:function(b,d){if(a.hoveredColor)if(b){var e=d.getContains();c.select(b.id,e.name,
e.index)}else c.select(false,false,false)}},onCreateLabel:function(b,c){var d=a.Label;if(a.showLabels){var e=b.style;e.fontSize=d.size+"px";e.fontFamily=d.family;e.color=d.color;e.textAlign="center";b.innerHTML=c.name}},onPlaceLabel:function(b,d){if(a.showLabels){var e=d.pos.getp(true),e=d.getData("dimArray"),h=d.getData("span")/2,j=d.pos.theta,m=j-h,h=j+h,j=new q,o=a.resizeLabels,t=a.Label;if(e){for(var r=0,u=e.length,p=0;r&lt;u;r++)p+=e[r];e=o?d.getData("normalizedDim"):1;e=t.size*e&gt;&gt;0;b.style.fontSize=
(e&lt;+o?+o:e)+"px";j.rho=p+a.labelOffset+a.sliceOffset;j.theta=(m+h)/2;e=j.getc(true);h=c.canvas.getSize();m=Math.round(e.x+h.width/2);e=Math.round(e.y+h.height/2);b.style.left=m+"px";b.style.top=e+"px"}}}}),d=b.canvas.getSize(),e=Math.min;b.config.levelDistance=e(d.width,d.height)/2-a.offset-a.sliceOffset;this.delegate=b;this.canvas=this.delegate.canvas;this.canvas.getCtx().globalCompositeOperation="lighter"},loadJSON:function(a){for(var c=h.time(),b=[],d=this.delegate,e=h.splat(a.label),f=e.length,
g=h.splat(a.color||this.colors),i=g.length,j=this.config,l=!!j.type.split(":")[1],m=j.animate,f=f==1,o=0,a=a.values,q=a.length;o&lt;q;o++){var r=a[o],u=h.splat(r.values);b.push({id:c+r.label,name:r.label,data:{value:u,$valueArray:u,$colorArray:f?h.splat(g[o%i]):g,$stringArray:e,$gradient:l,$config:j,$angularWidth:h.reduce(u,function(a,b){return a+b})},children:[]})}d.loadJSON({id:c+"$root",name:"",data:{$type:"none",$width:1,$height:1},children:b});this.normalizeDims();d.refresh();m&amp;&amp;d.fx.animate({modes:["node-property:dimArray"],
duration:1500})},updateJSON:function(a,c){if(!this.busy){this.busy=true;var b=this.delegate,d=b.graph,e=this.config.animate,f=this;h.each(a.values,function(b){var c=d.getByName(b.label),b=h.splat(b.values);c&amp;&amp;(c.setData("valueArray",b),c.setData("angularWidth",h.reduce(b,function(a,b){return a+b})),a.label&amp;&amp;c.setData("stringArray",h.splat(a.label)))});this.normalizeDims();e?(b.compute("end"),b.fx.animate({modes:["node-property:dimArray:span","linear"],duration:1500,onComplete:function(){f.busy=false;
c&amp;&amp;c.onComplete()}})):b.refresh()}},select:function(a,c){if(this.config.hoveredColor){var b=this.selected;if(b.id!=a||b.name!=c)b.id=a,b.name=c,b.color=this.config.hoveredColor,this.delegate.graph.eachNode(function(c){a==c.id?c.setData("border",b):c.setData("border",false)}),this.delegate.plot()}},getLegend:function(){var a={},c;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(a){c=a.nodeTo});var b=c.getData("colorArray"),d=b.length;h.each(c.getData("stringArray"),function(c,
f){a[c]=b[f%d]});return a},getMaxValue:function(){var a=0;this.delegate.graph.eachNode(function(c){var c=c.getData("valueArray"),b=0;h.each(c,function(a){b+=+a});a=a&gt;b?a:b});return a},normalizeDims:function(){var a=0;this.delegate.graph.getNode(this.delegate.root).eachAdjacency(function(){a++});var c=this.getMaxValue()||1,b=this.config,d=b.animate,e=this.delegate.config.levelDistance;this.delegate.graph.eachNode(function(a){var g=0,i=[];h.each(a.getData("valueArray"),function(a){g+=+a;i.push(1)});
var j=i.length==1&amp;&amp;!b.updateHeights;d?(a.setData("dimArray",h.map(a.getData("valueArray"),function(a){return j?e:a*e/c}),"end"),a.getData("dimArray")||a.setData("dimArray",i)):a.setData("dimArray",h.map(a.getData("valueArray"),function(a){return j?e:a*e/c}));a.setData("normalizedDim",g/c)})}})})();
</pre></body></html>